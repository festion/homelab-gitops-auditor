467a873d78e8875af7964132361781f1
/**
 * Mock implementation for Home Assistant API
 * Used to isolate health checking and deployment validation
 */
class MockHomeAssistantAPI {
  constructor() {
    this.checkHealth = jest.fn();
    this.validateConfig = jest.fn();
    this.getSystemInfo = jest.fn();
    this.listEntities = jest.fn();
    this.getEntity = jest.fn();
    this.callService = jest.fn();
    this.getEvents = jest.fn();
    this.getStates = jest.fn();
    this.restartCore = jest.fn();
    this.reloadConfig = jest.fn();

    // Mock state
    this._systemInfo = {
      version: '2025.7.0',
      installation_type: 'Home Assistant Supervised',
      timezone: 'America/New_York'
    };
    this._entities = new Map();
    this._isHealthy = true;
  }

  // Mock healthy API response
  mockHealthyResponse() {
    this.checkHealth.mockResolvedValue({
      status: 'healthy',
      version: '2025.7.0',
      uptime: 86400,
      lastRestart: new Date(Date.now() - 86400000).toISOString(),
      api: {
        reachable: true,
        responseTime: 45,
        authenticated: true
      },
      supervisor: {
        version: '2025.07.0',
        healthy: true,
        addons: {
          running: 12,
          total: 12
        }
      },
      core: {
        state: 'RUNNING',
        safe_mode: false
      }
    });
    this.getSystemInfo.mockResolvedValue(this._systemInfo);
    this._isHealthy = true;
  }

  // Mock unreachable API
  mockUnreachableResponse() {
    this.checkHealth.mockRejectedValue(new Error('Home Assistant API unreachable: ECONNREFUSED'));
    this._isHealthy = false;
  }

  // Mock configuration error response
  mockConfigurationError() {
    this.checkHealth.mockResolvedValue({
      status: 'unhealthy',
      version: '2025.7.0',
      api: {
        reachable: true,
        responseTime: 156,
        authenticated: true
      },
      configurationErrors: ['Invalid YAML in configuration.yaml at line 42', 'Integration "invalid_sensor" not found', 'Duplicate entity_id: sensor.temperature'],
      supervisor: {
        version: '2025.07.0',
        healthy: false,
        error: 'Configuration check failed'
      },
      core: {
        state: 'NOT_RUNNING',
        safe_mode: true
      }
    });
    this._isHealthy = false;
  }

  // Mock successful configuration validation
  mockValidConfigValidation() {
    this.validateConfig.mockResolvedValue({
      valid: true,
      errors: [],
      warnings: [],
      result: 'Configuration check successful',
      processing_time: 2.45
    });
  }

  // Mock configuration validation with errors
  mockInvalidConfigValidation() {
    this.validateConfig.mockResolvedValue({
      valid: false,
      errors: [{
        type: 'yaml_error',
        message: 'Invalid YAML syntax',
        file: 'configuration.yaml',
        line: 42,
        column: 15
      }, {
        type: 'integration_error',
        message: 'Component not found: invalid_component',
        file: 'configuration.yaml',
        line: 156
      }],
      warnings: [{
        type: 'deprecation',
        message: 'sensor.template is deprecated, use template sensor instead',
        file: 'sensors.yaml',
        line: 25
      }],
      result: 'Configuration check failed',
      processing_time: 1.82
    });
  }

  // Mock entity listing
  mockEntityList() {
    const entities = [{
      entity_id: 'light.living_room',
      state: 'on',
      attributes: {
        friendly_name: 'Living Room Light',
        brightness: 255
      }
    }, {
      entity_id: 'sensor.temperature',
      state: '22.5',
      attributes: {
        friendly_name: 'Temperature',
        unit_of_measurement: 'Â°C'
      }
    }, {
      entity_id: 'binary_sensor.door',
      state: 'off',
      attributes: {
        friendly_name: 'Front Door',
        device_class: 'door'
      }
    }];
    this.listEntities.mockResolvedValue(entities);
    entities.forEach(entity => {
      this._entities.set(entity.entity_id, entity);
    });
  }

  // Mock specific entity retrieval
  mockEntityGet(entityId) {
    this.getEntity.mockImplementation(id => {
      const entity = this._entities.get(id);
      if (entity) {
        return Promise.resolve(entity);
      }
      return Promise.reject(new Error(`Entity ${id} not found`));
    });
  }

  // Mock service calls
  mockServiceCallSuccess() {
    this.callService.mockResolvedValue({
      success: true,
      service_called: true,
      context: {
        id: 'mock-context-id',
        user_id: null
      }
    });
  }

  // Mock service call failure
  mockServiceCallFailure() {
    this.callService.mockRejectedValue(new Error('Service call failed: Entity not available'));
  }

  // Mock system restart
  mockRestartSuccess() {
    this.restartCore.mockResolvedValue({
      success: true,
      message: 'Home Assistant restart initiated'
    });
  }

  // Mock config reload
  mockConfigReloadSuccess() {
    this.reloadConfig.mockResolvedValue({
      success: true,
      reloaded_configs: ['automation', 'script', 'scene', 'group']
    });
  }

  // Mock config reload failure
  mockConfigReloadFailure() {
    this.reloadConfig.mockRejectedValue(new Error('Configuration reload failed: YAML syntax error'));
  }

  // Mock slow response for timeout testing
  mockSlowResponse(delay = 30000) {
    this.checkHealth.mockImplementation(() => {
      return new Promise(resolve => {
        setTimeout(() => {
          resolve({
            status: 'healthy',
            version: '2025.7.0',
            responseTime: delay
          });
        }, delay);
      });
    });
  }

  // Mock authentication failure
  mockAuthenticationFailure() {
    this.checkHealth.mockRejectedValue(new Error('Authentication failed: Invalid access token'));
  }

  // Utility methods
  isHealthy() {
    return this._isHealthy;
  }
  setSystemInfo(info) {
    this._systemInfo = {
      ...this._systemInfo,
      ...info
    };
  }
  addEntity(entityId, state, attributes = {}) {
    this._entities.set(entityId, {
      entity_id: entityId,
      state,
      attributes
    });
  }

  // Reset all mocks and state
  reset() {
    jest.clearAllMocks();
    this._entities.clear();
    this._isHealthy = true;
    this._systemInfo = {
      version: '2025.7.0',
      installation_type: 'Home Assistant Supervised',
      timezone: 'America/New_York'
    };
  }
}
module.exports = {
  MockHomeAssistantAPI
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNb2NrSG9tZUFzc2lzdGFudEFQSSIsImNvbnN0cnVjdG9yIiwiY2hlY2tIZWFsdGgiLCJqZXN0IiwiZm4iLCJ2YWxpZGF0ZUNvbmZpZyIsImdldFN5c3RlbUluZm8iLCJsaXN0RW50aXRpZXMiLCJnZXRFbnRpdHkiLCJjYWxsU2VydmljZSIsImdldEV2ZW50cyIsImdldFN0YXRlcyIsInJlc3RhcnRDb3JlIiwicmVsb2FkQ29uZmlnIiwiX3N5c3RlbUluZm8iLCJ2ZXJzaW9uIiwiaW5zdGFsbGF0aW9uX3R5cGUiLCJ0aW1lem9uZSIsIl9lbnRpdGllcyIsIk1hcCIsIl9pc0hlYWx0aHkiLCJtb2NrSGVhbHRoeVJlc3BvbnNlIiwibW9ja1Jlc29sdmVkVmFsdWUiLCJzdGF0dXMiLCJ1cHRpbWUiLCJsYXN0UmVzdGFydCIsIkRhdGUiLCJub3ciLCJ0b0lTT1N0cmluZyIsImFwaSIsInJlYWNoYWJsZSIsInJlc3BvbnNlVGltZSIsImF1dGhlbnRpY2F0ZWQiLCJzdXBlcnZpc29yIiwiaGVhbHRoeSIsImFkZG9ucyIsInJ1bm5pbmciLCJ0b3RhbCIsImNvcmUiLCJzdGF0ZSIsInNhZmVfbW9kZSIsIm1vY2tVbnJlYWNoYWJsZVJlc3BvbnNlIiwibW9ja1JlamVjdGVkVmFsdWUiLCJFcnJvciIsIm1vY2tDb25maWd1cmF0aW9uRXJyb3IiLCJjb25maWd1cmF0aW9uRXJyb3JzIiwiZXJyb3IiLCJtb2NrVmFsaWRDb25maWdWYWxpZGF0aW9uIiwidmFsaWQiLCJlcnJvcnMiLCJ3YXJuaW5ncyIsInJlc3VsdCIsInByb2Nlc3NpbmdfdGltZSIsIm1vY2tJbnZhbGlkQ29uZmlnVmFsaWRhdGlvbiIsInR5cGUiLCJtZXNzYWdlIiwiZmlsZSIsImxpbmUiLCJjb2x1bW4iLCJtb2NrRW50aXR5TGlzdCIsImVudGl0aWVzIiwiZW50aXR5X2lkIiwiYXR0cmlidXRlcyIsImZyaWVuZGx5X25hbWUiLCJicmlnaHRuZXNzIiwidW5pdF9vZl9tZWFzdXJlbWVudCIsImRldmljZV9jbGFzcyIsImZvckVhY2giLCJlbnRpdHkiLCJzZXQiLCJtb2NrRW50aXR5R2V0IiwiZW50aXR5SWQiLCJtb2NrSW1wbGVtZW50YXRpb24iLCJpZCIsImdldCIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwibW9ja1NlcnZpY2VDYWxsU3VjY2VzcyIsInN1Y2Nlc3MiLCJzZXJ2aWNlX2NhbGxlZCIsImNvbnRleHQiLCJ1c2VyX2lkIiwibW9ja1NlcnZpY2VDYWxsRmFpbHVyZSIsIm1vY2tSZXN0YXJ0U3VjY2VzcyIsIm1vY2tDb25maWdSZWxvYWRTdWNjZXNzIiwicmVsb2FkZWRfY29uZmlncyIsIm1vY2tDb25maWdSZWxvYWRGYWlsdXJlIiwibW9ja1Nsb3dSZXNwb25zZSIsImRlbGF5Iiwic2V0VGltZW91dCIsIm1vY2tBdXRoZW50aWNhdGlvbkZhaWx1cmUiLCJpc0hlYWx0aHkiLCJzZXRTeXN0ZW1JbmZvIiwiaW5mbyIsImFkZEVudGl0eSIsInJlc2V0IiwiY2xlYXJBbGxNb2NrcyIsImNsZWFyIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbImhvbWUtYXNzaXN0YW50LWFwaS5tb2NrLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTW9jayBpbXBsZW1lbnRhdGlvbiBmb3IgSG9tZSBBc3Npc3RhbnQgQVBJXG4gKiBVc2VkIHRvIGlzb2xhdGUgaGVhbHRoIGNoZWNraW5nIGFuZCBkZXBsb3ltZW50IHZhbGlkYXRpb25cbiAqL1xuY2xhc3MgTW9ja0hvbWVBc3Npc3RhbnRBUEkge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmNoZWNrSGVhbHRoID0gamVzdC5mbigpO1xuICAgIHRoaXMudmFsaWRhdGVDb25maWcgPSBqZXN0LmZuKCk7XG4gICAgdGhpcy5nZXRTeXN0ZW1JbmZvID0gamVzdC5mbigpO1xuICAgIHRoaXMubGlzdEVudGl0aWVzID0gamVzdC5mbigpO1xuICAgIHRoaXMuZ2V0RW50aXR5ID0gamVzdC5mbigpO1xuICAgIHRoaXMuY2FsbFNlcnZpY2UgPSBqZXN0LmZuKCk7XG4gICAgdGhpcy5nZXRFdmVudHMgPSBqZXN0LmZuKCk7XG4gICAgdGhpcy5nZXRTdGF0ZXMgPSBqZXN0LmZuKCk7XG4gICAgdGhpcy5yZXN0YXJ0Q29yZSA9IGplc3QuZm4oKTtcbiAgICB0aGlzLnJlbG9hZENvbmZpZyA9IGplc3QuZm4oKTtcbiAgICBcbiAgICAvLyBNb2NrIHN0YXRlXG4gICAgdGhpcy5fc3lzdGVtSW5mbyA9IHtcbiAgICAgIHZlcnNpb246ICcyMDI1LjcuMCcsXG4gICAgICBpbnN0YWxsYXRpb25fdHlwZTogJ0hvbWUgQXNzaXN0YW50IFN1cGVydmlzZWQnLFxuICAgICAgdGltZXpvbmU6ICdBbWVyaWNhL05ld19Zb3JrJ1xuICAgIH07XG4gICAgdGhpcy5fZW50aXRpZXMgPSBuZXcgTWFwKCk7XG4gICAgdGhpcy5faXNIZWFsdGh5ID0gdHJ1ZTtcbiAgfVxuXG4gIC8vIE1vY2sgaGVhbHRoeSBBUEkgcmVzcG9uc2VcbiAgbW9ja0hlYWx0aHlSZXNwb25zZSgpIHtcbiAgICB0aGlzLmNoZWNrSGVhbHRoLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgIHN0YXR1czogJ2hlYWx0aHknLFxuICAgICAgdmVyc2lvbjogJzIwMjUuNy4wJyxcbiAgICAgIHVwdGltZTogODY0MDAsXG4gICAgICBsYXN0UmVzdGFydDogbmV3IERhdGUoRGF0ZS5ub3coKSAtIDg2NDAwMDAwKS50b0lTT1N0cmluZygpLFxuICAgICAgYXBpOiB7XG4gICAgICAgIHJlYWNoYWJsZTogdHJ1ZSxcbiAgICAgICAgcmVzcG9uc2VUaW1lOiA0NSxcbiAgICAgICAgYXV0aGVudGljYXRlZDogdHJ1ZVxuICAgICAgfSxcbiAgICAgIHN1cGVydmlzb3I6IHtcbiAgICAgICAgdmVyc2lvbjogJzIwMjUuMDcuMCcsXG4gICAgICAgIGhlYWx0aHk6IHRydWUsXG4gICAgICAgIGFkZG9uczoge1xuICAgICAgICAgIHJ1bm5pbmc6IDEyLFxuICAgICAgICAgIHRvdGFsOiAxMlxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgY29yZToge1xuICAgICAgICBzdGF0ZTogJ1JVTk5JTkcnLFxuICAgICAgICBzYWZlX21vZGU6IGZhbHNlXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLmdldFN5c3RlbUluZm8ubW9ja1Jlc29sdmVkVmFsdWUodGhpcy5fc3lzdGVtSW5mbyk7XG4gICAgdGhpcy5faXNIZWFsdGh5ID0gdHJ1ZTtcbiAgfVxuXG4gIC8vIE1vY2sgdW5yZWFjaGFibGUgQVBJXG4gIG1vY2tVbnJlYWNoYWJsZVJlc3BvbnNlKCkge1xuICAgIHRoaXMuY2hlY2tIZWFsdGgubW9ja1JlamVjdGVkVmFsdWUoXG4gICAgICBuZXcgRXJyb3IoJ0hvbWUgQXNzaXN0YW50IEFQSSB1bnJlYWNoYWJsZTogRUNPTk5SRUZVU0VEJylcbiAgICApO1xuICAgIHRoaXMuX2lzSGVhbHRoeSA9IGZhbHNlO1xuICB9XG5cbiAgLy8gTW9jayBjb25maWd1cmF0aW9uIGVycm9yIHJlc3BvbnNlXG4gIG1vY2tDb25maWd1cmF0aW9uRXJyb3IoKSB7XG4gICAgdGhpcy5jaGVja0hlYWx0aC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICBzdGF0dXM6ICd1bmhlYWx0aHknLFxuICAgICAgdmVyc2lvbjogJzIwMjUuNy4wJyxcbiAgICAgIGFwaToge1xuICAgICAgICByZWFjaGFibGU6IHRydWUsXG4gICAgICAgIHJlc3BvbnNlVGltZTogMTU2LFxuICAgICAgICBhdXRoZW50aWNhdGVkOiB0cnVlXG4gICAgICB9LFxuICAgICAgY29uZmlndXJhdGlvbkVycm9yczogW1xuICAgICAgICAnSW52YWxpZCBZQU1MIGluIGNvbmZpZ3VyYXRpb24ueWFtbCBhdCBsaW5lIDQyJyxcbiAgICAgICAgJ0ludGVncmF0aW9uIFwiaW52YWxpZF9zZW5zb3JcIiBub3QgZm91bmQnLFxuICAgICAgICAnRHVwbGljYXRlIGVudGl0eV9pZDogc2Vuc29yLnRlbXBlcmF0dXJlJ1xuICAgICAgXSxcbiAgICAgIHN1cGVydmlzb3I6IHtcbiAgICAgICAgdmVyc2lvbjogJzIwMjUuMDcuMCcsXG4gICAgICAgIGhlYWx0aHk6IGZhbHNlLFxuICAgICAgICBlcnJvcjogJ0NvbmZpZ3VyYXRpb24gY2hlY2sgZmFpbGVkJ1xuICAgICAgfSxcbiAgICAgIGNvcmU6IHtcbiAgICAgICAgc3RhdGU6ICdOT1RfUlVOTklORycsXG4gICAgICAgIHNhZmVfbW9kZTogdHJ1ZVxuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMuX2lzSGVhbHRoeSA9IGZhbHNlO1xuICB9XG5cbiAgLy8gTW9jayBzdWNjZXNzZnVsIGNvbmZpZ3VyYXRpb24gdmFsaWRhdGlvblxuICBtb2NrVmFsaWRDb25maWdWYWxpZGF0aW9uKCkge1xuICAgIHRoaXMudmFsaWRhdGVDb25maWcubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgdmFsaWQ6IHRydWUsXG4gICAgICBlcnJvcnM6IFtdLFxuICAgICAgd2FybmluZ3M6IFtdLFxuICAgICAgcmVzdWx0OiAnQ29uZmlndXJhdGlvbiBjaGVjayBzdWNjZXNzZnVsJyxcbiAgICAgIHByb2Nlc3NpbmdfdGltZTogMi40NVxuICAgIH0pO1xuICB9XG5cbiAgLy8gTW9jayBjb25maWd1cmF0aW9uIHZhbGlkYXRpb24gd2l0aCBlcnJvcnNcbiAgbW9ja0ludmFsaWRDb25maWdWYWxpZGF0aW9uKCkge1xuICAgIHRoaXMudmFsaWRhdGVDb25maWcubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgZXJyb3JzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiAneWFtbF9lcnJvcicsXG4gICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgWUFNTCBzeW50YXgnLFxuICAgICAgICAgIGZpbGU6ICdjb25maWd1cmF0aW9uLnlhbWwnLFxuICAgICAgICAgIGxpbmU6IDQyLFxuICAgICAgICAgIGNvbHVtbjogMTVcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHR5cGU6ICdpbnRlZ3JhdGlvbl9lcnJvcicsXG4gICAgICAgICAgbWVzc2FnZTogJ0NvbXBvbmVudCBub3QgZm91bmQ6IGludmFsaWRfY29tcG9uZW50JyxcbiAgICAgICAgICBmaWxlOiAnY29uZmlndXJhdGlvbi55YW1sJyxcbiAgICAgICAgICBsaW5lOiAxNTZcbiAgICAgICAgfVxuICAgICAgXSxcbiAgICAgIHdhcm5pbmdzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiAnZGVwcmVjYXRpb24nLFxuICAgICAgICAgIG1lc3NhZ2U6ICdzZW5zb3IudGVtcGxhdGUgaXMgZGVwcmVjYXRlZCwgdXNlIHRlbXBsYXRlIHNlbnNvciBpbnN0ZWFkJyxcbiAgICAgICAgICBmaWxlOiAnc2Vuc29ycy55YW1sJyxcbiAgICAgICAgICBsaW5lOiAyNVxuICAgICAgICB9XG4gICAgICBdLFxuICAgICAgcmVzdWx0OiAnQ29uZmlndXJhdGlvbiBjaGVjayBmYWlsZWQnLFxuICAgICAgcHJvY2Vzc2luZ190aW1lOiAxLjgyXG4gICAgfSk7XG4gIH1cblxuICAvLyBNb2NrIGVudGl0eSBsaXN0aW5nXG4gIG1vY2tFbnRpdHlMaXN0KCkge1xuICAgIGNvbnN0IGVudGl0aWVzID0gW1xuICAgICAge1xuICAgICAgICBlbnRpdHlfaWQ6ICdsaWdodC5saXZpbmdfcm9vbScsXG4gICAgICAgIHN0YXRlOiAnb24nLFxuICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgZnJpZW5kbHlfbmFtZTogJ0xpdmluZyBSb29tIExpZ2h0JyxcbiAgICAgICAgICBicmlnaHRuZXNzOiAyNTVcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgZW50aXR5X2lkOiAnc2Vuc29yLnRlbXBlcmF0dXJlJyxcbiAgICAgICAgc3RhdGU6ICcyMi41JyxcbiAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgIGZyaWVuZGx5X25hbWU6ICdUZW1wZXJhdHVyZScsXG4gICAgICAgICAgdW5pdF9vZl9tZWFzdXJlbWVudDogJ8KwQydcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgZW50aXR5X2lkOiAnYmluYXJ5X3NlbnNvci5kb29yJyxcbiAgICAgICAgc3RhdGU6ICdvZmYnLFxuICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgZnJpZW5kbHlfbmFtZTogJ0Zyb250IERvb3InLFxuICAgICAgICAgIGRldmljZV9jbGFzczogJ2Rvb3InXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICBdO1xuXG4gICAgdGhpcy5saXN0RW50aXRpZXMubW9ja1Jlc29sdmVkVmFsdWUoZW50aXRpZXMpO1xuICAgIFxuICAgIGVudGl0aWVzLmZvckVhY2goZW50aXR5ID0+IHtcbiAgICAgIHRoaXMuX2VudGl0aWVzLnNldChlbnRpdHkuZW50aXR5X2lkLCBlbnRpdHkpO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gTW9jayBzcGVjaWZpYyBlbnRpdHkgcmV0cmlldmFsXG4gIG1vY2tFbnRpdHlHZXQoZW50aXR5SWQpIHtcbiAgICB0aGlzLmdldEVudGl0eS5tb2NrSW1wbGVtZW50YXRpb24oKGlkKSA9PiB7XG4gICAgICBjb25zdCBlbnRpdHkgPSB0aGlzLl9lbnRpdGllcy5nZXQoaWQpO1xuICAgICAgaWYgKGVudGl0eSkge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGVudGl0eSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKGBFbnRpdHkgJHtpZH0gbm90IGZvdW5kYCkpO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gTW9jayBzZXJ2aWNlIGNhbGxzXG4gIG1vY2tTZXJ2aWNlQ2FsbFN1Y2Nlc3MoKSB7XG4gICAgdGhpcy5jYWxsU2VydmljZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgc2VydmljZV9jYWxsZWQ6IHRydWUsXG4gICAgICBjb250ZXh0OiB7XG4gICAgICAgIGlkOiAnbW9jay1jb250ZXh0LWlkJyxcbiAgICAgICAgdXNlcl9pZDogbnVsbFxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLy8gTW9jayBzZXJ2aWNlIGNhbGwgZmFpbHVyZVxuICBtb2NrU2VydmljZUNhbGxGYWlsdXJlKCkge1xuICAgIHRoaXMuY2FsbFNlcnZpY2UubW9ja1JlamVjdGVkVmFsdWUoXG4gICAgICBuZXcgRXJyb3IoJ1NlcnZpY2UgY2FsbCBmYWlsZWQ6IEVudGl0eSBub3QgYXZhaWxhYmxlJylcbiAgICApO1xuICB9XG5cbiAgLy8gTW9jayBzeXN0ZW0gcmVzdGFydFxuICBtb2NrUmVzdGFydFN1Y2Nlc3MoKSB7XG4gICAgdGhpcy5yZXN0YXJ0Q29yZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgbWVzc2FnZTogJ0hvbWUgQXNzaXN0YW50IHJlc3RhcnQgaW5pdGlhdGVkJ1xuICAgIH0pO1xuICB9XG5cbiAgLy8gTW9jayBjb25maWcgcmVsb2FkXG4gIG1vY2tDb25maWdSZWxvYWRTdWNjZXNzKCkge1xuICAgIHRoaXMucmVsb2FkQ29uZmlnLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICByZWxvYWRlZF9jb25maWdzOiBbXG4gICAgICAgICdhdXRvbWF0aW9uJyxcbiAgICAgICAgJ3NjcmlwdCcsIFxuICAgICAgICAnc2NlbmUnLFxuICAgICAgICAnZ3JvdXAnXG4gICAgICBdXG4gICAgfSk7XG4gIH1cblxuICAvLyBNb2NrIGNvbmZpZyByZWxvYWQgZmFpbHVyZVxuICBtb2NrQ29uZmlnUmVsb2FkRmFpbHVyZSgpIHtcbiAgICB0aGlzLnJlbG9hZENvbmZpZy5tb2NrUmVqZWN0ZWRWYWx1ZShcbiAgICAgIG5ldyBFcnJvcignQ29uZmlndXJhdGlvbiByZWxvYWQgZmFpbGVkOiBZQU1MIHN5bnRheCBlcnJvcicpXG4gICAgKTtcbiAgfVxuXG4gIC8vIE1vY2sgc2xvdyByZXNwb25zZSBmb3IgdGltZW91dCB0ZXN0aW5nXG4gIG1vY2tTbG93UmVzcG9uc2UoZGVsYXkgPSAzMDAwMCkge1xuICAgIHRoaXMuY2hlY2tIZWFsdGgubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHtcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICByZXNvbHZlKHtcbiAgICAgICAgICAgIHN0YXR1czogJ2hlYWx0aHknLFxuICAgICAgICAgICAgdmVyc2lvbjogJzIwMjUuNy4wJyxcbiAgICAgICAgICAgIHJlc3BvbnNlVGltZTogZGVsYXlcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSwgZGVsYXkpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICAvLyBNb2NrIGF1dGhlbnRpY2F0aW9uIGZhaWx1cmVcbiAgbW9ja0F1dGhlbnRpY2F0aW9uRmFpbHVyZSgpIHtcbiAgICB0aGlzLmNoZWNrSGVhbHRoLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgbmV3IEVycm9yKCdBdXRoZW50aWNhdGlvbiBmYWlsZWQ6IEludmFsaWQgYWNjZXNzIHRva2VuJylcbiAgICApO1xuICB9XG5cbiAgLy8gVXRpbGl0eSBtZXRob2RzXG4gIGlzSGVhbHRoeSgpIHtcbiAgICByZXR1cm4gdGhpcy5faXNIZWFsdGh5O1xuICB9XG5cbiAgc2V0U3lzdGVtSW5mbyhpbmZvKSB7XG4gICAgdGhpcy5fc3lzdGVtSW5mbyA9IHsgLi4udGhpcy5fc3lzdGVtSW5mbywgLi4uaW5mbyB9O1xuICB9XG5cbiAgYWRkRW50aXR5KGVudGl0eUlkLCBzdGF0ZSwgYXR0cmlidXRlcyA9IHt9KSB7XG4gICAgdGhpcy5fZW50aXRpZXMuc2V0KGVudGl0eUlkLCB7XG4gICAgICBlbnRpdHlfaWQ6IGVudGl0eUlkLFxuICAgICAgc3RhdGUsXG4gICAgICBhdHRyaWJ1dGVzXG4gICAgfSk7XG4gIH1cblxuICAvLyBSZXNldCBhbGwgbW9ja3MgYW5kIHN0YXRlXG4gIHJlc2V0KCkge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIHRoaXMuX2VudGl0aWVzLmNsZWFyKCk7XG4gICAgdGhpcy5faXNIZWFsdGh5ID0gdHJ1ZTtcbiAgICB0aGlzLl9zeXN0ZW1JbmZvID0ge1xuICAgICAgdmVyc2lvbjogJzIwMjUuNy4wJyxcbiAgICAgIGluc3RhbGxhdGlvbl90eXBlOiAnSG9tZSBBc3Npc3RhbnQgU3VwZXJ2aXNlZCcsXG4gICAgICB0aW1lem9uZTogJ0FtZXJpY2EvTmV3X1lvcmsnXG4gICAgfTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHsgTW9ja0hvbWVBc3Npc3RhbnRBUEkgfTsiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTUEsb0JBQW9CLENBQUM7RUFDekJDLFdBQVdBLENBQUEsRUFBRztJQUNaLElBQUksQ0FBQ0MsV0FBVyxHQUFHQyxJQUFJLENBQUNDLEVBQUUsQ0FBQyxDQUFDO0lBQzVCLElBQUksQ0FBQ0MsY0FBYyxHQUFHRixJQUFJLENBQUNDLEVBQUUsQ0FBQyxDQUFDO0lBQy9CLElBQUksQ0FBQ0UsYUFBYSxHQUFHSCxJQUFJLENBQUNDLEVBQUUsQ0FBQyxDQUFDO0lBQzlCLElBQUksQ0FBQ0csWUFBWSxHQUFHSixJQUFJLENBQUNDLEVBQUUsQ0FBQyxDQUFDO0lBQzdCLElBQUksQ0FBQ0ksU0FBUyxHQUFHTCxJQUFJLENBQUNDLEVBQUUsQ0FBQyxDQUFDO0lBQzFCLElBQUksQ0FBQ0ssV0FBVyxHQUFHTixJQUFJLENBQUNDLEVBQUUsQ0FBQyxDQUFDO0lBQzVCLElBQUksQ0FBQ00sU0FBUyxHQUFHUCxJQUFJLENBQUNDLEVBQUUsQ0FBQyxDQUFDO0lBQzFCLElBQUksQ0FBQ08sU0FBUyxHQUFHUixJQUFJLENBQUNDLEVBQUUsQ0FBQyxDQUFDO0lBQzFCLElBQUksQ0FBQ1EsV0FBVyxHQUFHVCxJQUFJLENBQUNDLEVBQUUsQ0FBQyxDQUFDO0lBQzVCLElBQUksQ0FBQ1MsWUFBWSxHQUFHVixJQUFJLENBQUNDLEVBQUUsQ0FBQyxDQUFDOztJ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