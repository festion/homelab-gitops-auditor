0f11b13267c962d8302e65d7c2d91b9e
/**
 * Mock implementation for Backup Manager
 * Used to isolate deployment and recovery components during testing
 */
class MockBackupManager {
  constructor() {
    this.createPreDeploymentBackup = jest.fn();
    this.createPostDeploymentBackup = jest.fn();
    this.rollbackDeployment = jest.fn();
    this.validateBackup = jest.fn();
    this.listBackups = jest.fn();
    this.deleteBackup = jest.fn();
    this.getBackupMetadata = jest.fn();
    this.estimateBackupSize = jest.fn();

    // Internal state tracking
    this._backups = new Map();
    this._currentBackupId = null;
  }

  // Mock successful backup creation
  mockBackupSuccess() {
    const backupId = `backup-${Date.now()}`;
    this._currentBackupId = backupId;
    this.createPreDeploymentBackup.mockResolvedValue({
      success: true,
      backupId,
      path: `/backup/${backupId}.tar.gz`,
      size: 2048576,
      duration: 15000,
      timestamp: new Date().toISOString(),
      metadata: {
        configFiles: 156,
        entityStates: 234,
        databaseSize: 1048576
      }
    });
    this._backups.set(backupId, {
      id: backupId,
      type: 'pre-deployment',
      status: 'completed',
      size: 2048576,
      created: new Date()
    });
  }

  // Mock backup failure
  mockBackupFailure(errorMessage = 'Insufficient disk space') {
    this.createPreDeploymentBackup.mockRejectedValue(new Error(`Backup creation failed: ${errorMessage}`));
  }

  // Mock slow backup for testing timeouts
  mockSlowBackup(duration = 30000) {
    this.createPreDeploymentBackup.mockImplementation(() => {
      return new Promise(resolve => {
        setTimeout(() => {
          const backupId = `backup-${Date.now()}`;
          resolve({
            success: true,
            backupId,
            path: `/backup/${backupId}.tar.gz`,
            size: 2048576,
            duration,
            timestamp: new Date().toISOString()
          });
        }, duration);
      });
    });
  }

  // Mock successful rollback
  mockRollbackSuccess() {
    this.rollbackDeployment.mockResolvedValue({
      success: true,
      backupId: this._currentBackupId,
      restoredFiles: 156,
      duration: 12000,
      timestamp: new Date().toISOString(),
      details: {
        configurationRestored: true,
        databaseRestored: true,
        entityStatesRestored: true
      }
    });
  }

  // Mock rollback failure
  mockRollbackFailure(errorMessage = 'Backup file corrupted') {
    this.rollbackDeployment.mockRejectedValue(new Error(`Rollback failed: ${errorMessage}`));
  }

  // Mock backup validation success
  mockValidationSuccess() {
    this.validateBackup.mockResolvedValue({
      valid: true,
      integrity: 'verified',
      checksumMatches: true,
      readableFiles: 156,
      corruptedFiles: 0,
      estimatedRestoreTime: 12000
    });
  }

  // Mock backup validation failure
  mockValidationFailure() {
    this.validateBackup.mockResolvedValue({
      valid: false,
      integrity: 'corrupted',
      checksumMatches: false,
      readableFiles: 143,
      corruptedFiles: 13,
      errors: ['Checksum mismatch for configuration.yaml', 'Database file appears truncated', 'Missing automation files']
    });
  }

  // Mock backup listing
  mockBackupList() {
    const backups = [{
      id: 'backup-20250713-090000',
      type: 'pre-deployment',
      status: 'completed',
      size: 2048576,
      created: new Date('2025-07-13T09:00:00Z'),
      deploymentId: 'deploy-20250713-090030'
    }, {
      id: 'backup-20250713-080000',
      type: 'scheduled',
      status: 'completed',
      size: 1987654,
      created: new Date('2025-07-13T08:00:00Z')
    }, {
      id: 'backup-20250712-210000',
      type: 'manual',
      status: 'completed',
      size: 2156789,
      created: new Date('2025-07-12T21:00:00Z')
    }];
    this.listBackups.mockResolvedValue({
      backups,
      total: backups.length,
      totalSize: backups.reduce((sum, b) => sum + b.size, 0)
    });
    backups.forEach(backup => {
      this._backups.set(backup.id, backup);
    });
  }

  // Mock backup metadata retrieval
  mockBackupMetadata(backupId) {
    this.getBackupMetadata.mockResolvedValue({
      id: backupId,
      metadata: {
        homeAssistantVersion: '2025.7.0',
        configFiles: 156,
        entityStates: 234,
        automations: 15,
        scripts: 8,
        scenes: 12,
        databaseSize: 1048576,
        addons: ['ESPHome', 'Node-RED', 'Mosquitto broker'],
        integrations: ['mqtt', 'homekit', 'google_assistant', 'alexa']
      },
      creation: {
        timestamp: new Date().toISOString(),
        duration: 15000,
        trigger: 'pre-deployment'
      }
    });
  }

  // Mock backup size estimation
  mockSizeEstimation() {
    this.estimateBackupSize.mockResolvedValue({
      estimatedSize: 2097152,
      breakdown: {
        configuration: 524288,
        database: 1048576,
        customComponents: 262144,
        www: 131072,
        addons: 131072
      },
      estimatedDuration: 15000
    });
  }

  // Mock backup deletion
  mockDeleteSuccess() {
    this.deleteBackup.mockResolvedValue({
      success: true,
      deletedSize: 2048576,
      freedSpace: 2048576
    });
  }

  // Mock delete failure
  mockDeleteFailure() {
    this.deleteBackup.mockRejectedValue(new Error('Backup deletion failed: File is locked'));
  }

  // Utility methods
  getCurrentBackupId() {
    return this._currentBackupId;
  }
  hasBackup(backupId) {
    return this._backups.has(backupId);
  }
  getBackupCount() {
    return this._backups.size;
  }

  // Reset all mocks and state
  reset() {
    jest.clearAllMocks();
    this._backups.clear();
    this._currentBackupId = null;
  }
}
module.exports = {
  MockBackupManager
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNb2NrQmFja3VwTWFuYWdlciIsImNvbnN0cnVjdG9yIiwiY3JlYXRlUHJlRGVwbG95bWVudEJhY2t1cCIsImplc3QiLCJmbiIsImNyZWF0ZVBvc3REZXBsb3ltZW50QmFja3VwIiwicm9sbGJhY2tEZXBsb3ltZW50IiwidmFsaWRhdGVCYWNrdXAiLCJsaXN0QmFja3VwcyIsImRlbGV0ZUJhY2t1cCIsImdldEJhY2t1cE1ldGFkYXRhIiwiZXN0aW1hdGVCYWNrdXBTaXplIiwiX2JhY2t1cHMiLCJNYXAiLCJfY3VycmVudEJhY2t1cElkIiwibW9ja0JhY2t1cFN1Y2Nlc3MiLCJiYWNrdXBJZCIsIkRhdGUiLCJub3ciLCJtb2NrUmVzb2x2ZWRWYWx1ZSIsInN1Y2Nlc3MiLCJwYXRoIiwic2l6ZSIsImR1cmF0aW9uIiwidGltZXN0YW1wIiwidG9JU09TdHJpbmciLCJtZXRhZGF0YSIsImNvbmZpZ0ZpbGVzIiwiZW50aXR5U3RhdGVzIiwiZGF0YWJhc2VTaXplIiwic2V0IiwiaWQiLCJ0eXBlIiwic3RhdHVzIiwiY3JlYXRlZCIsIm1vY2tCYWNrdXBGYWlsdXJlIiwiZXJyb3JNZXNzYWdlIiwibW9ja1JlamVjdGVkVmFsdWUiLCJFcnJvciIsIm1vY2tTbG93QmFja3VwIiwibW9ja0ltcGxlbWVudGF0aW9uIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0IiwibW9ja1JvbGxiYWNrU3VjY2VzcyIsInJlc3RvcmVkRmlsZXMiLCJkZXRhaWxzIiwiY29uZmlndXJhdGlvblJlc3RvcmVkIiwiZGF0YWJhc2VSZXN0b3JlZCIsImVudGl0eVN0YXRlc1Jlc3RvcmVkIiwibW9ja1JvbGxiYWNrRmFpbHVyZSIsIm1vY2tWYWxpZGF0aW9uU3VjY2VzcyIsInZhbGlkIiwiaW50ZWdyaXR5IiwiY2hlY2tzdW1NYXRjaGVzIiwicmVhZGFibGVGaWxlcyIsImNvcnJ1cHRlZEZpbGVzIiwiZXN0aW1hdGVkUmVzdG9yZVRpbWUiLCJtb2NrVmFsaWRhdGlvbkZhaWx1cmUiLCJlcnJvcnMiLCJtb2NrQmFja3VwTGlzdCIsImJhY2t1cHMiLCJkZXBsb3ltZW50SWQiLCJ0b3RhbCIsImxlbmd0aCIsInRvdGFsU2l6ZSIsInJlZHVjZSIsInN1bSIsImIiLCJmb3JFYWNoIiwiYmFja3VwIiwibW9ja0JhY2t1cE1ldGFkYXRhIiwiaG9tZUFzc2lzdGFudFZlcnNpb24iLCJhdXRvbWF0aW9ucyIsInNjcmlwdHMiLCJzY2VuZXMiLCJhZGRvbnMiLCJpbnRlZ3JhdGlvbnMiLCJjcmVhdGlvbiIsInRyaWdnZXIiLCJtb2NrU2l6ZUVzdGltYXRpb24iLCJlc3RpbWF0ZWRTaXplIiwiYnJlYWtkb3duIiwiY29uZmlndXJhdGlvbiIsImRhdGFiYXNlIiwiY3VzdG9tQ29tcG9uZW50cyIsInd3dyIsImVzdGltYXRlZER1cmF0aW9uIiwibW9ja0RlbGV0ZVN1Y2Nlc3MiLCJkZWxldGVkU2l6ZSIsImZyZWVkU3BhY2UiLCJtb2NrRGVsZXRlRmFpbHVyZSIsImdldEN1cnJlbnRCYWNrdXBJZCIsImhhc0JhY2t1cCIsImhhcyIsImdldEJhY2t1cENvdW50IiwicmVzZXQiLCJjbGVhckFsbE1vY2tzIiwiY2xlYXIiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiYmFja3VwLW1hbmFnZXIubW9jay5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIE1vY2sgaW1wbGVtZW50YXRpb24gZm9yIEJhY2t1cCBNYW5hZ2VyXG4gKiBVc2VkIHRvIGlzb2xhdGUgZGVwbG95bWVudCBhbmQgcmVjb3ZlcnkgY29tcG9uZW50cyBkdXJpbmcgdGVzdGluZ1xuICovXG5jbGFzcyBNb2NrQmFja3VwTWFuYWdlciB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuY3JlYXRlUHJlRGVwbG95bWVudEJhY2t1cCA9IGplc3QuZm4oKTtcbiAgICB0aGlzLmNyZWF0ZVBvc3REZXBsb3ltZW50QmFja3VwID0gamVzdC5mbigpO1xuICAgIHRoaXMucm9sbGJhY2tEZXBsb3ltZW50ID0gamVzdC5mbigpO1xuICAgIHRoaXMudmFsaWRhdGVCYWNrdXAgPSBqZXN0LmZuKCk7XG4gICAgdGhpcy5saXN0QmFja3VwcyA9IGplc3QuZm4oKTtcbiAgICB0aGlzLmRlbGV0ZUJhY2t1cCA9IGplc3QuZm4oKTtcbiAgICB0aGlzLmdldEJhY2t1cE1ldGFkYXRhID0gamVzdC5mbigpO1xuICAgIHRoaXMuZXN0aW1hdGVCYWNrdXBTaXplID0gamVzdC5mbigpO1xuICAgIFxuICAgIC8vIEludGVybmFsIHN0YXRlIHRyYWNraW5nXG4gICAgdGhpcy5fYmFja3VwcyA9IG5ldyBNYXAoKTtcbiAgICB0aGlzLl9jdXJyZW50QmFja3VwSWQgPSBudWxsO1xuICB9XG5cbiAgLy8gTW9jayBzdWNjZXNzZnVsIGJhY2t1cCBjcmVhdGlvblxuICBtb2NrQmFja3VwU3VjY2VzcygpIHtcbiAgICBjb25zdCBiYWNrdXBJZCA9IGBiYWNrdXAtJHtEYXRlLm5vdygpfWA7XG4gICAgdGhpcy5fY3VycmVudEJhY2t1cElkID0gYmFja3VwSWQ7XG4gICAgXG4gICAgdGhpcy5jcmVhdGVQcmVEZXBsb3ltZW50QmFja3VwLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBiYWNrdXBJZCxcbiAgICAgIHBhdGg6IGAvYmFja3VwLyR7YmFja3VwSWR9LnRhci5nemAsXG4gICAgICBzaXplOiAyMDQ4NTc2LFxuICAgICAgZHVyYXRpb246IDE1MDAwLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICBtZXRhZGF0YToge1xuICAgICAgICBjb25maWdGaWxlczogMTU2LFxuICAgICAgICBlbnRpdHlTdGF0ZXM6IDIzNCxcbiAgICAgICAgZGF0YWJhc2VTaXplOiAxMDQ4NTc2XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLl9iYWNrdXBzLnNldChiYWNrdXBJZCwge1xuICAgICAgaWQ6IGJhY2t1cElkLFxuICAgICAgdHlwZTogJ3ByZS1kZXBsb3ltZW50JyxcbiAgICAgIHN0YXR1czogJ2NvbXBsZXRlZCcsXG4gICAgICBzaXplOiAyMDQ4NTc2LFxuICAgICAgY3JlYXRlZDogbmV3IERhdGUoKVxuICAgIH0pO1xuICB9XG5cbiAgLy8gTW9jayBiYWNrdXAgZmFpbHVyZVxuICBtb2NrQmFja3VwRmFpbHVyZShlcnJvck1lc3NhZ2UgPSAnSW5zdWZmaWNpZW50IGRpc2sgc3BhY2UnKSB7XG4gICAgdGhpcy5jcmVhdGVQcmVEZXBsb3ltZW50QmFja3VwLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgbmV3IEVycm9yKGBCYWNrdXAgY3JlYXRpb24gZmFpbGVkOiAke2Vycm9yTWVzc2FnZX1gKVxuICAgICk7XG4gIH1cblxuICAvLyBNb2NrIHNsb3cgYmFja3VwIGZvciB0ZXN0aW5nIHRpbWVvdXRzXG4gIG1vY2tTbG93QmFja3VwKGR1cmF0aW9uID0gMzAwMDApIHtcbiAgICB0aGlzLmNyZWF0ZVByZURlcGxveW1lbnRCYWNrdXAubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHtcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICBjb25zdCBiYWNrdXBJZCA9IGBiYWNrdXAtJHtEYXRlLm5vdygpfWA7XG4gICAgICAgICAgcmVzb2x2ZSh7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgYmFja3VwSWQsXG4gICAgICAgICAgICBwYXRoOiBgL2JhY2t1cC8ke2JhY2t1cElkfS50YXIuZ3pgLFxuICAgICAgICAgICAgc2l6ZTogMjA0ODU3NixcbiAgICAgICAgICAgIGR1cmF0aW9uLFxuICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSwgZHVyYXRpb24pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICAvLyBNb2NrIHN1Y2Nlc3NmdWwgcm9sbGJhY2tcbiAgbW9ja1JvbGxiYWNrU3VjY2VzcygpIHtcbiAgICB0aGlzLnJvbGxiYWNrRGVwbG95bWVudC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgYmFja3VwSWQ6IHRoaXMuX2N1cnJlbnRCYWNrdXBJZCxcbiAgICAgIHJlc3RvcmVkRmlsZXM6IDE1NixcbiAgICAgIGR1cmF0aW9uOiAxMjAwMCxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgZGV0YWlsczoge1xuICAgICAgICBjb25maWd1cmF0aW9uUmVzdG9yZWQ6IHRydWUsXG4gICAgICAgIGRhdGFiYXNlUmVzdG9yZWQ6IHRydWUsXG4gICAgICAgIGVudGl0eVN0YXRlc1Jlc3RvcmVkOiB0cnVlXG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvLyBNb2NrIHJvbGxiYWNrIGZhaWx1cmVcbiAgbW9ja1JvbGxiYWNrRmFpbHVyZShlcnJvck1lc3NhZ2UgPSAnQmFja3VwIGZpbGUgY29ycnVwdGVkJykge1xuICAgIHRoaXMucm9sbGJhY2tEZXBsb3ltZW50Lm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgbmV3IEVycm9yKGBSb2xsYmFjayBmYWlsZWQ6ICR7ZXJyb3JNZXNzYWdlfWApXG4gICAgKTtcbiAgfVxuXG4gIC8vIE1vY2sgYmFja3VwIHZhbGlkYXRpb24gc3VjY2Vzc1xuICBtb2NrVmFsaWRhdGlvblN1Y2Nlc3MoKSB7XG4gICAgdGhpcy52YWxpZGF0ZUJhY2t1cC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICB2YWxpZDogdHJ1ZSxcbiAgICAgIGludGVncml0eTogJ3ZlcmlmaWVkJyxcbiAgICAgIGNoZWNrc3VtTWF0Y2hlczogdHJ1ZSxcbiAgICAgIHJlYWRhYmxlRmlsZXM6IDE1NixcbiAgICAgIGNvcnJ1cHRlZEZpbGVzOiAwLFxuICAgICAgZXN0aW1hdGVkUmVzdG9yZVRpbWU6IDEyMDAwXG4gICAgfSk7XG4gIH1cblxuICAvLyBNb2NrIGJhY2t1cCB2YWxpZGF0aW9uIGZhaWx1cmVcbiAgbW9ja1ZhbGlkYXRpb25GYWlsdXJlKCkge1xuICAgIHRoaXMudmFsaWRhdGVCYWNrdXAubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgaW50ZWdyaXR5OiAnY29ycnVwdGVkJyxcbiAgICAgIGNoZWNrc3VtTWF0Y2hlczogZmFsc2UsXG4gICAgICByZWFkYWJsZUZpbGVzOiAxNDMsXG4gICAgICBjb3JydXB0ZWRGaWxlczogMTMsXG4gICAgICBlcnJvcnM6IFtcbiAgICAgICAgJ0NoZWNrc3VtIG1pc21hdGNoIGZvciBjb25maWd1cmF0aW9uLnlhbWwnLFxuICAgICAgICAnRGF0YWJhc2UgZmlsZSBhcHBlYXJzIHRydW5jYXRlZCcsXG4gICAgICAgICdNaXNzaW5nIGF1dG9tYXRpb24gZmlsZXMnXG4gICAgICBdXG4gICAgfSk7XG4gIH1cblxuICAvLyBNb2NrIGJhY2t1cCBsaXN0aW5nXG4gIG1vY2tCYWNrdXBMaXN0KCkge1xuICAgIGNvbnN0IGJhY2t1cHMgPSBbXG4gICAgICB7XG4gICAgICAgIGlkOiAnYmFja3VwLTIwMjUwNzEzLTA5MDAwMCcsXG4gICAgICAgIHR5cGU6ICdwcmUtZGVwbG95bWVudCcsXG4gICAgICAgIHN0YXR1czogJ2NvbXBsZXRlZCcsXG4gICAgICAgIHNpemU6IDIwNDg1NzYsXG4gICAgICAgIGNyZWF0ZWQ6IG5ldyBEYXRlKCcyMDI1LTA3LTEzVDA5OjAwOjAwWicpLFxuICAgICAgICBkZXBsb3ltZW50SWQ6ICdkZXBsb3ktMjAyNTA3MTMtMDkwMDMwJ1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgaWQ6ICdiYWNrdXAtMjAyNTA3MTMtMDgwMDAwJyxcbiAgICAgICAgdHlwZTogJ3NjaGVkdWxlZCcsXG4gICAgICAgIHN0YXR1czogJ2NvbXBsZXRlZCcsXG4gICAgICAgIHNpemU6IDE5ODc2NTQsXG4gICAgICAgIGNyZWF0ZWQ6IG5ldyBEYXRlKCcyMDI1LTA3LTEzVDA4OjAwOjAwWicpXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBpZDogJ2JhY2t1cC0yMDI1MDcxMi0yMTAwMDAnLFxuICAgICAgICB0eXBlOiAnbWFudWFsJyxcbiAgICAgICAgc3RhdHVzOiAnY29tcGxldGVkJyxcbiAgICAgICAgc2l6ZTogMjE1Njc4OSxcbiAgICAgICAgY3JlYXRlZDogbmV3IERhdGUoJzIwMjUtMDctMTJUMjE6MDA6MDBaJylcbiAgICAgIH1cbiAgICBdO1xuXG4gICAgdGhpcy5saXN0QmFja3Vwcy5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICBiYWNrdXBzLFxuICAgICAgdG90YWw6IGJhY2t1cHMubGVuZ3RoLFxuICAgICAgdG90YWxTaXplOiBiYWNrdXBzLnJlZHVjZSgoc3VtLCBiKSA9PiBzdW0gKyBiLnNpemUsIDApXG4gICAgfSk7XG5cbiAgICBiYWNrdXBzLmZvckVhY2goYmFja3VwID0+IHtcbiAgICAgIHRoaXMuX2JhY2t1cHMuc2V0KGJhY2t1cC5pZCwgYmFja3VwKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIE1vY2sgYmFja3VwIG1ldGFkYXRhIHJldHJpZXZhbFxuICBtb2NrQmFja3VwTWV0YWRhdGEoYmFja3VwSWQpIHtcbiAgICB0aGlzLmdldEJhY2t1cE1ldGFkYXRhLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgIGlkOiBiYWNrdXBJZCxcbiAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgIGhvbWVBc3Npc3RhbnRWZXJzaW9uOiAnMjAyNS43LjAnLFxuICAgICAgICBjb25maWdGaWxlczogMTU2LFxuICAgICAgICBlbnRpdHlTdGF0ZXM6IDIzNCxcbiAgICAgICAgYXV0b21hdGlvbnM6IDE1LFxuICAgICAgICBzY3JpcHRzOiA4LFxuICAgICAgICBzY2VuZXM6IDEyLFxuICAgICAgICBkYXRhYmFzZVNpemU6IDEwNDg1NzYsXG4gICAgICAgIGFkZG9uczogW1xuICAgICAgICAgICdFU1BIb21lJyxcbiAgICAgICAgICAnTm9kZS1SRUQnLFxuICAgICAgICAgICdNb3NxdWl0dG8gYnJva2VyJ1xuICAgICAgICBdLFxuICAgICAgICBpbnRlZ3JhdGlvbnM6IFtcbiAgICAgICAgICAnbXF0dCcsXG4gICAgICAgICAgJ2hvbWVraXQnLFxuICAgICAgICAgICdnb29nbGVfYXNzaXN0YW50JyxcbiAgICAgICAgICAnYWxleGEnXG4gICAgICAgIF1cbiAgICAgIH0sXG4gICAgICBjcmVhdGlvbjoge1xuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgZHVyYXRpb246IDE1MDAwLFxuICAgICAgICB0cmlnZ2VyOiAncHJlLWRlcGxveW1lbnQnXG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvLyBNb2NrIGJhY2t1cCBzaXplIGVzdGltYXRpb25cbiAgbW9ja1NpemVFc3RpbWF0aW9uKCkge1xuICAgIHRoaXMuZXN0aW1hdGVCYWNrdXBTaXplLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgIGVzdGltYXRlZFNpemU6IDIwOTcxNTIsXG4gICAgICBicmVha2Rvd246IHtcbiAgICAgICAgY29uZmlndXJhdGlvbjogNTI0Mjg4LFxuICAgICAgICBkYXRhYmFzZTogMTA0ODU3NixcbiAgICAgICAgY3VzdG9tQ29tcG9uZW50czogMjYyMTQ0LFxuICAgICAgICB3d3c6IDEzMTA3MixcbiAgICAgICAgYWRkb25zOiAxMzEwNzJcbiAgICAgIH0sXG4gICAgICBlc3RpbWF0ZWREdXJhdGlvbjogMTUwMDBcbiAgICB9KTtcbiAgfVxuXG4gIC8vIE1vY2sgYmFja3VwIGRlbGV0aW9uXG4gIG1vY2tEZWxldGVTdWNjZXNzKCkge1xuICAgIHRoaXMuZGVsZXRlQmFja3VwLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkZWxldGVkU2l6ZTogMjA0ODU3NixcbiAgICAgIGZyZWVkU3BhY2U6IDIwNDg1NzZcbiAgICB9KTtcbiAgfVxuXG4gIC8vIE1vY2sgZGVsZXRlIGZhaWx1cmVcbiAgbW9ja0RlbGV0ZUZhaWx1cmUoKSB7XG4gICAgdGhpcy5kZWxldGVCYWNrdXAubW9ja1JlamVjdGVkVmFsdWUoXG4gICAgICBuZXcgRXJyb3IoJ0JhY2t1cCBkZWxldGlvbiBmYWlsZWQ6IEZpbGUgaXMgbG9ja2VkJylcbiAgICApO1xuICB9XG5cbiAgLy8gVXRpbGl0eSBtZXRob2RzXG4gIGdldEN1cnJlbnRCYWNrdXBJZCgpIHtcbiAgICByZXR1cm4gdGhpcy5fY3VycmVudEJhY2t1cElkO1xuICB9XG5cbiAgaGFzQmFja3VwKGJhY2t1cElkKSB7XG4gICAgcmV0dXJuIHRoaXMuX2JhY2t1cHMuaGFzKGJhY2t1cElkKTtcbiAgfVxuXG4gIGdldEJhY2t1cENvdW50KCkge1xuICAgIHJldHVybiB0aGlzLl9iYWNrdXBzLnNpemU7XG4gIH1cblxuICAvLyBSZXNldCBhbGwgbW9ja3MgYW5kIHN0YXRlXG4gIHJlc2V0KCkge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIHRoaXMuX2JhY2t1cHMuY2xlYXIoKTtcbiAgICB0aGlzLl9jdXJyZW50QmFja3VwSWQgPSBudWxsO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0geyBNb2NrQmFja3VwTWFuYWdlciB9OyJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNQSxpQkFBaUIsQ0FBQztFQUN0QkMsV0FBV0EsQ0FBQSxFQUFHO0lBQ1osSUFBSSxDQUFDQyx5QkFBeUIsR0FBR0MsSUFBSSxDQUFDQyxFQUFFLENBQUMsQ0FBQztJQUMxQyxJQUFJLENBQUNDLDBCQUEwQixHQUFHRixJQUFJLENBQUNDLEVBQUUsQ0FBQyxDQUFDO0lBQzNDLElBQUksQ0FBQ0Usa0JBQWtCLEdBQUdILElBQUksQ0FBQ0MsRUFBRSxDQUFDLENBQUM7SUFDbkMsSUFBSSxDQUFDRyxjQUFjLEdBQUdKLElBQUksQ0FBQ0MsRUFBRSxDQUFDLENBQUM7SUFDL0IsSUFBSSxDQUFDSSxXQUFXLEdBQUdMLElBQUksQ0FBQ0MsRUFBRSxDQUFDLENBQUM7SUFDNUIs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