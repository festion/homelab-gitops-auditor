a50e2511f36978aa7bb6397d3e451fb9
const {
  EventEmitter
} = require('events');
class DeploymentQueue extends EventEmitter {
  constructor(options = {}) {
    super();
    this.logger = options.logger;
    this.deploymentRepository = options.deploymentRepository;
    this.maxQueueSize = options.maxQueueSize || 100;
    this.processingTimeout = options.processingTimeout || 300000; // 5 minutes

    this.queue = [];
    this.processing = new Set();
    this.priorities = {
      'low': 1,
      'normal': 2,
      'high': 3,
      'urgent': 4
    };
  }
  async enqueue(deployment) {
    if (this.queue.length >= this.maxQueueSize) {
      throw new Error(`Queue is full (max: ${this.maxQueueSize})`);
    }
    if (!deployment.id) {
      throw new Error('Deployment must have an ID');
    }
    if (this.queue.find(item => item.id === deployment.id)) {
      throw new Error(`Deployment ${deployment.id} is already queued`);
    }
    if (this.processing.has(deployment.id)) {
      throw new Error(`Deployment ${deployment.id} is currently being processed`);
    }
    const queueItem = {
      ...deployment,
      queuedAt: new Date().toISOString(),
      priority: deployment.priority || 'normal',
      retryCount: deployment.retryCount || 0,
      maxRetries: deployment.maxRetries || 3
    };
    this.queue.push(queueItem);
    this.sortQueue();
    this.logger?.info('Deployment queued', {
      deploymentId: deployment.id,
      priority: queueItem.priority,
      queueLength: this.queue.length,
      position: this.getQueuePosition(deployment.id)
    });
    this.emit('queued', queueItem);
    return queueItem;
  }
  async dequeue() {
    if (this.queue.length === 0) {
      return null;
    }
    const deployment = this.queue.shift();
    this.processing.add(deployment.id);
    this.logger?.info('Deployment dequeued', {
      deploymentId: deployment.id,
      priority: deployment.priority,
      queuedAt: deployment.queuedAt,
      waitTime: Date.now() - new Date(deployment.queuedAt).getTime()
    });
    this.emit('dequeued', deployment);
    setTimeout(() => {
      if (this.processing.has(deployment.id)) {
        this.logger?.warn('Deployment processing timeout', {
          deploymentId: deployment.id,
          timeout: this.processingTimeout
        });
        this.processing.delete(deployment.id);
        this.emit('timeout', deployment);
      }
    }, this.processingTimeout);
    return deployment;
  }
  markCompleted(deploymentId) {
    if (this.processing.has(deploymentId)) {
      this.processing.delete(deploymentId);
      this.logger?.info('Deployment marked as completed', {
        deploymentId,
        processingCount: this.processing.size
      });
      this.emit('completed', deploymentId);
      return true;
    }
    return false;
  }
  markFailed(deploymentId, error = null) {
    if (this.processing.has(deploymentId)) {
      this.processing.delete(deploymentId);
      this.logger?.info('Deployment marked as failed', {
        deploymentId,
        error: error?.message,
        processingCount: this.processing.size
      });
      this.emit('failed', {
        deploymentId,
        error
      });
      return true;
    }
    return false;
  }
  async retry(deploymentId) {
    const deployment = this.queue.find(item => item.id === deploymentId) || [...this.processing].find(id => id === deploymentId);
    if (!deployment) {
      const repoDeployment = await this.deploymentRepository?.getDeployment(deploymentId);
      if (!repoDeployment) {
        throw new Error(`Deployment ${deploymentId} not found`);
      }
      if (repoDeployment.retryCount >= repoDeployment.maxRetries) {
        throw new Error(`Deployment ${deploymentId} has exceeded maximum retry attempts`);
      }
      const retryDeployment = {
        ...repoDeployment,
        retryCount: (repoDeployment.retryCount || 0) + 1,
        retryAt: new Date().toISOString(),
        priority: 'high'
      };
      return await this.enqueue(retryDeployment);
    }
    throw new Error(`Deployment ${deploymentId} is already queued or processing`);
  }
  remove(deploymentId) {
    const index = this.queue.findIndex(item => item.id === deploymentId);
    if (index !== -1) {
      const removed = this.queue.splice(index, 1)[0];
      this.logger?.info('Deployment removed from queue', {
        deploymentId,
        queueLength: this.queue.length
      });
      this.emit('removed', removed);
      return removed;
    }
    return null;
  }
  clear() {
    const cleared = this.queue.splice(0);
    this.logger?.info('Queue cleared', {
      clearedCount: cleared.length
    });
    this.emit('cleared', cleared);
    return cleared.length;
  }
  getQueuePosition(deploymentId) {
    const index = this.queue.findIndex(item => item.id === deploymentId);
    return index !== -1 ? index + 1 : -1;
  }
  getQueueLength() {
    return this.queue.length;
  }
  getProcessingCount() {
    return this.processing.size;
  }
  hasItems() {
    return this.queue.length > 0;
  }
  isProcessing(deploymentId) {
    return this.processing.has(deploymentId);
  }
  isQueued(deploymentId) {
    return this.queue.some(item => item.id === deploymentId);
  }
  peek() {
    return this.queue.length > 0 ? this.queue[0] : null;
  }
  getQueue() {
    return [...this.queue];
  }
  getProcessing() {
    return [...this.processing];
  }
  async getStatus() {
    const status = {
      queueLength: this.queue.length,
      processingCount: this.processing.size,
      maxQueueSize: this.maxQueueSize,
      queue: this.queue.map(item => ({
        id: item.id,
        priority: item.priority,
        queuedAt: item.queuedAt,
        repository: item.repository,
        branch: item.branch,
        requestedBy: item.requestedBy,
        retryCount: item.retryCount,
        type: item.type || 'deployment'
      })),
      processing: [...this.processing],
      priorityDistribution: this.getPriorityDistribution(),
      averageWaitTime: await this.getAverageWaitTime()
    };
    return status;
  }
  getPriorityDistribution() {
    const distribution = {
      low: 0,
      normal: 0,
      high: 0,
      urgent: 0
    };
    this.queue.forEach(item => {
      const priority = item.priority || 'normal';
      if (distribution.hasOwnProperty(priority)) {
        distribution[priority]++;
      }
    });
    return distribution;
  }
  async getAverageWaitTime() {
    if (this.queue.length === 0) {
      return 0;
    }
    const now = Date.now();
    const totalWaitTime = this.queue.reduce((total, item) => {
      return total + (now - new Date(item.queuedAt).getTime());
    }, 0);
    return Math.round(totalWaitTime / this.queue.length);
  }
  sortQueue() {
    this.queue.sort((a, b) => {
      const priorityA = this.priorities[a.priority] || this.priorities.normal;
      const priorityB = this.priorities[b.priority] || this.priorities.normal;
      if (priorityA !== priorityB) {
        return priorityB - priorityA;
      }
      return new Date(a.queuedAt) - new Date(b.queuedAt);
    });
  }
  validateDeployment(deployment) {
    const required = ['id', 'repository'];
    const missing = required.filter(field => !deployment[field]);
    if (missing.length > 0) {
      throw new Error(`Missing required fields: ${missing.join(', ')}`);
    }
    if (deployment.priority && !this.priorities.hasOwnProperty(deployment.priority)) {
      throw new Error(`Invalid priority: ${deployment.priority}. Must be one of: ${Object.keys(this.priorities).join(', ')}`);
    }
    return true;
  }
  getMetrics() {
    return {
      queueLength: this.queue.length,
      processingCount: this.processing.size,
      maxQueueSize: this.maxQueueSize,
      utilizationPercent: Math.round(this.queue.length / this.maxQueueSize * 100),
      priorityDistribution: this.getPriorityDistribution(),
      oldestQueuedAt: this.queue.length > 0 ? this.queue[this.queue.length - 1].queuedAt : null,
      newestQueuedAt: this.queue.length > 0 ? this.queue[0].queuedAt : null
    };
  }
  onQueueEvent(event, handler) {
    this.on(event, handler);
  }
  offQueueEvent(event, handler) {
    this.off(event, handler);
  }
  async cleanup() {
    this.queue = [];
    this.processing.clear();
    this.removeAllListeners();
    this.logger?.info('Deployment queue cleaned up');
  }
}
module.exports = DeploymentQueue;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJFdmVudEVtaXR0ZXIiLCJyZXF1aXJlIiwiRGVwbG95bWVudFF1ZXVlIiwiY29uc3RydWN0b3IiLCJvcHRpb25zIiwibG9nZ2VyIiwiZGVwbG95bWVudFJlcG9zaXRvcnkiLCJtYXhRdWV1ZVNpemUiLCJwcm9jZXNzaW5nVGltZW91dCIsInF1ZXVlIiwicHJvY2Vzc2luZyIsIlNldCIsInByaW9yaXRpZXMiLCJlbnF1ZXVlIiwiZGVwbG95bWVudCIsImxlbmd0aCIsIkVycm9yIiwiaWQiLCJmaW5kIiwiaXRlbSIsImhhcyIsInF1ZXVlSXRlbSIsInF1ZXVlZEF0IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwicHJpb3JpdHkiLCJyZXRyeUNvdW50IiwibWF4UmV0cmllcyIsInB1c2giLCJzb3J0UXVldWUiLCJpbmZvIiwiZGVwbG95bWVudElkIiwicXVldWVMZW5ndGgiLCJwb3NpdGlvbiIsImdldFF1ZXVlUG9zaXRpb24iLCJlbWl0IiwiZGVxdWV1ZSIsInNoaWZ0IiwiYWRkIiwid2FpdFRpbWUiLCJub3ciLCJnZXRUaW1lIiwic2V0VGltZW91dCIsIndhcm4iLCJ0aW1lb3V0IiwiZGVsZXRlIiwibWFya0NvbXBsZXRlZCIsInByb2Nlc3NpbmdDb3VudCIsInNpemUiLCJtYXJrRmFpbGVkIiwiZXJyb3IiLCJtZXNzYWdlIiwicmV0cnkiLCJyZXBvRGVwbG95bWVudCIsImdldERlcGxveW1lbnQiLCJyZXRyeURlcGxveW1lbnQiLCJyZXRyeUF0IiwicmVtb3ZlIiwiaW5kZXgiLCJmaW5kSW5kZXgiLCJyZW1vdmVkIiwic3BsaWNlIiwiY2xlYXIiLCJjbGVhcmVkIiwiY2xlYXJlZENvdW50IiwiZ2V0UXVldWVMZW5ndGgiLCJnZXRQcm9jZXNzaW5nQ291bnQiLCJoYXNJdGVtcyIsImlzUHJvY2Vzc2luZyIsImlzUXVldWVkIiwic29tZSIsInBlZWsiLCJnZXRRdWV1ZSIsImdldFByb2Nlc3NpbmciLCJnZXRTdGF0dXMiLCJzdGF0dXMiLCJtYXAiLCJyZXBvc2l0b3J5IiwiYnJhbmNoIiwicmVxdWVzdGVkQnkiLCJ0eXBlIiwicHJpb3JpdHlEaXN0cmlidXRpb24iLCJnZXRQcmlvcml0eURpc3RyaWJ1dGlvbiIsImF2ZXJhZ2VXYWl0VGltZSIsImdldEF2ZXJhZ2VXYWl0VGltZSIsImRpc3RyaWJ1dGlvbiIsImxvdyIsIm5vcm1hbCIsImhpZ2giLCJ1cmdlbnQiLCJmb3JFYWNoIiwiaGFzT3duUHJvcGVydHkiLCJ0b3RhbFdhaXRUaW1lIiwicmVkdWNlIiwidG90YWwiLCJNYXRoIiwicm91bmQiLCJzb3J0IiwiYSIsImIiLCJwcmlvcml0eUEiLCJwcmlvcml0eUIiLCJ2YWxpZGF0ZURlcGxveW1lbnQiLCJyZXF1aXJlZCIsIm1pc3NpbmciLCJmaWx0ZXIiLCJmaWVsZCIsImpvaW4iLCJPYmplY3QiLCJrZXlzIiwiZ2V0TWV0cmljcyIsInV0aWxpemF0aW9uUGVyY2VudCIsIm9sZGVzdFF1ZXVlZEF0IiwibmV3ZXN0UXVldWVkQXQiLCJvblF1ZXVlRXZlbnQiLCJldmVudCIsImhhbmRsZXIiLCJvbiIsIm9mZlF1ZXVlRXZlbnQiLCJvZmYiLCJjbGVhbnVwIiwicmVtb3ZlQWxsTGlzdGVuZXJzIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbImRlcGxveW1lbnQtcXVldWUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgeyBFdmVudEVtaXR0ZXIgfSA9IHJlcXVpcmUoJ2V2ZW50cycpO1xuXG5jbGFzcyBEZXBsb3ltZW50UXVldWUgZXh0ZW5kcyBFdmVudEVtaXR0ZXIge1xuICBjb25zdHJ1Y3RvcihvcHRpb25zID0ge30pIHtcbiAgICBzdXBlcigpO1xuICAgIFxuICAgIHRoaXMubG9nZ2VyID0gb3B0aW9ucy5sb2dnZXI7XG4gICAgdGhpcy5kZXBsb3ltZW50UmVwb3NpdG9yeSA9IG9wdGlvbnMuZGVwbG95bWVudFJlcG9zaXRvcnk7XG4gICAgdGhpcy5tYXhRdWV1ZVNpemUgPSBvcHRpb25zLm1heFF1ZXVlU2l6ZSB8fCAxMDA7XG4gICAgdGhpcy5wcm9jZXNzaW5nVGltZW91dCA9IG9wdGlvbnMucHJvY2Vzc2luZ1RpbWVvdXQgfHwgMzAwMDAwOyAvLyA1IG1pbnV0ZXNcbiAgICBcbiAgICB0aGlzLnF1ZXVlID0gW107XG4gICAgdGhpcy5wcm9jZXNzaW5nID0gbmV3IFNldCgpO1xuICAgIHRoaXMucHJpb3JpdGllcyA9IHtcbiAgICAgICdsb3cnOiAxLFxuICAgICAgJ25vcm1hbCc6IDIsXG4gICAgICAnaGlnaCc6IDMsXG4gICAgICAndXJnZW50JzogNFxuICAgIH07XG4gIH1cblxuICBhc3luYyBlbnF1ZXVlKGRlcGxveW1lbnQpIHtcbiAgICBpZiAodGhpcy5xdWV1ZS5sZW5ndGggPj0gdGhpcy5tYXhRdWV1ZVNpemUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgUXVldWUgaXMgZnVsbCAobWF4OiAke3RoaXMubWF4UXVldWVTaXplfSlgKTtcbiAgICB9XG4gICAgXG4gICAgaWYgKCFkZXBsb3ltZW50LmlkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0RlcGxveW1lbnQgbXVzdCBoYXZlIGFuIElEJyk7XG4gICAgfVxuICAgIFxuICAgIGlmICh0aGlzLnF1ZXVlLmZpbmQoaXRlbSA9PiBpdGVtLmlkID09PSBkZXBsb3ltZW50LmlkKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBEZXBsb3ltZW50ICR7ZGVwbG95bWVudC5pZH0gaXMgYWxyZWFkeSBxdWV1ZWRgKTtcbiAgICB9XG4gICAgXG4gICAgaWYgKHRoaXMucHJvY2Vzc2luZy5oYXMoZGVwbG95bWVudC5pZCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRGVwbG95bWVudCAke2RlcGxveW1lbnQuaWR9IGlzIGN1cnJlbnRseSBiZWluZyBwcm9jZXNzZWRgKTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgcXVldWVJdGVtID0ge1xuICAgICAgLi4uZGVwbG95bWVudCxcbiAgICAgIHF1ZXVlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICBwcmlvcml0eTogZGVwbG95bWVudC5wcmlvcml0eSB8fCAnbm9ybWFsJyxcbiAgICAgIHJldHJ5Q291bnQ6IGRlcGxveW1lbnQucmV0cnlDb3VudCB8fCAwLFxuICAgICAgbWF4UmV0cmllczogZGVwbG95bWVudC5tYXhSZXRyaWVzIHx8IDNcbiAgICB9O1xuICAgIFxuICAgIHRoaXMucXVldWUucHVzaChxdWV1ZUl0ZW0pO1xuICAgIHRoaXMuc29ydFF1ZXVlKCk7XG4gICAgXG4gICAgdGhpcy5sb2dnZXI/LmluZm8oJ0RlcGxveW1lbnQgcXVldWVkJywge1xuICAgICAgZGVwbG95bWVudElkOiBkZXBsb3ltZW50LmlkLFxuICAgICAgcHJpb3JpdHk6IHF1ZXVlSXRlbS5wcmlvcml0eSxcbiAgICAgIHF1ZXVlTGVuZ3RoOiB0aGlzLnF1ZXVlLmxlbmd0aCxcbiAgICAgIHBvc2l0aW9uOiB0aGlzLmdldFF1ZXVlUG9zaXRpb24oZGVwbG95bWVudC5pZClcbiAgICB9KTtcbiAgICBcbiAgICB0aGlzLmVtaXQoJ3F1ZXVlZCcsIHF1ZXVlSXRlbSk7XG4gICAgXG4gICAgcmV0dXJuIHF1ZXVlSXRlbTtcbiAgfVxuXG4gIGFzeW5jIGRlcXVldWUoKSB7XG4gICAgaWYgKHRoaXMucXVldWUubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgZGVwbG95bWVudCA9IHRoaXMucXVldWUuc2hpZnQoKTtcbiAgICB0aGlzLnByb2Nlc3NpbmcuYWRkKGRlcGxveW1lbnQuaWQpO1xuICAgIFxuICAgIHRoaXMubG9nZ2VyPy5pbmZvKCdEZXBsb3ltZW50IGRlcXVldWVkJywge1xuICAgICAgZGVwbG95bWVudElkOiBkZXBsb3ltZW50LmlkLFxuICAgICAgcHJpb3JpdHk6IGRlcGxveW1lbnQucHJpb3JpdHksXG4gICAgICBxdWV1ZWRBdDogZGVwbG95bWVudC5xdWV1ZWRBdCxcbiAgICAgIHdhaXRUaW1lOiBEYXRlLm5vdygpIC0gbmV3IERhdGUoZGVwbG95bWVudC5xdWV1ZWRBdCkuZ2V0VGltZSgpXG4gICAgfSk7XG4gICAgXG4gICAgdGhpcy5lbWl0KCdkZXF1ZXVlZCcsIGRlcGxveW1lbnQpO1xuICAgIFxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgaWYgKHRoaXMucHJvY2Vzc2luZy5oYXMoZGVwbG95bWVudC5pZCkpIHtcbiAgICAgICAgdGhpcy5sb2dnZXI/Lndhcm4oJ0RlcGxveW1lbnQgcHJvY2Vzc2luZyB0aW1lb3V0Jywge1xuICAgICAgICAgIGRlcGxveW1lbnRJZDogZGVwbG95bWVudC5pZCxcbiAgICAgICAgICB0aW1lb3V0OiB0aGlzLnByb2Nlc3NpbmdUaW1lb3V0XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgdGhpcy5wcm9jZXNzaW5nLmRlbGV0ZShkZXBsb3ltZW50LmlkKTtcbiAgICAgICAgdGhpcy5lbWl0KCd0aW1lb3V0JywgZGVwbG95bWVudCk7XG4gICAgICB9XG4gICAgfSwgdGhpcy5wcm9jZXNzaW5nVGltZW91dCk7XG4gICAgXG4gICAgcmV0dXJuIGRlcGxveW1lbnQ7XG4gIH1cblxuICBtYXJrQ29tcGxldGVkKGRlcGxveW1lbnRJZCkge1xuICAgIGlmICh0aGlzLnByb2Nlc3NpbmcuaGFzKGRlcGxveW1lbnRJZCkpIHtcbiAgICAgIHRoaXMucHJvY2Vzc2luZy5kZWxldGUoZGVwbG95bWVudElkKTtcbiAgICAgIFxuICAgICAgdGhpcy5sb2dnZXI/LmluZm8oJ0RlcGxveW1lbnQgbWFya2VkIGFzIGNvbXBsZXRlZCcsIHtcbiAgICAgICAgZGVwbG95bWVudElkLFxuICAgICAgICBwcm9jZXNzaW5nQ291bnQ6IHRoaXMucHJvY2Vzc2luZy5zaXplXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgdGhpcy5lbWl0KCdjb21wbGV0ZWQnLCBkZXBsb3ltZW50SWQpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIG1hcmtGYWlsZWQoZGVwbG95bWVudElkLCBlcnJvciA9IG51bGwpIHtcbiAgICBpZiAodGhpcy5wcm9jZXNzaW5nLmhhcyhkZXBsb3ltZW50SWQpKSB7XG4gICAgICB0aGlzLnByb2Nlc3NpbmcuZGVsZXRlKGRlcGxveW1lbnRJZCk7XG4gICAgICBcbiAgICAgIHRoaXMubG9nZ2VyPy5pbmZvKCdEZXBsb3ltZW50IG1hcmtlZCBhcyBmYWlsZWQnLCB7XG4gICAgICAgIGRlcGxveW1lbnRJZCxcbiAgICAgICAgZXJyb3I6IGVycm9yPy5tZXNzYWdlLFxuICAgICAgICBwcm9jZXNzaW5nQ291bnQ6IHRoaXMucHJvY2Vzc2luZy5zaXplXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgdGhpcy5lbWl0KCdmYWlsZWQnLCB7IGRlcGxveW1lbnRJZCwgZXJyb3IgfSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgYXN5bmMgcmV0cnkoZGVwbG95bWVudElkKSB7XG4gICAgY29uc3QgZGVwbG95bWVudCA9IHRoaXMucXVldWUuZmluZChpdGVtID0+IGl0ZW0uaWQgPT09IGRlcGxveW1lbnRJZCkgfHxcbiAgICAgICAgICAgICAgICAgICAgICBbLi4udGhpcy5wcm9jZXNzaW5nXS5maW5kKGlkID0+IGlkID09PSBkZXBsb3ltZW50SWQpO1xuICAgIFxuICAgIGlmICghZGVwbG95bWVudCkge1xuICAgICAgY29uc3QgcmVwb0RlcGxveW1lbnQgPSBhd2FpdCB0aGlzLmRlcGxveW1lbnRSZXBvc2l0b3J5Py5nZXREZXBsb3ltZW50KGRlcGxveW1lbnRJZCk7XG4gICAgICBpZiAoIXJlcG9EZXBsb3ltZW50KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgRGVwbG95bWVudCAke2RlcGxveW1lbnRJZH0gbm90IGZvdW5kYCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmIChyZXBvRGVwbG95bWVudC5yZXRyeUNvdW50ID49IHJlcG9EZXBsb3ltZW50Lm1heFJldHJpZXMpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBEZXBsb3ltZW50ICR7ZGVwbG95bWVudElkfSBoYXMgZXhjZWVkZWQgbWF4aW11bSByZXRyeSBhdHRlbXB0c2ApO1xuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zdCByZXRyeURlcGxveW1lbnQgPSB7XG4gICAgICAgIC4uLnJlcG9EZXBsb3ltZW50LFxuICAgICAgICByZXRyeUNvdW50OiAocmVwb0RlcGxveW1lbnQucmV0cnlDb3VudCB8fCAwKSArIDEsXG4gICAgICAgIHJldHJ5QXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgcHJpb3JpdHk6ICdoaWdoJ1xuICAgICAgfTtcbiAgICAgIFxuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZW5xdWV1ZShyZXRyeURlcGxveW1lbnQpO1xuICAgIH1cbiAgICBcbiAgICB0aHJvdyBuZXcgRXJyb3IoYERlcGxveW1lbnQgJHtkZXBsb3ltZW50SWR9IGlzIGFscmVhZHkgcXVldWVkIG9yIHByb2Nlc3NpbmdgKTtcbiAgfVxuXG4gIHJlbW92ZShkZXBsb3ltZW50SWQpIHtcbiAgICBjb25zdCBpbmRleCA9IHRoaXMucXVldWUuZmluZEluZGV4KGl0ZW0gPT4gaXRlbS5pZCA9PT0gZGVwbG95bWVudElkKTtcbiAgICBcbiAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICBjb25zdCByZW1vdmVkID0gdGhpcy5xdWV1ZS5zcGxpY2UoaW5kZXgsIDEpWzBdO1xuICAgICAgXG4gICAgICB0aGlzLmxvZ2dlcj8uaW5mbygnRGVwbG95bWVudCByZW1vdmVkIGZyb20gcXVldWUnLCB7XG4gICAgICAgIGRlcGxveW1lbnRJZCxcbiAgICAgICAgcXVldWVMZW5ndGg6IHRoaXMucXVldWUubGVuZ3RoXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgdGhpcy5lbWl0KCdyZW1vdmVkJywgcmVtb3ZlZCk7XG4gICAgICByZXR1cm4gcmVtb3ZlZDtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBjbGVhcigpIHtcbiAgICBjb25zdCBjbGVhcmVkID0gdGhpcy5xdWV1ZS5zcGxpY2UoMCk7XG4gICAgXG4gICAgdGhpcy5sb2dnZXI/LmluZm8oJ1F1ZXVlIGNsZWFyZWQnLCB7XG4gICAgICBjbGVhcmVkQ291bnQ6IGNsZWFyZWQubGVuZ3RoXG4gICAgfSk7XG4gICAgXG4gICAgdGhpcy5lbWl0KCdjbGVhcmVkJywgY2xlYXJlZCk7XG4gICAgXG4gICAgcmV0dXJuIGNsZWFyZWQubGVuZ3RoO1xuICB9XG5cbiAgZ2V0UXVldWVQb3NpdGlvbihkZXBsb3ltZW50SWQpIHtcbiAgICBjb25zdCBpbmRleCA9IHRoaXMucXVldWUuZmluZEluZGV4KGl0ZW0gPT4gaXRlbS5pZCA9PT0gZGVwbG95bWVudElkKTtcbiAgICByZXR1cm4gaW5kZXggIT09IC0xID8gaW5kZXggKyAxIDogLTE7XG4gIH1cblxuICBnZXRRdWV1ZUxlbmd0aCgpIHtcbiAgICByZXR1cm4gdGhpcy5xdWV1ZS5sZW5ndGg7XG4gIH1cblxuICBnZXRQcm9jZXNzaW5nQ291bnQoKSB7XG4gICAgcmV0dXJuIHRoaXMucHJvY2Vzc2luZy5zaXplO1xuICB9XG5cbiAgaGFzSXRlbXMoKSB7XG4gICAgcmV0dXJuIHRoaXMucXVldWUubGVuZ3RoID4gMDtcbiAgfVxuXG4gIGlzUHJvY2Vzc2luZyhkZXBsb3ltZW50SWQpIHtcbiAgICByZXR1cm4gdGhpcy5wcm9jZXNzaW5nLmhhcyhkZXBsb3ltZW50SWQpO1xuICB9XG5cbiAgaXNRdWV1ZWQoZGVwbG95bWVudElkKSB7XG4gICAgcmV0dXJuIHRoaXMucXVldWUuc29tZShpdGVtID0+IGl0ZW0uaWQgPT09IGRlcGxveW1lbnRJZCk7XG4gIH1cblxuICBwZWVrKCkge1xuICAgIHJldHVybiB0aGlzLnF1ZXVlLmxlbmd0aCA+IDAgPyB0aGlzLnF1ZXVlWzBdIDogbnVsbDtcbiAgfVxuXG4gIGdldFF1ZXVlKCkge1xuICAgIHJldHVybiBbLi4udGhpcy5xdWV1ZV07XG4gIH1cblxuICBnZXRQcm9jZXNzaW5nKCkge1xuICAgIHJldHVybiBbLi4udGhpcy5wcm9jZXNzaW5nXTtcbiAgfVxuXG4gIGFzeW5jIGdldFN0YXR1cygpIHtcbiAgICBjb25zdCBzdGF0dXMgPSB7XG4gICAgICBxdWV1ZUxlbmd0aDogdGhpcy5xdWV1ZS5sZW5ndGgsXG4gICAgICBwcm9jZXNzaW5nQ291bnQ6IHRoaXMucHJvY2Vzc2luZy5zaXplLFxuICAgICAgbWF4UXVldWVTaXplOiB0aGlzLm1heFF1ZXVlU2l6ZSxcbiAgICAgIHF1ZXVlOiB0aGlzLnF1ZXVlLm1hcChpdGVtID0+ICh7XG4gICAgICAgIGlkOiBpdGVtLmlkLFxuICAgICAgICBwcmlvcml0eTogaXRlbS5wcmlvcml0eSxcbiAgICAgICAgcXVldWVkQXQ6IGl0ZW0ucXVldWVkQXQsXG4gICAgICAgIHJlcG9zaXRvcnk6IGl0ZW0ucmVwb3NpdG9yeSxcbiAgICAgICAgYnJhbmNoOiBpdGVtLmJyYW5jaCxcbiAgICAgICAgcmVxdWVzdGVkQnk6IGl0ZW0ucmVxdWVzdGVkQnksXG4gICAgICAgIHJldHJ5Q291bnQ6IGl0ZW0ucmV0cnlDb3VudCxcbiAgICAgICAgdHlwZTogaXRlbS50eXBlIHx8ICdkZXBsb3ltZW50J1xuICAgICAgfSkpLFxuICAgICAgcHJvY2Vzc2luZzogWy4uLnRoaXMucHJvY2Vzc2luZ10sXG4gICAgICBwcmlvcml0eURpc3RyaWJ1dGlvbjogdGhpcy5nZXRQcmlvcml0eURpc3RyaWJ1dGlvbigpLFxuICAgICAgYXZlcmFnZVdhaXRUaW1lOiBhd2FpdCB0aGlzLmdldEF2ZXJhZ2VXYWl0VGltZSgpXG4gICAgfTtcbiAgICBcbiAgICByZXR1cm4gc3RhdHVzO1xuICB9XG5cbiAgZ2V0UHJpb3JpdHlEaXN0cmlidXRpb24oKSB7XG4gICAgY29uc3QgZGlzdHJpYnV0aW9uID0ge1xuICAgICAgbG93OiAwLFxuICAgICAgbm9ybWFsOiAwLFxuICAgICAgaGlnaDogMCxcbiAgICAgIHVyZ2VudDogMFxuICAgIH07XG4gICAgXG4gICAgdGhpcy5xdWV1ZS5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgY29uc3QgcHJpb3JpdHkgPSBpdGVtLnByaW9yaXR5IHx8ICdub3JtYWwnO1xuICAgICAgaWYgKGRpc3RyaWJ1dGlvbi5oYXNPd25Qcm9wZXJ0eShwcmlvcml0eSkpIHtcbiAgICAgICAgZGlzdHJpYnV0aW9uW3ByaW9yaXR5XSsrO1xuICAgICAgfVxuICAgIH0pO1xuICAgIFxuICAgIHJldHVybiBkaXN0cmlidXRpb247XG4gIH1cblxuICBhc3luYyBnZXRBdmVyYWdlV2FpdFRpbWUoKSB7XG4gICAgaWYgKHRoaXMucXVldWUubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgXG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICBjb25zdCB0b3RhbFdhaXRUaW1lID0gdGhpcy5xdWV1ZS5yZWR1Y2UoKHRvdGFsLCBpdGVtKSA9PiB7XG4gICAgICByZXR1cm4gdG90YWwgKyAobm93IC0gbmV3IERhdGUoaXRlbS5xdWV1ZWRBdCkuZ2V0VGltZSgpKTtcbiAgICB9LCAwKTtcbiAgICBcbiAgICByZXR1cm4gTWF0aC5yb3VuZCh0b3RhbFdhaXRUaW1lIC8gdGhpcy5xdWV1ZS5sZW5ndGgpO1xuICB9XG5cbiAgc29ydFF1ZXVlKCkge1xuICAgIHRoaXMucXVldWUuc29ydCgoYSwgYikgPT4ge1xuICAgICAgY29uc3QgcHJpb3JpdHlBID0gdGhpcy5wcmlvcml0aWVzW2EucHJpb3JpdHldIHx8IHRoaXMucHJpb3JpdGllcy5ub3JtYWw7XG4gICAgICBjb25zdCBwcmlvcml0eUIgPSB0aGlzLnByaW9yaXRpZXNbYi5wcmlvcml0eV0gfHwgdGhpcy5wcmlvcml0aWVzLm5vcm1hbDtcbiAgICAgIFxuICAgICAgaWYgKHByaW9yaXR5QSAhPT0gcHJpb3JpdHlCKSB7XG4gICAgICAgIHJldHVybiBwcmlvcml0eUIgLSBwcmlvcml0eUE7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiBuZXcgRGF0ZShhLnF1ZXVlZEF0KSAtIG5ldyBEYXRlKGIucXVldWVkQXQpO1xuICAgIH0pO1xuICB9XG5cbiAgdmFsaWRhdGVEZXBsb3ltZW50KGRlcGxveW1lbnQpIHtcbiAgICBjb25zdCByZXF1aXJlZCA9IFsnaWQnLCAncmVwb3NpdG9yeSddO1xuICAgIGNvbnN0IG1pc3NpbmcgPSByZXF1aXJlZC5maWx0ZXIoZmllbGQgPT4gIWRlcGxveW1lbnRbZmllbGRdKTtcbiAgICBcbiAgICBpZiAobWlzc2luZy5sZW5ndGggPiAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYE1pc3NpbmcgcmVxdWlyZWQgZmllbGRzOiAke21pc3Npbmcuam9pbignLCAnKX1gKTtcbiAgICB9XG4gICAgXG4gICAgaWYgKGRlcGxveW1lbnQucHJpb3JpdHkgJiYgIXRoaXMucHJpb3JpdGllcy5oYXNPd25Qcm9wZXJ0eShkZXBsb3ltZW50LnByaW9yaXR5KSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIHByaW9yaXR5OiAke2RlcGxveW1lbnQucHJpb3JpdHl9LiBNdXN0IGJlIG9uZSBvZjogJHtPYmplY3Qua2V5cyh0aGlzLnByaW9yaXRpZXMpLmpvaW4oJywgJyl9YCk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgZ2V0TWV0cmljcygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgcXVldWVMZW5ndGg6IHRoaXMucXVldWUubGVuZ3RoLFxuICAgICAgcHJvY2Vzc2luZ0NvdW50OiB0aGlzLnByb2Nlc3Npbmcuc2l6ZSxcbiAgICAgIG1heFF1ZXVlU2l6ZTogdGhpcy5tYXhRdWV1ZVNpemUsXG4gICAgICB1dGlsaXphdGlvblBlcmNlbnQ6IE1hdGgucm91bmQoKHRoaXMucXVldWUubGVuZ3RoIC8gdGhpcy5tYXhRdWV1ZVNpemUpICogMTAwKSxcbiAgICAgIHByaW9yaXR5RGlzdHJpYnV0aW9uOiB0aGlzLmdldFByaW9yaXR5RGlzdHJpYnV0aW9uKCksXG4gICAgICBvbGRlc3RRdWV1ZWRBdDogdGhpcy5xdWV1ZS5sZW5ndGggPiAwID8gdGhpcy5xdWV1ZVt0aGlzLnF1ZXVlLmxlbmd0aCAtIDFdLnF1ZXVlZEF0IDogbnVsbCxcbiAgICAgIG5ld2VzdFF1ZXVlZEF0OiB0aGlzLnF1ZXVlLmxlbmd0aCA+IDAgPyB0aGlzLnF1ZXVlWzBdLnF1ZXVlZEF0IDogbnVsbFxuICAgIH07XG4gIH1cblxuICBvblF1ZXVlRXZlbnQoZXZlbnQsIGhhbmRsZXIpIHtcbiAgICB0aGlzLm9uKGV2ZW50LCBoYW5kbGVyKTtcbiAgfVxuXG4gIG9mZlF1ZXVlRXZlbnQoZXZlbnQsIGhhbmRsZXIpIHtcbiAgICB0aGlzLm9mZihldmVudCwgaGFuZGxlcik7XG4gIH1cblxuICBhc3luYyBjbGVhbnVwKCkge1xuICAgIHRoaXMucXVldWUgPSBbXTtcbiAgICB0aGlzLnByb2Nlc3NpbmcuY2xlYXIoKTtcbiAgICB0aGlzLnJlbW92ZUFsbExpc3RlbmVycygpO1xuICAgIFxuICAgIHRoaXMubG9nZ2VyPy5pbmZvKCdEZXBsb3ltZW50IHF1ZXVlIGNsZWFuZWQgdXAnKTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IERlcGxveW1lbnRRdWV1ZTsiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU07RUFBRUE7QUFBYSxDQUFDLEdBQUdDLE9BQU8sQ0FBQyxRQUFRLENBQUM7QUFFMUMsTUFBTUMsZUFBZSxTQUFTRixZQUFZLENBQUM7RUFDekNHLFdBQVdBLENBQUNDLE9BQU8sR0FBRyxDQUFDLENBQUMsRUFBRTtJQUN4QixLQUFLLENBQUMsQ0FBQztJQUVQLElBQUksQ0FBQ0MsTUFBTSxHQUFHRCxPQUFPLENBQUNDLE1BQU07SUFDNUIsSUFBSSxDQUFDQyxvQkFBb0IsR0FBR0YsT0FBTyxDQUFDRSxvQkFBb0I7SUFDeEQsSUFBSSxDQUFDQyxZQUFZLEdBQUdILE9BQU8sQ0FBQ0csWUFBWSxJQUFJLEdBQUc7SUFDL0MsSUFBSSxDQUFDQyxpQkFBaUIsR0FBR0osT0FBTyxDQUFDSSxpQkFBaUIsSUFBSSxNQUFNLENBQUMsQ0FB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Q0FBQyxFQUFFLENBQUM7SUFDekg7SUFFQSxPQUFPLElBQUk7RUFDYjtFQUVBRyxVQUFVQSxDQUFBLEVBQUc7SUFDWCxPQUFPO01BQ0w5RSxXQUFXLEVBQUUsSUFBSSxDQUFDdkIsS0FBSyxDQUFDTSxNQUFNO01BQzlCZ0MsZUFBZSxFQUFFLElBQUksQ0FBQ3JDLFVBQVUsQ0FBQ3NDLElBQUk7TUFDckN6QyxZQUFZLEVBQUUsSUFBSSxDQUFDQSxZQUFZO01BQy9Cd0csa0JBQWtCLEVBQUVoQixJQUFJLENBQUNDLEtBQUssQ0FBRSxJQUFJLENBQUN2RixLQUFLLENBQUNNLE1BQU0sR0FBRyxJQUFJLENBQUNSLFlBQVksR0FBSSxHQUFHLENBQUM7TUFDN0UwRSxvQkFBb0IsRUFBRSxJQUFJLENBQUNDLHVCQUF1QixDQUFDLENBQUM7TUFDcEQ4QixjQUFjLEVBQUUsSUFBSSxDQUFDdkcsS0FBSyxDQUFDTSxNQUFNLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQ04sS0FBSyxDQUFDLElBQUksQ0FBQ0EsS0FBSyxDQUFDTSxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUNPLFFBQVEsR0FBRyxJQUFJO01BQ3pGMkYsY0FBYyxFQUFFLElBQUksQ0FBQ3hHLEtBQUssQ0FBQ00sTUFBTSxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUNOLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQ2EsUUFBUSxHQUFHO0lBQ25FLENBQUM7RUFDSDtFQUVBNEYsWUFBWUEsQ0FBQ0MsS0FBSyxFQUFFQyxPQUFPLEVBQUU7SUFDM0IsSUFBSSxDQUFDQyxFQUFFLENBQUNGLEtBQUssRUFBRUMsT0FBTyxDQUFDO0VBQ3pCO0VBRUFFLGFBQWFBLENBQUNILEtBQUssRUFBRUMsT0FBTyxFQUFFO0lBQzVCLElBQUksQ0FBQ0csR0FBRyxDQUFDSixLQUFLLEVBQUVDLE9BQU8sQ0FBQztFQUMxQjtFQUVBLE1BQU1JLE9BQU9BLENBQUEsRUFBRztJQUNkLElBQUksQ0FBQy9HLEtBQUssR0FBRyxFQUFFO0lBQ2YsSUFBSSxDQUFDQyxVQUFVLENBQUNvRCxLQUFLLENBQUMsQ0FBQztJQUN2QixJQUFJLENBQUMyRCxrQkFBa0IsQ0FBQyxDQUFDO0lBRXpCLElBQUksQ0FBQ3BILE1BQU0sRUFBRXlCLElBQUksQ0FBQyw2QkFBNkIsQ0FBQztFQUNsRDtBQUNGO0FBRUE0RixNQUFNLENBQUNDLE9BQU8sR0FBR3pILGVBQWUiLCJpZ25vcmVMaXN0IjpbXX0=