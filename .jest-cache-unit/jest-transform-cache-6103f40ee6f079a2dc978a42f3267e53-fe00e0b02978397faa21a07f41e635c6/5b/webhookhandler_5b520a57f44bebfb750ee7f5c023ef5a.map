{"version":3,"names":["crypto","require","EventEmitter","WebhookHandler","constructor","options","secret","allowedEvents","logger","security","supportedEvents","Set","eventHandlers","Map","setupDefaultHandlers","set","handleRepositoryDispatch","bind","handlePush","handlePullRequest","handleRelease","validateSignature","signature","payload","warn","expectedSignature","calculateSignature","providedSignature","replace","isValid","timingSafeEqual","Buffer","from","substring","hmac","createHmac","update","JSON","stringify","digest","processWebhook","webhookData","event","delivery","correlationId","info","repository","full_name","action","has","processed","reason","shouldDeploy","handler","get","result","branch","emit","error","message","stack","context","client_payload","clientPayload","allowedActions","includes","allowedRepositories","environment","dryRun","dry_run","trigger","deploymentReason","priority","ref","commits","pusher","length","name","allowedBranches","hasConfigChanges","checkForConfigChanges","shouldSkipCI","some","commit","skipReason","commitSha","after","beforeSha","before","pull_request","pullRequest","number","deploymentActions","merged","targetBranch","base","pullRequestNumber","merge_commit_sha","release","tag_name","prerelease","tagName","releaseTag","releaseName","target_commitish","configPaths","hasChanges","allFiles","added","modified","removed","file","path","startsWith","debug","registerEventHandler","Error","add","unregisterEventHandler","delete","getSupportedEvents","getEventHandlers","keys","validateWebhookPayload","requiredFields","required","valid","missing","filter","field","fieldPath","split","value","part","undefined","missingFields","join","getWebhookStats","registeredHandlers","secretConfigured","cleanup","clear","removeAllListeners","module","exports"],"sources":["webhook-handler.js"],"sourcesContent":["const crypto = require('crypto');\nconst { EventEmitter } = require('events');\n\nclass WebhookHandler extends EventEmitter {\n  constructor(options = {}) {\n    super();\n    \n    this.secret = options.secret;\n    this.allowedEvents = options.allowedEvents || ['repository_dispatch', 'push'];\n    this.logger = options.logger;\n    this.security = options.security;\n    \n    this.supportedEvents = new Set(this.allowedEvents);\n    this.eventHandlers = new Map();\n    \n    this.setupDefaultHandlers();\n  }\n\n  setupDefaultHandlers() {\n    this.eventHandlers.set('repository_dispatch', this.handleRepositoryDispatch.bind(this));\n    this.eventHandlers.set('push', this.handlePush.bind(this));\n    this.eventHandlers.set('pull_request', this.handlePullRequest.bind(this));\n    this.eventHandlers.set('release', this.handleRelease.bind(this));\n  }\n\n  async validateSignature(signature, payload) {\n    if (!this.secret) {\n      this.logger?.warn('Webhook secret not configured, skipping signature validation');\n      return true;\n    }\n    \n    if (!signature) {\n      this.logger?.warn('No signature provided in webhook request');\n      return false;\n    }\n    \n    const expectedSignature = this.calculateSignature(payload);\n    const providedSignature = signature.replace('sha256=', '');\n    \n    const isValid = crypto.timingSafeEqual(\n      Buffer.from(expectedSignature, 'hex'),\n      Buffer.from(providedSignature, 'hex')\n    );\n    \n    if (!isValid) {\n      this.logger?.warn('Webhook signature validation failed', {\n        providedSignature: providedSignature.substring(0, 8) + '...',\n        expectedSignature: expectedSignature.substring(0, 8) + '...'\n      });\n    }\n    \n    return isValid;\n  }\n\n  calculateSignature(payload) {\n    const hmac = crypto.createHmac('sha256', this.secret);\n    hmac.update(JSON.stringify(payload), 'utf8');\n    return hmac.digest('hex');\n  }\n\n  async processWebhook(webhookData) {\n    const { event, delivery, payload, correlationId } = webhookData;\n    \n    this.logger?.info('Processing webhook', {\n      event,\n      delivery,\n      correlationId,\n      repository: payload.repository?.full_name,\n      action: payload.action\n    });\n    \n    if (!this.supportedEvents.has(event)) {\n      this.logger?.info('Ignoring unsupported webhook event', { event, delivery });\n      return {\n        processed: false,\n        reason: 'unsupported_event',\n        event,\n        delivery,\n        shouldDeploy: false\n      };\n    }\n    \n    const handler = this.eventHandlers.get(event);\n    if (!handler) {\n      this.logger?.warn('No handler found for event', { event, delivery });\n      return {\n        processed: false,\n        reason: 'no_handler',\n        event,\n        delivery,\n        shouldDeploy: false\n      };\n    }\n    \n    try {\n      const result = await handler(payload, { event, delivery, correlationId });\n      \n      this.logger?.info('Webhook processed successfully', {\n        event,\n        delivery,\n        correlationId,\n        shouldDeploy: result.shouldDeploy,\n        repository: result.repository,\n        branch: result.branch\n      });\n      \n      this.emit('webhook_processed', {\n        ...result,\n        event,\n        delivery,\n        correlationId\n      });\n      \n      return {\n        processed: true,\n        ...result,\n        event,\n        delivery\n      };\n      \n    } catch (error) {\n      this.logger?.error('Webhook processing failed', {\n        event,\n        delivery,\n        correlationId,\n        error: error.message,\n        stack: error.stack\n      });\n      \n      this.emit('webhook_error', {\n        event,\n        delivery,\n        correlationId,\n        error: error.message\n      });\n      \n      return {\n        processed: false,\n        reason: 'processing_error',\n        error: error.message,\n        event,\n        delivery,\n        shouldDeploy: false\n      };\n    }\n  }\n\n  async handleRepositoryDispatch(payload, context) {\n    const { action, repository, client_payload } = payload;\n    \n    this.logger?.info('Processing repository_dispatch webhook', {\n      action,\n      repository: repository?.full_name,\n      clientPayload: client_payload,\n      correlationId: context.correlationId\n    });\n    \n    const allowedActions = [\n      'deploy-home-assistant-config',\n      'deploy-home-assistant',\n      'trigger-deployment'\n    ];\n    \n    if (!allowedActions.includes(action)) {\n      return {\n        shouldDeploy: false,\n        reason: 'action_not_allowed',\n        action,\n        allowedActions\n      };\n    }\n    \n    if (!repository) {\n      return {\n        shouldDeploy: false,\n        reason: 'no_repository_data'\n      };\n    }\n    \n    const allowedRepositories = [\n      'festion/home-assistant-config',\n      'homelab-gitops-auditor/home-assistant-config'\n    ];\n    \n    if (!allowedRepositories.includes(repository.full_name)) {\n      return {\n        shouldDeploy: false,\n        reason: 'repository_not_allowed',\n        repository: repository.full_name,\n        allowedRepositories\n      };\n    }\n    \n    const branch = client_payload?.branch || 'main';\n    const environment = client_payload?.environment || 'production';\n    const dryRun = client_payload?.dry_run || false;\n    \n    return {\n      shouldDeploy: true,\n      repository: repository.full_name,\n      branch,\n      environment,\n      dryRun,\n      trigger: 'repository_dispatch',\n      action,\n      clientPayload: client_payload,\n      deploymentReason: `Repository dispatch: ${action}`,\n      priority: client_payload?.priority || 'normal'\n    };\n  }\n\n  async handlePush(payload, context) {\n    const { ref, repository, commits, pusher } = payload;\n    \n    this.logger?.info('Processing push webhook', {\n      ref,\n      repository: repository?.full_name,\n      commits: commits?.length,\n      pusher: pusher?.name,\n      correlationId: context.correlationId\n    });\n    \n    if (!repository) {\n      return {\n        shouldDeploy: false,\n        reason: 'no_repository_data'\n      };\n    }\n    \n    const allowedRepositories = [\n      'festion/home-assistant-config'\n    ];\n    \n    if (!allowedRepositories.includes(repository.full_name)) {\n      return {\n        shouldDeploy: false,\n        reason: 'repository_not_allowed',\n        repository: repository.full_name\n      };\n    }\n    \n    const branch = ref?.replace('refs/heads/', '');\n    const allowedBranches = ['main', 'master', 'production'];\n    \n    if (!allowedBranches.includes(branch)) {\n      return {\n        shouldDeploy: false,\n        reason: 'branch_not_allowed',\n        branch,\n        allowedBranches\n      };\n    }\n    \n    const hasConfigChanges = this.checkForConfigChanges(commits);\n    if (!hasConfigChanges) {\n      return {\n        shouldDeploy: false,\n        reason: 'no_config_changes',\n        commits: commits?.length\n      };\n    }\n    \n    const shouldSkipCI = commits?.some(commit => \n      commit.message?.includes('[skip ci]') || \n      commit.message?.includes('[ci skip]') ||\n      commit.message?.includes('[skip deploy]')\n    );\n    \n    if (shouldSkipCI) {\n      return {\n        shouldDeploy: false,\n        reason: 'ci_skipped',\n        skipReason: 'commit_message_directive'\n      };\n    }\n    \n    return {\n      shouldDeploy: true,\n      repository: repository.full_name,\n      branch,\n      trigger: 'push',\n      commits: commits?.length,\n      pusher: pusher?.name,\n      deploymentReason: `Push to ${branch} branch with config changes`,\n      priority: 'normal',\n      commitSha: payload.after,\n      beforeSha: payload.before\n    };\n  }\n\n  async handlePullRequest(payload, context) {\n    const { action, pull_request, repository } = payload;\n    \n    this.logger?.info('Processing pull_request webhook', {\n      action,\n      repository: repository?.full_name,\n      pullRequest: pull_request?.number,\n      correlationId: context.correlationId\n    });\n    \n    const deploymentActions = ['closed'];\n    \n    if (!deploymentActions.includes(action)) {\n      return {\n        shouldDeploy: false,\n        reason: 'action_not_deployment_trigger',\n        action\n      };\n    }\n    \n    if (action === 'closed' && !pull_request?.merged) {\n      return {\n        shouldDeploy: false,\n        reason: 'pull_request_not_merged',\n        action\n      };\n    }\n    \n    const targetBranch = pull_request?.base?.ref;\n    const allowedBranches = ['main', 'master', 'production'];\n    \n    if (!allowedBranches.includes(targetBranch)) {\n      return {\n        shouldDeploy: false,\n        reason: 'target_branch_not_allowed',\n        targetBranch,\n        allowedBranches\n      };\n    }\n    \n    return {\n      shouldDeploy: true,\n      repository: repository.full_name,\n      branch: targetBranch,\n      trigger: 'pull_request_merged',\n      pullRequestNumber: pull_request.number,\n      deploymentReason: `Pull request #${pull_request.number} merged to ${targetBranch}`,\n      priority: 'normal',\n      commitSha: pull_request.merge_commit_sha\n    };\n  }\n\n  async handleRelease(payload, context) {\n    const { action, release, repository } = payload;\n    \n    this.logger?.info('Processing release webhook', {\n      action,\n      repository: repository?.full_name,\n      release: release?.tag_name,\n      correlationId: context.correlationId\n    });\n    \n    if (action !== 'published') {\n      return {\n        shouldDeploy: false,\n        reason: 'action_not_published',\n        action\n      };\n    }\n    \n    if (release?.prerelease) {\n      return {\n        shouldDeploy: false,\n        reason: 'prerelease_not_deployed',\n        tagName: release.tag_name\n      };\n    }\n    \n    return {\n      shouldDeploy: true,\n      repository: repository.full_name,\n      branch: 'main',\n      trigger: 'release',\n      releaseTag: release.tag_name,\n      releaseName: release.name,\n      deploymentReason: `Release ${release.tag_name} published`,\n      priority: 'high',\n      commitSha: release.target_commitish\n    };\n  }\n\n  checkForConfigChanges(commits) {\n    if (!commits || commits.length === 0) {\n      return false;\n    }\n    \n    const configPaths = [\n      'configuration.yaml',\n      'automations.yaml',\n      'scripts.yaml',\n      'scenes.yaml',\n      'groups.yaml',\n      'customize.yaml',\n      'secrets.yaml',\n      'packages/',\n      'lovelace/',\n      'integrations/',\n      'custom_components/'\n    ];\n    \n    const hasChanges = commits.some(commit => {\n      const allFiles = [\n        ...(commit.added || []),\n        ...(commit.modified || []),\n        ...(commit.removed || [])\n      ];\n      \n      return allFiles.some(file => \n        configPaths.some(path => \n          file.startsWith(path) || file.includes(path)\n        )\n      );\n    });\n    \n    this.logger?.debug('Config changes check', {\n      commits: commits.length,\n      hasChanges,\n      configPaths\n    });\n    \n    return hasChanges;\n  }\n\n  registerEventHandler(event, handler) {\n    if (typeof handler !== 'function') {\n      throw new Error('Handler must be a function');\n    }\n    \n    this.eventHandlers.set(event, handler);\n    this.supportedEvents.add(event);\n    \n    this.logger?.info('Custom event handler registered', { event });\n  }\n\n  unregisterEventHandler(event) {\n    const removed = this.eventHandlers.delete(event);\n    this.supportedEvents.delete(event);\n    \n    this.logger?.info('Event handler unregistered', { event, removed });\n    \n    return removed;\n  }\n\n  getSupportedEvents() {\n    return [...this.supportedEvents];\n  }\n\n  getEventHandlers() {\n    return [...this.eventHandlers.keys()];\n  }\n\n  validateWebhookPayload(payload, event) {\n    const requiredFields = {\n      'repository_dispatch': ['action', 'repository'],\n      'push': ['ref', 'repository', 'commits'],\n      'pull_request': ['action', 'pull_request', 'repository'],\n      'release': ['action', 'release', 'repository']\n    };\n    \n    const required = requiredFields[event];\n    if (!required) {\n      return { valid: true };\n    }\n    \n    const missing = required.filter(field => {\n      const fieldPath = field.split('.');\n      let value = payload;\n      \n      for (const part of fieldPath) {\n        value = value?.[part];\n      }\n      \n      return value === undefined || value === null;\n    });\n    \n    if (missing.length > 0) {\n      return {\n        valid: false,\n        missingFields: missing,\n        error: `Missing required fields: ${missing.join(', ')}`\n      };\n    }\n    \n    return { valid: true };\n  }\n\n  getWebhookStats() {\n    return {\n      supportedEvents: this.getSupportedEvents(),\n      registeredHandlers: this.getEventHandlers(),\n      secretConfigured: !!this.secret,\n      allowedEvents: this.allowedEvents\n    };\n  }\n\n  async cleanup() {\n    this.eventHandlers.clear();\n    this.supportedEvents.clear();\n    this.removeAllListeners();\n    \n    this.logger?.info('Webhook handler cleaned up');\n  }\n}\n\nmodule.exports = WebhookHandler;"],"mappings":"AAAA,MAAMA,MAAM,GAAGC,OAAO,CAAC,QAAQ,CAAC;AAChC,MAAM;EAAEC;AAAa,CAAC,GAAGD,OAAO,CAAC,QAAQ,CAAC;AAE1C,MAAME,cAAc,SAASD,YAAY,CAAC;EACxCE,WAAWA,CAACC,OAAO,GAAG,CAAC,CAAC,EAAE;IACxB,KAAK,CAAC,CAAC;IAEP,IAAI,CAACC,MAAM,GAAGD,OAAO,CAACC,MAAM;IAC5B,IAAI,CAACC,aAAa,GAAGF,OAAO,CAACE,aAAa,IAAI,CAAC,qBAAqB,EAAE,MAAM,CAAC;IAC7E,IAAI,CAACC,MAAM,GAAGH,OAAO,CAACG,MAAM;IAC5B,IAAI,CAACC,QAAQ,GAAGJ,OAAO,CAACI,QAAQ;IAEhC,IAAI,CAACC,eAAe,GAAG,IAAIC,GAAG,CAAC,IAAI,CAACJ,aAAa,CAAC;IAClD,IAAI,CAACK,aAAa,GAAG,IAAIC,GAAG,CAAC,CAAC;IAE9B,IAAI,CAACC,oBAAoB,CAAC,CAAC;EAC7B;EAEAA,oBAAoBA,CAAA,EAAG;IACrB,IAAI,CAACF,aAAa,CAACG,GAAG,CAAC,qBAAqB,EAAE,IAAI,CAACC,wBAAwB,CAACC,IAAI,CAAC,IAAI,CAAC,CAAC;IACvF,IAAI,CAACL,aAAa,CAACG,GAAG,CAAC,MAAM,EAAE,IAAI,CAACG,UAAU,CAACD,IAAI,CAAC,IAAI,CAAC,CAAC;IAC1D,IAAI,CAACL,aAAa,CAACG,GAAG,CAAC,cAAc,EAAE,IAAI,CAACI,iBAAiB,CAACF,IAAI,CAAC,IAAI,CAAC,CAAC;IACzE,IAAI,CAACL,aAAa,CAACG,GAAG,CAAC,SAAS,EAAE,IAAI,CAACK,aAAa,CAACH,IAAI,CAAC,IAAI,CAAC,CAAC;EAClE;EAEA,MAAMI,iBAAiBA,CAACC,SAAS,EAAEC,OAAO,EAAE;IAC1C,IAAI,CAAC,IAAI,CAACjB,MAAM,EAAE;MAChB,IAAI,CAACE,MAAM,EAAEgB,IAAI,CAAC,8DAA8D,CAAC;MACjF,OAAO,IAAI;IACb;IAEA,IAAI,CAACF,SAAS,EAAE;MACd,IAAI,CAACd,MAAM,EAAEgB,IAAI,CAAC,0CAA0C,CAAC;MAC7D,OAAO,KAAK;IACd;IAEA,MAAMC,iBAAiB,GAAG,IAAI,CAACC,kBAAkB,CAACH,OAAO,CAAC;IAC1D,MAAMI,iBAAiB,GAAGL,SAAS,CAACM,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC;IAE1D,MAAMC,OAAO,GAAG7B,MAAM,CAAC8B,eAAe,CACpCC,MAAM,CAACC,IAAI,CAACP,iBAAiB,EAAE,KAAK,CAAC,EACrCM,MAAM,CAACC,IAAI,CAACL,iBAAiB,EAAE,KAAK,CACtC,CAAC;IAED,IAAI,CAACE,OAAO,EAAE;MACZ,IAAI,CAACrB,MAAM,EAAEgB,IAAI,CAAC,qCAAqC,EAAE;QACvDG,iBAAiB,EAAEA,iBAAiB,CAACM,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG,KAAK;QAC5DR,iBAAiB,EAAEA,iBAAiB,CAACQ,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG;MACzD,CAAC,CAAC;IACJ;IAEA,OAAOJ,OAAO;EAChB;EAEAH,kBAAkBA,CAACH,OAAO,EAAE;IAC1B,MAAMW,IAAI,GAAGlC,MAAM,CAACmC,UAAU,CAAC,QAAQ,EAAE,IAAI,CAAC7B,MAAM,CAAC;IACrD4B,IAAI,CAACE,MAAM,CAACC,IAAI,CAACC,SAAS,CAACf,OAAO,CAAC,EAAE,MAAM,CAAC;IAC5C,OAAOW,IAAI,CAACK,MAAM,CAAC,KAAK,CAAC;EAC3B;EAEA,MAAMC,cAAcA,CAACC,WAAW,EAAE;IAChC,MAAM;MAAEC,KAAK;MAAEC,QAAQ;MAAEpB,OAAO;MAAEqB;IAAc,CAAC,GAAGH,WAAW;IAE/D,IAAI,CAACjC,MAAM,EAAEqC,IAAI,CAAC,oBAAoB,EAAE;MACtCH,KAAK;MACLC,QAAQ;MACRC,aAAa;MACbE,UAAU,EAAEvB,OAAO,CAACuB,UAAU,EAAEC,SAAS;MACzCC,MAAM,EAAEzB,OAAO,CAACyB;IAClB,CAAC,CAAC;IAEF,IAAI,CAAC,IAAI,CAACtC,eAAe,CAACuC,GAAG,CAACP,KAAK,CAAC,EAAE;MACpC,IAAI,CAAClC,MAAM,EAAEqC,IAAI,CAAC,oCAAoC,EAAE;QAAEH,KAAK;QAAEC;MAAS,CAAC,CAAC;MAC5E,OAAO;QACLO,SAAS,EAAE,KAAK;QAChBC,MAAM,EAAE,mBAAmB;QAC3BT,KAAK;QACLC,QAAQ;QACRS,YAAY,EAAE;MAChB,CAAC;IACH;IAEA,MAAMC,OAAO,GAAG,IAAI,CAACzC,aAAa,CAAC0C,GAAG,CAACZ,KAAK,CAAC;IAC7C,IAAI,CAACW,OAAO,EAAE;MACZ,IAAI,CAAC7C,MAAM,EAAEgB,IAAI,CAAC,4BAA4B,EAAE;QAAEkB,KAAK;QAAEC;MAAS,CAAC,CAAC;MACpE,OAAO;QACLO,SAAS,EAAE,KAAK;QAChBC,MAAM,EAAE,YAAY;QACpBT,KAAK;QACLC,QAAQ;QACRS,YAAY,EAAE;MAChB,CAAC;IACH;IAEA,IAAI;MACF,MAAMG,MAAM,GAAG,MAAMF,OAAO,CAAC9B,OAAO,EAAE;QAAEmB,KAAK;QAAEC,QAAQ;QAAEC;MAAc,CAAC,CAAC;MAEzE,IAAI,CAACpC,MAAM,EAAEqC,IAAI,CAAC,gCAAgC,EAAE;QAClDH,KAAK;QACLC,QAAQ;QACRC,aAAa;QACbQ,YAAY,EAAEG,MAAM,CAACH,YAAY;QACjCN,UAAU,EAAES,MAAM,CAACT,UAAU;QAC7BU,MAAM,EAAED,MAAM,CAACC;MACjB,CAAC,CAAC;MAEF,IAAI,CAACC,IAAI,CAAC,mBAAmB,EAAE;QAC7B,GAAGF,MAAM;QACTb,KAAK;QACLC,QAAQ;QACRC;MACF,CAAC,CAAC;MAEF,OAAO;QACLM,SAAS,EAAE,IAAI;QACf,GAAGK,MAAM;QACTb,KAAK;QACLC;MACF,CAAC;IAEH,CAAC,CAAC,OAAOe,KAAK,EAAE;MACd,IAAI,CAAClD,MAAM,EAAEkD,KAAK,CAAC,2BAA2B,EAAE;QAC9ChB,KAAK;QACLC,QAAQ;QACRC,aAAa;QACbc,KAAK,EAAEA,KAAK,CAACC,OAAO;QACpBC,KAAK,EAAEF,KAAK,CAACE;MACf,CAAC,CAAC;MAEF,IAAI,CAACH,IAAI,CAAC,eAAe,EAAE;QACzBf,KAAK;QACLC,QAAQ;QACRC,aAAa;QACbc,KAAK,EAAEA,KAAK,CAACC;MACf,CAAC,CAAC;MAEF,OAAO;QACLT,SAAS,EAAE,KAAK;QAChBC,MAAM,EAAE,kBAAkB;QAC1BO,KAAK,EAAEA,KAAK,CAACC,OAAO;QACpBjB,KAAK;QACLC,QAAQ;QACRS,YAAY,EAAE;MAChB,CAAC;IACH;EACF;EAEA,MAAMpC,wBAAwBA,CAACO,OAAO,EAAEsC,OAAO,EAAE;IAC/C,MAAM;MAAEb,MAAM;MAAEF,UAAU;MAAEgB;IAAe,CAAC,GAAGvC,OAAO;IAEtD,IAAI,CAACf,MAAM,EAAEqC,IAAI,CAAC,wCAAwC,EAAE;MAC1DG,MAAM;MACNF,UAAU,EAAEA,UAAU,EAAEC,SAAS;MACjCgB,aAAa,EAAED,cAAc;MAC7BlB,aAAa,EAAEiB,OAAO,CAACjB;IACzB,CAAC,CAAC;IAEF,MAAMoB,cAAc,GAAG,CACrB,8BAA8B,EAC9B,uBAAuB,EACvB,oBAAoB,CACrB;IAED,IAAI,CAACA,cAAc,CAACC,QAAQ,CAACjB,MAAM,CAAC,EAAE;MACpC,OAAO;QACLI,YAAY,EAAE,KAAK;QACnBD,MAAM,EAAE,oBAAoB;QAC5BH,MAAM;QACNgB;MACF,CAAC;IACH;IAEA,IAAI,CAAClB,UAAU,EAAE;MACf,OAAO;QACLM,YAAY,EAAE,KAAK;QACnBD,MAAM,EAAE;MACV,CAAC;IACH;IAEA,MAAMe,mBAAmB,GAAG,CAC1B,+BAA+B,EAC/B,8CAA8C,CAC/C;IAED,IAAI,CAACA,mBAAmB,CAACD,QAAQ,CAACnB,UAAU,CAACC,SAAS,CAAC,EAAE;MACvD,OAAO;QACLK,YAAY,EAAE,KAAK;QACnBD,MAAM,EAAE,wBAAwB;QAChCL,UAAU,EAAEA,UAAU,CAACC,SAAS;QAChCmB;MACF,CAAC;IACH;IAEA,MAAMV,MAAM,GAAGM,cAAc,EAAEN,MAAM,IAAI,MAAM;IAC/C,MAAMW,WAAW,GAAGL,cAAc,EAAEK,WAAW,IAAI,YAAY;IAC/D,MAAMC,MAAM,GAAGN,cAAc,EAAEO,OAAO,IAAI,KAAK;IAE/C,OAAO;MACLjB,YAAY,EAAE,IAAI;MAClBN,UAAU,EAAEA,UAAU,CAACC,SAAS;MAChCS,MAAM;MACNW,WAAW;MACXC,MAAM;MACNE,OAAO,EAAE,qBAAqB;MAC9BtB,MAAM;MACNe,aAAa,EAAED,cAAc;MAC7BS,gBAAgB,EAAE,wBAAwBvB,MAAM,EAAE;MAClDwB,QAAQ,EAAEV,cAAc,EAAEU,QAAQ,IAAI;IACxC,CAAC;EACH;EAEA,MAAMtD,UAAUA,CAACK,OAAO,EAAEsC,OAAO,EAAE;IACjC,MAAM;MAAEY,GAAG;MAAE3B,UAAU;MAAE4B,OAAO;MAAEC;IAAO,CAAC,GAAGpD,OAAO;IAEpD,IAAI,CAACf,MAAM,EAAEqC,IAAI,CAAC,yBAAyB,EAAE;MAC3C4B,GAAG;MACH3B,UAAU,EAAEA,UAAU,EAAEC,SAAS;MACjC2B,OAAO,EAAEA,OAAO,EAAEE,MAAM;MACxBD,MAAM,EAAEA,MAAM,EAAEE,IAAI;MACpBjC,aAAa,EAAEiB,OAAO,CAACjB;IACzB,CAAC,CAAC;IAEF,IAAI,CAACE,UAAU,EAAE;MACf,OAAO;QACLM,YAAY,EAAE,KAAK;QACnBD,MAAM,EAAE;MACV,CAAC;IACH;IAEA,MAAMe,mBAAmB,GAAG,CAC1B,+BAA+B,CAChC;IAED,IAAI,CAACA,mBAAmB,CAACD,QAAQ,CAACnB,UAAU,CAACC,SAAS,CAAC,EAAE;MACvD,OAAO;QACLK,YAAY,EAAE,KAAK;QACnBD,MAAM,EAAE,wBAAwB;QAChCL,UAAU,EAAEA,UAAU,CAACC;MACzB,CAAC;IACH;IAEA,MAAMS,MAAM,GAAGiB,GAAG,EAAE7C,OAAO,CAAC,aAAa,EAAE,EAAE,CAAC;IAC9C,MAAMkD,eAAe,GAAG,CAAC,MAAM,EAAE,QAAQ,EAAE,YAAY,CAAC;IAExD,IAAI,CAACA,eAAe,CAACb,QAAQ,CAACT,MAAM,CAAC,EAAE;MACrC,OAAO;QACLJ,YAAY,EAAE,KAAK;QACnBD,MAAM,EAAE,oBAAoB;QAC5BK,MAAM;QACNsB;MACF,CAAC;IACH;IAEA,MAAMC,gBAAgB,GAAG,IAAI,CAACC,qBAAqB,CAACN,OAAO,CAAC;IAC5D,IAAI,CAACK,gBAAgB,EAAE;MACrB,OAAO;QACL3B,YAAY,EAAE,KAAK;QACnBD,MAAM,EAAE,mBAAmB;QAC3BuB,OAAO,EAAEA,OAAO,EAAEE;MACpB,CAAC;IACH;IAEA,MAAMK,YAAY,GAAGP,OAAO,EAAEQ,IAAI,CAACC,MAAM,IACvCA,MAAM,CAACxB,OAAO,EAAEM,QAAQ,CAAC,WAAW,CAAC,IACrCkB,MAAM,CAACxB,OAAO,EAAEM,QAAQ,CAAC,WAAW,CAAC,IACrCkB,MAAM,CAACxB,OAAO,EAAEM,QAAQ,CAAC,eAAe,CAC1C,CAAC;IAED,IAAIgB,YAAY,EAAE;MAChB,OAAO;QACL7B,YAAY,EAAE,KAAK;QACnBD,MAAM,EAAE,YAAY;QACpBiC,UAAU,EAAE;MACd,CAAC;IACH;IAEA,OAAO;MACLhC,YAAY,EAAE,IAAI;MAClBN,UAAU,EAAEA,UAAU,CAACC,SAAS;MAChCS,MAAM;MACNc,OAAO,EAAE,MAAM;MACfI,OAAO,EAAEA,OAAO,EAAEE,MAAM;MACxBD,MAAM,EAAEA,MAAM,EAAEE,IAAI;MACpBN,gBAAgB,EAAE,WAAWf,MAAM,6BAA6B;MAChEgB,QAAQ,EAAE,QAAQ;MAClBa,SAAS,EAAE9D,OAAO,CAAC+D,KAAK;MACxBC,SAAS,EAAEhE,OAAO,CAACiE;IACrB,CAAC;EACH;EAEA,MAAMrE,iBAAiBA,CAACI,OAAO,EAAEsC,OAAO,EAAE;IACxC,MAAM;MAAEb,MAAM;MAAEyC,YAAY;MAAE3C;IAAW,CAAC,GAAGvB,OAAO;IAEpD,IAAI,CAACf,MAAM,EAAEqC,IAAI,CAAC,iCAAiC,EAAE;MACnDG,MAAM;MACNF,UAAU,EAAEA,UAAU,EAAEC,SAAS;MACjC2C,WAAW,EAAED,YAAY,EAAEE,MAAM;MACjC/C,aAAa,EAAEiB,OAAO,CAACjB;IACzB,CAAC,CAAC;IAEF,MAAMgD,iBAAiB,GAAG,CAAC,QAAQ,CAAC;IAEpC,IAAI,CAACA,iBAAiB,CAAC3B,QAAQ,CAACjB,MAAM,CAAC,EAAE;MACvC,OAAO;QACLI,YAAY,EAAE,KAAK;QACnBD,MAAM,EAAE,+BAA+B;QACvCH;MACF,CAAC;IACH;IAEA,IAAIA,MAAM,KAAK,QAAQ,IAAI,CAACyC,YAAY,EAAEI,MAAM,EAAE;MAChD,OAAO;QACLzC,YAAY,EAAE,KAAK;QACnBD,MAAM,EAAE,yBAAyB;QACjCH;MACF,CAAC;IACH;IAEA,MAAM8C,YAAY,GAAGL,YAAY,EAAEM,IAAI,EAAEtB,GAAG;IAC5C,MAAMK,eAAe,GAAG,CAAC,MAAM,EAAE,QAAQ,EAAE,YAAY,CAAC;IAExD,IAAI,CAACA,eAAe,CAACb,QAAQ,CAAC6B,YAAY,CAAC,EAAE;MAC3C,OAAO;QACL1C,YAAY,EAAE,KAAK;QACnBD,MAAM,EAAE,2BAA2B;QACnC2C,YAAY;QACZhB;MACF,CAAC;IACH;IAEA,OAAO;MACL1B,YAAY,EAAE,IAAI;MAClBN,UAAU,EAAEA,UAAU,CAACC,SAAS;MAChCS,MAAM,EAAEsC,YAAY;MACpBxB,OAAO,EAAE,qBAAqB;MAC9B0B,iBAAiB,EAAEP,YAAY,CAACE,MAAM;MACtCpB,gBAAgB,EAAE,iBAAiBkB,YAAY,CAACE,MAAM,cAAcG,YAAY,EAAE;MAClFtB,QAAQ,EAAE,QAAQ;MAClBa,SAAS,EAAEI,YAAY,CAACQ;IAC1B,CAAC;EACH;EAEA,MAAM7E,aAAaA,CAACG,OAAO,EAAEsC,OAAO,EAAE;IACpC,MAAM;MAAEb,MAAM;MAAEkD,OAAO;MAAEpD;IAAW,CAAC,GAAGvB,OAAO;IAE/C,IAAI,CAACf,MAAM,EAAEqC,IAAI,CAAC,4BAA4B,EAAE;MAC9CG,MAAM;MACNF,UAAU,EAAEA,UAAU,EAAEC,SAAS;MACjCmD,OAAO,EAAEA,OAAO,EAAEC,QAAQ;MAC1BvD,aAAa,EAAEiB,OAAO,CAACjB;IACzB,CAAC,CAAC;IAEF,IAAII,MAAM,KAAK,WAAW,EAAE;MAC1B,OAAO;QACLI,YAAY,EAAE,KAAK;QACnBD,MAAM,EAAE,sBAAsB;QAC9BH;MACF,CAAC;IACH;IAEA,IAAIkD,OAAO,EAAEE,UAAU,EAAE;MACvB,OAAO;QACLhD,YAAY,EAAE,KAAK;QACnBD,MAAM,EAAE,yBAAyB;QACjCkD,OAAO,EAAEH,OAAO,CAACC;MACnB,CAAC;IACH;IAEA,OAAO;MACL/C,YAAY,EAAE,IAAI;MAClBN,UAAU,EAAEA,UAAU,CAACC,SAAS;MAChCS,MAAM,EAAE,MAAM;MACdc,OAAO,EAAE,SAAS;MAClBgC,UAAU,EAAEJ,OAAO,CAACC,QAAQ;MAC5BI,WAAW,EAAEL,OAAO,CAACrB,IAAI;MACzBN,gBAAgB,EAAE,WAAW2B,OAAO,CAACC,QAAQ,YAAY;MACzD3B,QAAQ,EAAE,MAAM;MAChBa,SAAS,EAAEa,OAAO,CAACM;IACrB,CAAC;EACH;EAEAxB,qBAAqBA,CAACN,OAAO,EAAE;IAC7B,IAAI,CAACA,OAAO,IAAIA,OAAO,CAACE,MAAM,KAAK,CAAC,EAAE;MACpC,OAAO,KAAK;IACd;IAEA,MAAM6B,WAAW,GAAG,CAClB,oBAAoB,EACpB,kBAAkB,EAClB,cAAc,EACd,aAAa,EACb,aAAa,EACb,gBAAgB,EAChB,cAAc,EACd,WAAW,EACX,WAAW,EACX,eAAe,EACf,oBAAoB,CACrB;IAED,MAAMC,UAAU,GAAGhC,OAAO,CAACQ,IAAI,CAACC,MAAM,IAAI;MACxC,MAAMwB,QAAQ,GAAG,CACf,IAAIxB,MAAM,CAACyB,KAAK,IAAI,EAAE,CAAC,EACvB,IAAIzB,MAAM,CAAC0B,QAAQ,IAAI,EAAE,CAAC,EAC1B,IAAI1B,MAAM,CAAC2B,OAAO,IAAI,EAAE,CAAC,CAC1B;MAED,OAAOH,QAAQ,CAACzB,IAAI,CAAC6B,IAAI,IACvBN,WAAW,CAACvB,IAAI,CAAC8B,IAAI,IACnBD,IAAI,CAACE,UAAU,CAACD,IAAI,CAAC,IAAID,IAAI,CAAC9C,QAAQ,CAAC+C,IAAI,CAC7C,CACF,CAAC;IACH,CAAC,CAAC;IAEF,IAAI,CAACxG,MAAM,EAAE0G,KAAK,CAAC,sBAAsB,EAAE;MACzCxC,OAAO,EAAEA,OAAO,CAACE,MAAM;MACvB8B,UAAU;MACVD;IACF,CAAC,CAAC;IAEF,OAAOC,UAAU;EACnB;EAEAS,oBAAoBA,CAACzE,KAAK,EAAEW,OAAO,EAAE;IACnC,IAAI,OAAOA,OAAO,KAAK,UAAU,EAAE;MACjC,MAAM,IAAI+D,KAAK,CAAC,4BAA4B,CAAC;IAC/C;IAEA,IAAI,CAACxG,aAAa,CAACG,GAAG,CAAC2B,KAAK,EAAEW,OAAO,CAAC;IACtC,IAAI,CAAC3C,eAAe,CAAC2G,GAAG,CAAC3E,KAAK,CAAC;IAE/B,IAAI,CAAClC,MAAM,EAAEqC,IAAI,CAAC,iCAAiC,EAAE;MAAEH;IAAM,CAAC,CAAC;EACjE;EAEA4E,sBAAsBA,CAAC5E,KAAK,EAAE;IAC5B,MAAMoE,OAAO,GAAG,IAAI,CAAClG,aAAa,CAAC2G,MAAM,CAAC7E,KAAK,CAAC;IAChD,IAAI,CAAChC,eAAe,CAAC6G,MAAM,CAAC7E,KAAK,CAAC;IAElC,IAAI,CAAClC,MAAM,EAAEqC,IAAI,CAAC,4BAA4B,EAAE;MAAEH,KAAK;MAAEoE;IAAQ,CAAC,CAAC;IAEnE,OAAOA,OAAO;EAChB;EAEAU,kBAAkBA,CAAA,EAAG;IACnB,OAAO,CAAC,GAAG,IAAI,CAAC9G,eAAe,CAAC;EAClC;EAEA+G,gBAAgBA,CAAA,EAAG;IACjB,OAAO,CAAC,GAAG,IAAI,CAAC7G,aAAa,CAAC8G,IAAI,CAAC,CAAC,CAAC;EACvC;EAEAC,sBAAsBA,CAACpG,OAAO,EAAEmB,KAAK,EAAE;IACrC,MAAMkF,cAAc,GAAG;MACrB,qBAAqB,EAAE,CAAC,QAAQ,EAAE,YAAY,CAAC;MAC/C,MAAM,EAAE,CAAC,KAAK,EAAE,YAAY,EAAE,SAAS,CAAC;MACxC,cAAc,EAAE,CAAC,QAAQ,EAAE,cAAc,EAAE,YAAY,CAAC;MACxD,SAAS,EAAE,CAAC,QAAQ,EAAE,SAAS,EAAE,YAAY;IAC/C,CAAC;IAED,MAAMC,QAAQ,GAAGD,cAAc,CAAClF,KAAK,CAAC;IACtC,IAAI,CAACmF,QAAQ,EAAE;MACb,OAAO;QAAEC,KAAK,EAAE;MAAK,CAAC;IACxB;IAEA,MAAMC,OAAO,GAAGF,QAAQ,CAACG,MAAM,CAACC,KAAK,IAAI;MACvC,MAAMC,SAAS,GAAGD,KAAK,CAACE,KAAK,CAAC,GAAG,CAAC;MAClC,IAAIC,KAAK,GAAG7G,OAAO;MAEnB,KAAK,MAAM8G,IAAI,IAAIH,SAAS,EAAE;QAC5BE,KAAK,GAAGA,KAAK,GAAGC,IAAI,CAAC;MACvB;MAEA,OAAOD,KAAK,KAAKE,SAAS,IAAIF,KAAK,KAAK,IAAI;IAC9C,CAAC,CAAC;IAEF,IAAIL,OAAO,CAACnD,MAAM,GAAG,CAAC,EAAE;MACtB,OAAO;QACLkD,KAAK,EAAE,KAAK;QACZS,aAAa,EAAER,OAAO;QACtBrE,KAAK,EAAE,4BAA4BqE,OAAO,CAACS,IAAI,CAAC,IAAI,CAAC;MACvD,CAAC;IACH;IAEA,OAAO;MAAEV,KAAK,EAAE;IAAK,CAAC;EACxB;EAEAW,eAAeA,CAAA,EAAG;IAChB,OAAO;MACL/H,eAAe,EAAE,IAAI,CAAC8G,kBAAkB,CAAC,CAAC;MAC1CkB,kBAAkB,EAAE,IAAI,CAACjB,gBAAgB,CAAC,CAAC;MAC3CkB,gBAAgB,EAAE,CAAC,CAAC,IAAI,CAACrI,MAAM;MAC/BC,aAAa,EAAE,IAAI,CAACA;IACtB,CAAC;EACH;EAEA,MAAMqI,OAAOA,CAAA,EAAG;IACd,IAAI,CAAChI,aAAa,CAACiI,KAAK,CAAC,CAAC;IAC1B,IAAI,CAACnI,eAAe,CAACmI,KAAK,CAAC,CAAC;IAC5B,IAAI,CAACC,kBAAkB,CAAC,CAAC;IAEzB,IAAI,CAACtI,MAAM,EAAEqC,IAAI,CAAC,4BAA4B,CAAC;EACjD;AACF;AAEAkG,MAAM,CAACC,OAAO,GAAG7I,cAAc","ignoreList":[]}