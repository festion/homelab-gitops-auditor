c79c5a5cdfbdfab21f1722757db3e674
/**
 * Mock implementation for MCP Coordinator
 * Used to isolate deployment service and other components during testing
 */
class MockMCPCoordinator {
  constructor() {
    this.deployConfiguration = jest.fn();
    this.transferFile = jest.fn();
    this.createBackup = jest.fn();
    this.rollbackDeployment = jest.fn();
    this.getAllStatus = jest.fn();
    this.getHealthStatus = jest.fn();
    this.checkHealth = jest.fn();
    this.reconnect = jest.fn();
    this.initialize = jest.fn();
    this.shutdown = jest.fn();

    // Internal state tracking
    this._deploymentInProgress = false;
    this._healthStatus = new Map();
    this._connectionStatus = new Map();

    // Initialize default states
    this._initializeDefaults();
  }
  _initializeDefaults() {
    this._healthStatus.set('networkFs', {
      status: 'healthy',
      lastCheck: new Date()
    });
    this._healthStatus.set('github', {
      status: 'healthy',
      lastCheck: new Date()
    });
    this._connectionStatus.set('networkFs', {
      status: 'connected',
      connectedAt: new Date()
    });
    this._connectionStatus.set('github', {
      status: 'connected',
      connectedAt: new Date()
    });
  }

  // Mock successful deployment
  mockDeploymentSuccess() {
    this.deployConfiguration.mockResolvedValue({
      success: true,
      deploymentId: 'deploy-20250713-101117',
      filesDeployed: 15,
      duration: 45000,
      state: 'completed'
    });
    this._deploymentInProgress = true;
    setTimeout(() => {
      this._deploymentInProgress = false;
    }, 100);
  }

  // Mock deployment failure
  mockDeploymentFailure(errorMessage = 'Configuration validation error') {
    this.deployConfiguration.mockRejectedValue(new Error(`Deployment failed: ${errorMessage}`));
  }

  // Mock slow deployment for concurrency testing
  mockSlowDeployment(duration = 5000) {
    this.deployConfiguration.mockImplementation(() => {
      this._deploymentInProgress = true;
      return new Promise(resolve => {
        setTimeout(() => {
          this._deploymentInProgress = false;
          resolve({
            success: true,
            deploymentId: 'deploy-20250713-101117',
            filesDeployed: 15,
            duration,
            state: 'completed'
          });
        }, duration);
      });
    });
  }

  // Mock successful file transfer
  mockTransferSuccess() {
    this.transferFile.mockResolvedValue({
      success: true,
      transferred: true,
      size: 1024
    });
  }

  // Mock file transfer failure with retry logic
  mockTransferFailure() {
    this.transferFile.mockRejectedValue(new Error('File transfer failed: Network timeout'));
  }

  // Mock successful backup creation
  mockBackupSuccess() {
    this.createBackup.mockResolvedValue({
      success: true,
      backupId: `backup-${Date.now()}`,
      path: '/backup/config-backup.tar.gz',
      size: 2048576
    });
  }

  // Mock backup failure
  mockBackupFailure(errorMessage = 'Insufficient disk space') {
    this.createBackup.mockRejectedValue(new Error(`Backup failed: ${errorMessage}`));
  }

  // Mock healthy server status
  mockHealthyStatus() {
    this.getAllStatus.mockReturnValue({
      networkFs: {
        connection: {
          status: 'connected',
          connectedAt: new Date()
        },
        health: {
          status: 'healthy',
          lastCheck: new Date()
        }
      },
      github: {
        connection: {
          status: 'connected',
          connectedAt: new Date()
        },
        health: {
          status: 'healthy',
          lastCheck: new Date()
        }
      }
    });
    this.getHealthStatus.mockImplementation(serverName => {
      return this._healthStatus.get(serverName) || {
        status: 'unknown'
      };
    });
    this.checkHealth.mockResolvedValue(true);
  }

  // Mock unhealthy server status
  mockUnhealthyStatus() {
    this._healthStatus.set('networkFs', {
      status: 'unhealthy',
      lastError: 'Connection timeout',
      lastCheck: new Date()
    });
    this.getAllStatus.mockReturnValue({
      networkFs: {
        connection: {
          status: 'failed',
          lastError: 'Connection timeout'
        },
        health: {
          status: 'unhealthy',
          lastError: 'Connection timeout'
        }
      },
      github: {
        connection: {
          status: 'connected',
          connectedAt: new Date()
        },
        health: {
          status: 'healthy',
          lastCheck: new Date()
        }
      }
    });
    this.getHealthStatus.mockImplementation(serverName => {
      return this._healthStatus.get(serverName) || {
        status: 'unknown'
      };
    });
    this.checkHealth.mockResolvedValue(false);
  }

  // Mock connection success
  mockConnectionSuccess() {
    this.initialize.mockResolvedValue(true);
  }

  // Mock connection failure
  mockConnectionFailure(serverName = 'Network-FS') {
    this.initialize.mockRejectedValue(new Error(`Failed to connect to ${serverName} MCP server`));
  }

  // Mock rollback success
  mockRollbackSuccess() {
    this.rollbackDeployment.mockResolvedValue({
      success: true,
      rolledBack: true,
      restoredFiles: 12
    });
  }

  // Utility methods for test state management
  isDeploymentInProgress() {
    return this._deploymentInProgress;
  }
  setServerHealth(serverName, status, error = null) {
    this._healthStatus.set(serverName, {
      status,
      lastError: error,
      lastCheck: new Date()
    });
  }

  // Reset all mocks to default state
  reset() {
    jest.clearAllMocks();
    this._deploymentInProgress = false;
    this._healthStatus.clear();
    this._connectionStatus.clear();
    this._initializeDefaults();
  }
}
module.exports = {
  MockMCPCoordinator
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNb2NrTUNQQ29vcmRpbmF0b3IiLCJjb25zdHJ1Y3RvciIsImRlcGxveUNvbmZpZ3VyYXRpb24iLCJqZXN0IiwiZm4iLCJ0cmFuc2ZlckZpbGUiLCJjcmVhdGVCYWNrdXAiLCJyb2xsYmFja0RlcGxveW1lbnQiLCJnZXRBbGxTdGF0dXMiLCJnZXRIZWFsdGhTdGF0dXMiLCJjaGVja0hlYWx0aCIsInJlY29ubmVjdCIsImluaXRpYWxpemUiLCJzaHV0ZG93biIsIl9kZXBsb3ltZW50SW5Qcm9ncmVzcyIsIl9oZWFsdGhTdGF0dXMiLCJNYXAiLCJfY29ubmVjdGlvblN0YXR1cyIsIl9pbml0aWFsaXplRGVmYXVsdHMiLCJzZXQiLCJzdGF0dXMiLCJsYXN0Q2hlY2siLCJEYXRlIiwiY29ubmVjdGVkQXQiLCJtb2NrRGVwbG95bWVudFN1Y2Nlc3MiLCJtb2NrUmVzb2x2ZWRWYWx1ZSIsInN1Y2Nlc3MiLCJkZXBsb3ltZW50SWQiLCJmaWxlc0RlcGxveWVkIiwiZHVyYXRpb24iLCJzdGF0ZSIsInNldFRpbWVvdXQiLCJtb2NrRGVwbG95bWVudEZhaWx1cmUiLCJlcnJvck1lc3NhZ2UiLCJtb2NrUmVqZWN0ZWRWYWx1ZSIsIkVycm9yIiwibW9ja1Nsb3dEZXBsb3ltZW50IiwibW9ja0ltcGxlbWVudGF0aW9uIiwiUHJvbWlzZSIsInJlc29sdmUiLCJtb2NrVHJhbnNmZXJTdWNjZXNzIiwidHJhbnNmZXJyZWQiLCJzaXplIiwibW9ja1RyYW5zZmVyRmFpbHVyZSIsIm1vY2tCYWNrdXBTdWNjZXNzIiwiYmFja3VwSWQiLCJub3ciLCJwYXRoIiwibW9ja0JhY2t1cEZhaWx1cmUiLCJtb2NrSGVhbHRoeVN0YXR1cyIsIm1vY2tSZXR1cm5WYWx1ZSIsIm5ldHdvcmtGcyIsImNvbm5lY3Rpb24iLCJoZWFsdGgiLCJnaXRodWIiLCJzZXJ2ZXJOYW1lIiwiZ2V0IiwibW9ja1VuaGVhbHRoeVN0YXR1cyIsImxhc3RFcnJvciIsIm1vY2tDb25uZWN0aW9uU3VjY2VzcyIsIm1vY2tDb25uZWN0aW9uRmFpbHVyZSIsIm1vY2tSb2xsYmFja1N1Y2Nlc3MiLCJyb2xsZWRCYWNrIiwicmVzdG9yZWRGaWxlcyIsImlzRGVwbG95bWVudEluUHJvZ3Jlc3MiLCJzZXRTZXJ2ZXJIZWFsdGgiLCJlcnJvciIsInJlc2V0IiwiY2xlYXJBbGxNb2NrcyIsImNsZWFyIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIm1jcC1jb29yZGluYXRvci5tb2NrLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTW9jayBpbXBsZW1lbnRhdGlvbiBmb3IgTUNQIENvb3JkaW5hdG9yXG4gKiBVc2VkIHRvIGlzb2xhdGUgZGVwbG95bWVudCBzZXJ2aWNlIGFuZCBvdGhlciBjb21wb25lbnRzIGR1cmluZyB0ZXN0aW5nXG4gKi9cbmNsYXNzIE1vY2tNQ1BDb29yZGluYXRvciB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuZGVwbG95Q29uZmlndXJhdGlvbiA9IGplc3QuZm4oKTtcbiAgICB0aGlzLnRyYW5zZmVyRmlsZSA9IGplc3QuZm4oKTtcbiAgICB0aGlzLmNyZWF0ZUJhY2t1cCA9IGplc3QuZm4oKTtcbiAgICB0aGlzLnJvbGxiYWNrRGVwbG95bWVudCA9IGplc3QuZm4oKTtcbiAgICB0aGlzLmdldEFsbFN0YXR1cyA9IGplc3QuZm4oKTtcbiAgICB0aGlzLmdldEhlYWx0aFN0YXR1cyA9IGplc3QuZm4oKTtcbiAgICB0aGlzLmNoZWNrSGVhbHRoID0gamVzdC5mbigpO1xuICAgIHRoaXMucmVjb25uZWN0ID0gamVzdC5mbigpO1xuICAgIHRoaXMuaW5pdGlhbGl6ZSA9IGplc3QuZm4oKTtcbiAgICB0aGlzLnNodXRkb3duID0gamVzdC5mbigpO1xuICAgIFxuICAgIC8vIEludGVybmFsIHN0YXRlIHRyYWNraW5nXG4gICAgdGhpcy5fZGVwbG95bWVudEluUHJvZ3Jlc3MgPSBmYWxzZTtcbiAgICB0aGlzLl9oZWFsdGhTdGF0dXMgPSBuZXcgTWFwKCk7XG4gICAgdGhpcy5fY29ubmVjdGlvblN0YXR1cyA9IG5ldyBNYXAoKTtcbiAgICBcbiAgICAvLyBJbml0aWFsaXplIGRlZmF1bHQgc3RhdGVzXG4gICAgdGhpcy5faW5pdGlhbGl6ZURlZmF1bHRzKCk7XG4gIH1cblxuICBfaW5pdGlhbGl6ZURlZmF1bHRzKCkge1xuICAgIHRoaXMuX2hlYWx0aFN0YXR1cy5zZXQoJ25ldHdvcmtGcycsIHsgc3RhdHVzOiAnaGVhbHRoeScsIGxhc3RDaGVjazogbmV3IERhdGUoKSB9KTtcbiAgICB0aGlzLl9oZWFsdGhTdGF0dXMuc2V0KCdnaXRodWInLCB7IHN0YXR1czogJ2hlYWx0aHknLCBsYXN0Q2hlY2s6IG5ldyBEYXRlKCkgfSk7XG4gICAgdGhpcy5fY29ubmVjdGlvblN0YXR1cy5zZXQoJ25ldHdvcmtGcycsIHsgc3RhdHVzOiAnY29ubmVjdGVkJywgY29ubmVjdGVkQXQ6IG5ldyBEYXRlKCkgfSk7XG4gICAgdGhpcy5fY29ubmVjdGlvblN0YXR1cy5zZXQoJ2dpdGh1YicsIHsgc3RhdHVzOiAnY29ubmVjdGVkJywgY29ubmVjdGVkQXQ6IG5ldyBEYXRlKCkgfSk7XG4gIH1cblxuICAvLyBNb2NrIHN1Y2Nlc3NmdWwgZGVwbG95bWVudFxuICBtb2NrRGVwbG95bWVudFN1Y2Nlc3MoKSB7XG4gICAgdGhpcy5kZXBsb3lDb25maWd1cmF0aW9uLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkZXBsb3ltZW50SWQ6ICdkZXBsb3ktMjAyNTA3MTMtMTAxMTE3JyxcbiAgICAgIGZpbGVzRGVwbG95ZWQ6IDE1LFxuICAgICAgZHVyYXRpb246IDQ1MDAwLFxuICAgICAgc3RhdGU6ICdjb21wbGV0ZWQnXG4gICAgfSk7XG4gICAgdGhpcy5fZGVwbG95bWVudEluUHJvZ3Jlc3MgPSB0cnVlO1xuICAgIHNldFRpbWVvdXQoKCkgPT4geyB0aGlzLl9kZXBsb3ltZW50SW5Qcm9ncmVzcyA9IGZhbHNlOyB9LCAxMDApO1xuICB9XG5cbiAgLy8gTW9jayBkZXBsb3ltZW50IGZhaWx1cmVcbiAgbW9ja0RlcGxveW1lbnRGYWlsdXJlKGVycm9yTWVzc2FnZSA9ICdDb25maWd1cmF0aW9uIHZhbGlkYXRpb24gZXJyb3InKSB7XG4gICAgdGhpcy5kZXBsb3lDb25maWd1cmF0aW9uLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgbmV3IEVycm9yKGBEZXBsb3ltZW50IGZhaWxlZDogJHtlcnJvck1lc3NhZ2V9YClcbiAgICApO1xuICB9XG5cbiAgLy8gTW9jayBzbG93IGRlcGxveW1lbnQgZm9yIGNvbmN1cnJlbmN5IHRlc3RpbmdcbiAgbW9ja1Nsb3dEZXBsb3ltZW50KGR1cmF0aW9uID0gNTAwMCkge1xuICAgIHRoaXMuZGVwbG95Q29uZmlndXJhdGlvbi5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge1xuICAgICAgdGhpcy5fZGVwbG95bWVudEluUHJvZ3Jlc3MgPSB0cnVlO1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIHRoaXMuX2RlcGxveW1lbnRJblByb2dyZXNzID0gZmFsc2U7XG4gICAgICAgICAgcmVzb2x2ZSh7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgZGVwbG95bWVudElkOiAnZGVwbG95LTIwMjUwNzEzLTEwMTExNycsXG4gICAgICAgICAgICBmaWxlc0RlcGxveWVkOiAxNSxcbiAgICAgICAgICAgIGR1cmF0aW9uLFxuICAgICAgICAgICAgc3RhdGU6ICdjb21wbGV0ZWQnXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sIGR1cmF0aW9uKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gTW9jayBzdWNjZXNzZnVsIGZpbGUgdHJhbnNmZXJcbiAgbW9ja1RyYW5zZmVyU3VjY2VzcygpIHtcbiAgICB0aGlzLnRyYW5zZmVyRmlsZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgdHJhbnNmZXJyZWQ6IHRydWUsXG4gICAgICBzaXplOiAxMDI0XG4gICAgfSk7XG4gIH1cblxuICAvLyBNb2NrIGZpbGUgdHJhbnNmZXIgZmFpbHVyZSB3aXRoIHJldHJ5IGxvZ2ljXG4gIG1vY2tUcmFuc2ZlckZhaWx1cmUoKSB7XG4gICAgdGhpcy50cmFuc2ZlckZpbGUubW9ja1JlamVjdGVkVmFsdWUoXG4gICAgICBuZXcgRXJyb3IoJ0ZpbGUgdHJhbnNmZXIgZmFpbGVkOiBOZXR3b3JrIHRpbWVvdXQnKVxuICAgICk7XG4gIH1cblxuICAvLyBNb2NrIHN1Y2Nlc3NmdWwgYmFja3VwIGNyZWF0aW9uXG4gIG1vY2tCYWNrdXBTdWNjZXNzKCkge1xuICAgIHRoaXMuY3JlYXRlQmFja3VwLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBiYWNrdXBJZDogYGJhY2t1cC0ke0RhdGUubm93KCl9YCxcbiAgICAgIHBhdGg6ICcvYmFja3VwL2NvbmZpZy1iYWNrdXAudGFyLmd6JyxcbiAgICAgIHNpemU6IDIwNDg1NzZcbiAgICB9KTtcbiAgfVxuXG4gIC8vIE1vY2sgYmFja3VwIGZhaWx1cmVcbiAgbW9ja0JhY2t1cEZhaWx1cmUoZXJyb3JNZXNzYWdlID0gJ0luc3VmZmljaWVudCBkaXNrIHNwYWNlJykge1xuICAgIHRoaXMuY3JlYXRlQmFja3VwLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgbmV3IEVycm9yKGBCYWNrdXAgZmFpbGVkOiAke2Vycm9yTWVzc2FnZX1gKVxuICAgICk7XG4gIH1cblxuICAvLyBNb2NrIGhlYWx0aHkgc2VydmVyIHN0YXR1c1xuICBtb2NrSGVhbHRoeVN0YXR1cygpIHtcbiAgICB0aGlzLmdldEFsbFN0YXR1cy5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgbmV0d29ya0ZzOiB7XG4gICAgICAgIGNvbm5lY3Rpb246IHsgc3RhdHVzOiAnY29ubmVjdGVkJywgY29ubmVjdGVkQXQ6IG5ldyBEYXRlKCkgfSxcbiAgICAgICAgaGVhbHRoOiB7IHN0YXR1czogJ2hlYWx0aHknLCBsYXN0Q2hlY2s6IG5ldyBEYXRlKCkgfVxuICAgICAgfSxcbiAgICAgIGdpdGh1Yjoge1xuICAgICAgICBjb25uZWN0aW9uOiB7IHN0YXR1czogJ2Nvbm5lY3RlZCcsIGNvbm5lY3RlZEF0OiBuZXcgRGF0ZSgpIH0sXG4gICAgICAgIGhlYWx0aDogeyBzdGF0dXM6ICdoZWFsdGh5JywgbGFzdENoZWNrOiBuZXcgRGF0ZSgpIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMuZ2V0SGVhbHRoU3RhdHVzLm1vY2tJbXBsZW1lbnRhdGlvbigoc2VydmVyTmFtZSkgPT4ge1xuICAgICAgcmV0dXJuIHRoaXMuX2hlYWx0aFN0YXR1cy5nZXQoc2VydmVyTmFtZSkgfHwgeyBzdGF0dXM6ICd1bmtub3duJyB9O1xuICAgIH0pO1xuXG4gICAgdGhpcy5jaGVja0hlYWx0aC5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKTtcbiAgfVxuXG4gIC8vIE1vY2sgdW5oZWFsdGh5IHNlcnZlciBzdGF0dXNcbiAgbW9ja1VuaGVhbHRoeVN0YXR1cygpIHtcbiAgICB0aGlzLl9oZWFsdGhTdGF0dXMuc2V0KCduZXR3b3JrRnMnLCB7IFxuICAgICAgc3RhdHVzOiAndW5oZWFsdGh5JywgXG4gICAgICBsYXN0RXJyb3I6ICdDb25uZWN0aW9uIHRpbWVvdXQnLFxuICAgICAgbGFzdENoZWNrOiBuZXcgRGF0ZSgpXG4gICAgfSk7XG5cbiAgICB0aGlzLmdldEFsbFN0YXR1cy5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgbmV0d29ya0ZzOiB7XG4gICAgICAgIGNvbm5lY3Rpb246IHsgc3RhdHVzOiAnZmFpbGVkJywgbGFzdEVycm9yOiAnQ29ubmVjdGlvbiB0aW1lb3V0JyB9LFxuICAgICAgICBoZWFsdGg6IHsgc3RhdHVzOiAndW5oZWFsdGh5JywgbGFzdEVycm9yOiAnQ29ubmVjdGlvbiB0aW1lb3V0JyB9XG4gICAgICB9LFxuICAgICAgZ2l0aHViOiB7XG4gICAgICAgIGNvbm5lY3Rpb246IHsgc3RhdHVzOiAnY29ubmVjdGVkJywgY29ubmVjdGVkQXQ6IG5ldyBEYXRlKCkgfSxcbiAgICAgICAgaGVhbHRoOiB7IHN0YXR1czogJ2hlYWx0aHknLCBsYXN0Q2hlY2s6IG5ldyBEYXRlKCkgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5nZXRIZWFsdGhTdGF0dXMubW9ja0ltcGxlbWVudGF0aW9uKChzZXJ2ZXJOYW1lKSA9PiB7XG4gICAgICByZXR1cm4gdGhpcy5faGVhbHRoU3RhdHVzLmdldChzZXJ2ZXJOYW1lKSB8fCB7IHN0YXR1czogJ3Vua25vd24nIH07XG4gICAgfSk7XG5cbiAgICB0aGlzLmNoZWNrSGVhbHRoLm1vY2tSZXNvbHZlZFZhbHVlKGZhbHNlKTtcbiAgfVxuXG4gIC8vIE1vY2sgY29ubmVjdGlvbiBzdWNjZXNzXG4gIG1vY2tDb25uZWN0aW9uU3VjY2VzcygpIHtcbiAgICB0aGlzLmluaXRpYWxpemUubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSk7XG4gIH1cblxuICAvLyBNb2NrIGNvbm5lY3Rpb24gZmFpbHVyZVxuICBtb2NrQ29ubmVjdGlvbkZhaWx1cmUoc2VydmVyTmFtZSA9ICdOZXR3b3JrLUZTJykge1xuICAgIHRoaXMuaW5pdGlhbGl6ZS5tb2NrUmVqZWN0ZWRWYWx1ZShcbiAgICAgIG5ldyBFcnJvcihgRmFpbGVkIHRvIGNvbm5lY3QgdG8gJHtzZXJ2ZXJOYW1lfSBNQ1Agc2VydmVyYClcbiAgICApO1xuICB9XG5cbiAgLy8gTW9jayByb2xsYmFjayBzdWNjZXNzXG4gIG1vY2tSb2xsYmFja1N1Y2Nlc3MoKSB7XG4gICAgdGhpcy5yb2xsYmFja0RlcGxveW1lbnQubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIHJvbGxlZEJhY2s6IHRydWUsXG4gICAgICByZXN0b3JlZEZpbGVzOiAxMlxuICAgIH0pO1xuICB9XG5cbiAgLy8gVXRpbGl0eSBtZXRob2RzIGZvciB0ZXN0IHN0YXRlIG1hbmFnZW1lbnRcbiAgaXNEZXBsb3ltZW50SW5Qcm9ncmVzcygpIHtcbiAgICByZXR1cm4gdGhpcy5fZGVwbG95bWVudEluUHJvZ3Jlc3M7XG4gIH1cblxuICBzZXRTZXJ2ZXJIZWFsdGgoc2VydmVyTmFtZSwgc3RhdHVzLCBlcnJvciA9IG51bGwpIHtcbiAgICB0aGlzLl9oZWFsdGhTdGF0dXMuc2V0KHNlcnZlck5hbWUsIHtcbiAgICAgIHN0YXR1cyxcbiAgICAgIGxhc3RFcnJvcjogZXJyb3IsXG4gICAgICBsYXN0Q2hlY2s6IG5ldyBEYXRlKClcbiAgICB9KTtcbiAgfVxuXG4gIC8vIFJlc2V0IGFsbCBtb2NrcyB0byBkZWZhdWx0IHN0YXRlXG4gIHJlc2V0KCkge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIHRoaXMuX2RlcGxveW1lbnRJblByb2dyZXNzID0gZmFsc2U7XG4gICAgdGhpcy5faGVhbHRoU3RhdHVzLmNsZWFyKCk7XG4gICAgdGhpcy5fY29ubmVjdGlvblN0YXR1cy5jbGVhcigpO1xuICAgIHRoaXMuX2luaXRpYWxpemVEZWZhdWx0cygpO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0geyBNb2NrTUNQQ29vcmRpbmF0b3IgfTsiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTUEsa0JBQWtCLENBQUM7RUFDdkJDLFdBQVdBLENBQUEsRUFBRztJQUNaLElBQUksQ0FBQ0MsbUJBQW1CLEdBQUdDLElBQUksQ0FBQ0MsRUFBRSxDQUFDLENBQUM7SUFDcEMsSUFBSSxDQUFDQyxZQUFZLEdBQUdGLElBQUksQ0FBQ0MsRUFBRSxDQUFDLENBQUM7SUFDN0IsSUFBSSxDQUFDRSxZQUFZLEdBQUdILElBQUksQ0FBQ0MsRUFBRSxDQUFDLENBQUM7SUFDN0IsSUFBSSxDQUFDRyxrQkFBa0IsR0FBR0osSUFBSSxDQUFDQyxFQUFFLENBQUMsQ0FBQztJQUNuQyxJQUFJLENBQUNJLFlBQVksR0FBR0wsSUFBSSxDQUFDQyxFQUFFLENBQUMsQ0FBQztJQUM3QixJQUFJ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