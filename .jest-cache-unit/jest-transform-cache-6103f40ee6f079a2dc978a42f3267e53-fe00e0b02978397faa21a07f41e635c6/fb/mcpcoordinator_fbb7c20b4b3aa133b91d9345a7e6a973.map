{"version":3,"names":["exec","require","promisify","execAsync","Logger","MCPCoordinator","constructor","connections","Map","healthStatus","retryAttempts","config","logger","initialize","mcp","networkFs","wrapper","timeout","retries","github","monitoring","healthCheckInterval","initializeNetworkFS","initializeGitHub","startHealthMonitoring","info","result","executeCommand","set","status","lastCheck","Date","error","lastError","message","transferFile","sourcePath","destinationPath","options","command","action","source","destination","executeNetworkFSCommand","createBackup","configPath","backupPath","compression","timestamp","toISOString","restoreBackup","targetPath","preservePermissions","validateConfiguration","path","validator","listDirectory","recursive","cloneRepository","repository","branch","depth","executeGitHubCommand","pullRepository","repositoryPath","force","getFileContent","filePath","getCommitInfo","commitSha","commit","listReleases","limit","executeMCPCommand","serverType","connection","get","Error","maxRetries","attempt","warn","sleep","commandStr","JSON","stringify","execCommand","debug","stdout","stderr","maxBuffer","parse","output","interval","setInterval","checkHealth","startTime","now","responseTime","consecutiveFailures","currentHealth","failures","attemptReconnection","getConnectionStatus","getHealthStatus","getAllStatus","health","ms","Promise","resolve","setTimeout","module","exports"],"sources":["mcp-coordinator.js"],"sourcesContent":["const { exec } = require('child_process');\nconst { promisify } = require('util');\nconst execAsync = promisify(exec);\nconst { Logger } = require('../utils/logger');\n\nclass MCPCoordinator {\n  constructor() {\n    this.connections = new Map();\n    this.healthStatus = new Map();\n    this.retryAttempts = new Map();\n    this.config = null;\n    this.logger = new Logger('MCP-Coordinator');\n  }\n\n  async initialize() {\n    // Initialize default configuration\n    this.config = {\n      mcp: {\n        networkFs: {\n          wrapper: '/home/dev/workspace/network-mcp-wrapper.sh',\n          timeout: 30000,\n          retries: 3\n        },\n        github: {\n          wrapper: '/home/dev/workspace/github-wrapper.sh',\n          timeout: 30000,\n          retries: 3\n        }\n      },\n      monitoring: {\n        healthCheckInterval: 60\n      }\n    };\n    \n    // Initialize MCP server connections\n    await this.initializeNetworkFS();\n    await this.initializeGitHub();\n    \n    // Start health monitoring\n    this.startHealthMonitoring();\n    \n    this.logger.info('MCP Coordinator initialized successfully');\n  }\n\n  async initializeNetworkFS() {\n    const config = this.config.mcp.networkFs;\n    \n    try {\n      // Test Network-FS MCP connection\n      const result = await this.executeCommand(config.wrapper, 'health-check', 5000);\n      \n      this.connections.set('networkFs', {\n        wrapper: config.wrapper,\n        timeout: config.timeout,\n        retries: config.retries,\n        status: 'connected',\n        lastCheck: new Date()\n      });\n      \n      this.logger.info('Network-FS MCP server connected successfully');\n    } catch (error) {\n      this.logger.error('Failed to connect to Network-FS MCP server', error);\n      // Still set connection for retry logic\n      this.connections.set('networkFs', {\n        wrapper: config.wrapper,\n        timeout: config.timeout,\n        retries: config.retries,\n        status: 'failed',\n        lastCheck: new Date(),\n        lastError: error.message\n      });\n    }\n  }\n\n  async initializeGitHub() {\n    const config = this.config.mcp.github;\n    \n    try {\n      // Test GitHub MCP connection\n      const result = await this.executeCommand(config.wrapper, 'health-check', 5000);\n      \n      this.connections.set('github', {\n        wrapper: config.wrapper,\n        timeout: config.timeout,\n        retries: config.retries,\n        status: 'connected',\n        lastCheck: new Date()\n      });\n      \n      this.logger.info('GitHub MCP server connected successfully');\n    } catch (error) {\n      this.logger.error('Failed to connect to GitHub MCP server', error);\n      // Still set connection for retry logic\n      this.connections.set('github', {\n        wrapper: config.wrapper,\n        timeout: config.timeout,\n        retries: config.retries,\n        status: 'failed',\n        lastCheck: new Date(),\n        lastError: error.message\n      });\n    }\n  }\n\n  // Network-FS MCP Operations\n  async transferFile(sourcePath, destinationPath, options = {}) {\n    const command = {\n      action: 'transfer-file',\n      source: sourcePath,\n      destination: destinationPath,\n      ...options\n    };\n    \n    return await this.executeNetworkFSCommand(command);\n  }\n\n  async createBackup(configPath, backupPath) {\n    const command = {\n      action: 'create-backup',\n      source: configPath,\n      destination: backupPath,\n      compression: true,\n      timestamp: new Date().toISOString()\n    };\n    \n    return await this.executeNetworkFSCommand(command);\n  }\n\n  async restoreBackup(backupPath, targetPath) {\n    const command = {\n      action: 'restore-backup',\n      source: backupPath,\n      destination: targetPath,\n      preservePermissions: true\n    };\n    \n    return await this.executeNetworkFSCommand(command);\n  }\n\n  async validateConfiguration(configPath) {\n    const command = {\n      action: 'validate-config',\n      path: configPath,\n      validator: 'home-assistant'\n    };\n    \n    return await this.executeNetworkFSCommand(command);\n  }\n\n  async listDirectory(path) {\n    const command = {\n      action: 'list-directory',\n      path: path,\n      recursive: false\n    };\n    \n    return await this.executeNetworkFSCommand(command);\n  }\n\n  // GitHub MCP Operations\n  async cloneRepository(repository, branch, targetPath) {\n    const command = {\n      action: 'clone-repository',\n      repository: repository,\n      branch: branch,\n      destination: targetPath,\n      depth: 1\n    };\n    \n    return await this.executeGitHubCommand(command);\n  }\n\n  async pullRepository(repositoryPath, branch) {\n    const command = {\n      action: 'pull-repository',\n      path: repositoryPath,\n      branch: branch,\n      force: false\n    };\n    \n    return await this.executeGitHubCommand(command);\n  }\n\n  async getFileContent(repository, branch, filePath) {\n    const command = {\n      action: 'get-file-content',\n      repository: repository,\n      branch: branch,\n      path: filePath\n    };\n    \n    return await this.executeGitHubCommand(command);\n  }\n\n  async getCommitInfo(repository, commitSha) {\n    const command = {\n      action: 'get-commit-info',\n      repository: repository,\n      commit: commitSha\n    };\n    \n    return await this.executeGitHubCommand(command);\n  }\n\n  async listReleases(repository, limit = 10) {\n    const command = {\n      action: 'list-releases',\n      repository: repository,\n      limit: limit\n    };\n    \n    return await this.executeGitHubCommand(command);\n  }\n\n  // MCP Command Execution\n  async executeNetworkFSCommand(command) {\n    return await this.executeMCPCommand('networkFs', command);\n  }\n\n  async executeGitHubCommand(command) {\n    return await this.executeMCPCommand('github', command);\n  }\n\n  async executeMCPCommand(serverType, command) {\n    const connection = this.connections.get(serverType);\n    if (!connection) {\n      throw new Error(`MCP server ${serverType} not connected`);\n    }\n\n    const maxRetries = connection.retries || 3;\n    let lastError;\n\n    for (let attempt = 1; attempt <= maxRetries; attempt++) {\n      try {\n        const result = await this.executeCommand(connection.wrapper, command, connection.timeout);\n        \n        // Update connection status\n        connection.status = 'connected';\n        connection.lastCheck = new Date();\n        this.retryAttempts.set(serverType, 0);\n        \n        return result;\n      } catch (error) {\n        lastError = error;\n        this.logger.warn(`MCP command failed (attempt ${attempt}/${maxRetries})`, {\n          serverType,\n          command: command.action || command,\n          error: error.message\n        });\n        \n        if (attempt < maxRetries) {\n          await this.sleep(1000 * attempt); // Exponential backoff\n        }\n      }\n    }\n\n    // Mark connection as failed\n    connection.status = 'failed';\n    connection.lastError = lastError;\n    this.retryAttempts.set(serverType, (this.retryAttempts.get(serverType) || 0) + 1);\n    \n    throw new Error(`MCP command failed after ${maxRetries} attempts: ${lastError.message}`);\n  }\n\n  async executeCommand(wrapper, command, timeout) {\n    const commandStr = typeof command === 'string' ? command : JSON.stringify(command);\n    const execCommand = `${wrapper} '${commandStr}'`;\n    \n    this.logger.debug('Executing MCP command', { command: execCommand });\n    \n    const { stdout, stderr } = await execAsync(execCommand, {\n      timeout: timeout || 30000,\n      maxBuffer: 1024 * 1024 * 10 // 10MB buffer\n    });\n    \n    if (stderr) {\n      this.logger.warn('MCP command stderr', { stderr });\n    }\n    \n    try {\n      return JSON.parse(stdout);\n    } catch (error) {\n      return { output: stdout, error: stderr };\n    }\n  }\n\n  // Health Monitoring\n  startHealthMonitoring() {\n    const interval = this.config.monitoring?.healthCheckInterval || 60;\n    \n    setInterval(async () => {\n      await this.checkHealth();\n    }, interval * 1000);\n    \n    this.logger.info(`Health monitoring started (interval: ${interval}s)`);\n  }\n\n  async checkHealth() {\n    for (const [serverType, connection] of this.connections) {\n      try {\n        const startTime = Date.now();\n        await this.executeCommand(connection.wrapper, 'health-check', 10000);\n        const responseTime = Date.now() - startTime;\n        \n        this.healthStatus.set(serverType, {\n          status: 'healthy',\n          responseTime: responseTime,\n          lastCheck: new Date(),\n          consecutiveFailures: 0\n        });\n        \n        this.logger.debug(`Health check passed for ${serverType}`, { responseTime });\n      } catch (error) {\n        const currentHealth = this.healthStatus.get(serverType) || { consecutiveFailures: 0 };\n        const failures = currentHealth.consecutiveFailures + 1;\n        \n        this.healthStatus.set(serverType, {\n          status: 'unhealthy',\n          lastCheck: new Date(),\n          lastError: error.message,\n          consecutiveFailures: failures\n        });\n        \n        this.logger.error(`Health check failed for ${serverType}`, {\n          error: error.message,\n          consecutiveFailures: failures\n        });\n        \n        // Attempt reconnection after multiple failures\n        if (failures >= 3) {\n          await this.attemptReconnection(serverType);\n        }\n      }\n    }\n  }\n\n  async attemptReconnection(serverType) {\n    this.logger.info(`Attempting to reconnect to ${serverType}`);\n    \n    try {\n      if (serverType === 'networkFs') {\n        await this.initializeNetworkFS();\n      } else if (serverType === 'github') {\n        await this.initializeGitHub();\n      }\n      \n      this.logger.info(`Successfully reconnected to ${serverType}`);\n    } catch (error) {\n      this.logger.error(`Failed to reconnect to ${serverType}`, error);\n    }\n  }\n\n  // Utility Methods\n  getConnectionStatus(serverType) {\n    return this.connections.get(serverType);\n  }\n\n  getHealthStatus(serverType) {\n    return this.healthStatus.get(serverType);\n  }\n\n  getAllStatus() {\n    const status = {};\n    \n    for (const [serverType] of this.connections) {\n      status[serverType] = {\n        connection: this.getConnectionStatus(serverType),\n        health: this.getHealthStatus(serverType)\n      };\n    }\n    \n    return status;\n  }\n\n  async sleep(ms) {\n    return new Promise(resolve => setTimeout(resolve, ms));\n  }\n}\n\nmodule.exports = { MCPCoordinator };"],"mappings":"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","ignoreList":[]}