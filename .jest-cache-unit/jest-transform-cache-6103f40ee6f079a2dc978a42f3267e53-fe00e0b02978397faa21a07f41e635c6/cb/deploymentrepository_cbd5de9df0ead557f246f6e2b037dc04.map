{"version":3,"names":["sqlite3","require","verbose","open","path","fs","promises","DeploymentRepository","constructor","options","config","database","type","join","__dirname","db","logger","isInitialized","initialize","dbDir","dirname","mkdir","recursive","filename","driver","Database","exec","runMigrations","info","error","message","migrations","version","name","sql","hasMigrationsTable","get","migration","debug","run","appliedMigrations","all","appliedVersions","Set","map","m","has","createDeployment","deployment","ensureInitialized","params","id","repository","branch","status","priority","requestedBy","requestedAt","correlationId","trigger","webhookData","JSON","stringify","parameters","retryCount","maxRetries","originalDeploymentId","deploymentId","getDeployment","deserializeDeployment","updateDeployment","updates","allowedFields","setClause","key","value","Object","entries","includes","push","length","Error","updated_at","result","changes","updatedFields","keys","getRecentDeployments","limit","deployments","d","getDeploymentHistory","page","startDate","endDate","offset","conditions","whereClause","countSql","total","dataSql","pagination","pages","Math","ceil","hasNext","hasPrev","addDeploymentLog","logType","logLevel","metadata","getDeploymentLogs","logs","log","parse","addDeploymentFile","fileData","operation","size","hash","backupPath","lastID","filePath","updateDeploymentFile","fileId","getDeploymentFiles","recordMetric","metricName","metricValue","metricUnit","getDeploymentMetrics","metrics","metric","getDeploymentStats","timeRange","timeRanges","since","stats","totalSql","total_deployments","totalDeployments","byStatus","reduce","acc","stat","count","avgDurationSeconds","avg_duration_seconds","cleanup","olderThanDays","cutoffDate","Date","setDate","getDate","logsResult","toISOString","metricsResult","filesResult","deploymentsResult","deletedLogs","deletedMetrics","deletedFiles","deletedDeployments","checkHealth","webhook_data","requested_by","requested_at","startedAt","started_at","completedAt","completed_at","correlation_id","triggerType","trigger_type","backup_path","errorMessage","error_message","retry_count","max_retries","original_deployment_id","rollbackId","rollback_id","createdAt","created_at","updatedAt","close","module","exports"],"sources":["deployment-repository.js"],"sourcesContent":["const sqlite3 = require('sqlite3').verbose();\nconst { open } = require('sqlite');\nconst path = require('path');\nconst fs = require('fs').promises;\n\nclass DeploymentRepository {\n  constructor(options = {}) {\n    this.config = options.database || {\n      type: 'sqlite',\n      path: path.join(__dirname, '../../../logs/deployments.db')\n    };\n    \n    this.db = null;\n    this.logger = options.logger;\n    this.isInitialized = false;\n  }\n\n  async initialize() {\n    try {\n      // Ensure database directory exists\n      const dbDir = path.dirname(this.config.path);\n      await fs.mkdir(dbDir, { recursive: true });\n      \n      // Open database connection\n      this.db = await open({\n        filename: this.config.path,\n        driver: sqlite3.Database\n      });\n      \n      // Enable foreign keys\n      await this.db.exec('PRAGMA foreign_keys = ON');\n      \n      // Run migrations\n      await this.runMigrations();\n      \n      this.isInitialized = true;\n      this.logger?.info('Database initialized successfully', { \n        path: this.config.path,\n        type: this.config.type\n      });\n      \n      return true;\n      \n    } catch (error) {\n      this.logger?.error('Failed to initialize database', {\n        error: error.message,\n        path: this.config.path\n      });\n      throw error;\n    }\n  }\n\n  async runMigrations() {\n    const migrations = [\n      {\n        version: 1,\n        name: 'initial_schema',\n        sql: `\n          CREATE TABLE IF NOT EXISTS deployments (\n            id TEXT PRIMARY KEY,\n            repository TEXT NOT NULL,\n            branch TEXT NOT NULL DEFAULT 'main',\n            status TEXT NOT NULL DEFAULT 'queued',\n            type TEXT NOT NULL DEFAULT 'deployment',\n            priority TEXT NOT NULL DEFAULT 'normal',\n            requested_by TEXT NOT NULL,\n            requested_at DATETIME NOT NULL,\n            started_at DATETIME,\n            completed_at DATETIME,\n            correlation_id TEXT,\n            trigger_type TEXT,\n            webhook_data TEXT,\n            parameters TEXT,\n            backup_path TEXT,\n            error_message TEXT,\n            retry_count INTEGER DEFAULT 0,\n            max_retries INTEGER DEFAULT 3,\n            original_deployment_id TEXT,\n            rollback_id TEXT,\n            created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n            updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n            FOREIGN KEY (original_deployment_id) REFERENCES deployments(id)\n          );\n        `\n      },\n      {\n        version: 2,\n        name: 'deployment_logs',\n        sql: `\n          CREATE TABLE IF NOT EXISTS deployment_logs (\n            id INTEGER PRIMARY KEY AUTOINCREMENT,\n            deployment_id TEXT NOT NULL,\n            log_level TEXT NOT NULL DEFAULT 'info',\n            log_type TEXT NOT NULL DEFAULT 'stdout',\n            message TEXT NOT NULL,\n            timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,\n            metadata TEXT,\n            FOREIGN KEY (deployment_id) REFERENCES deployments(id) ON DELETE CASCADE\n          );\n          \n          CREATE INDEX IF NOT EXISTS idx_deployment_logs_deployment_id \n          ON deployment_logs(deployment_id);\n          \n          CREATE INDEX IF NOT EXISTS idx_deployment_logs_timestamp \n          ON deployment_logs(timestamp);\n        `\n      },\n      {\n        version: 3,\n        name: 'deployment_metrics',\n        sql: `\n          CREATE TABLE IF NOT EXISTS deployment_metrics (\n            id INTEGER PRIMARY KEY AUTOINCREMENT,\n            deployment_id TEXT NOT NULL,\n            metric_name TEXT NOT NULL,\n            metric_value REAL NOT NULL,\n            metric_unit TEXT,\n            timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,\n            metadata TEXT,\n            FOREIGN KEY (deployment_id) REFERENCES deployments(id) ON DELETE CASCADE\n          );\n          \n          CREATE INDEX IF NOT EXISTS idx_deployment_metrics_deployment_id \n          ON deployment_metrics(deployment_id);\n          \n          CREATE INDEX IF NOT EXISTS idx_deployment_metrics_name \n          ON deployment_metrics(metric_name);\n        `\n      },\n      {\n        version: 4,\n        name: 'deployment_files',\n        sql: `\n          CREATE TABLE IF NOT EXISTS deployment_files (\n            id INTEGER PRIMARY KEY AUTOINCREMENT,\n            deployment_id TEXT NOT NULL,\n            file_path TEXT NOT NULL,\n            file_operation TEXT NOT NULL,\n            file_size INTEGER,\n            file_hash TEXT,\n            backup_path TEXT,\n            status TEXT NOT NULL DEFAULT 'pending',\n            error_message TEXT,\n            processed_at DATETIME,\n            created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n            FOREIGN KEY (deployment_id) REFERENCES deployments(id) ON DELETE CASCADE\n          );\n          \n          CREATE INDEX IF NOT EXISTS idx_deployment_files_deployment_id \n          ON deployment_files(deployment_id);\n        `\n      },\n      {\n        version: 5,\n        name: 'schema_migrations',\n        sql: `\n          CREATE TABLE IF NOT EXISTS schema_migrations (\n            version INTEGER PRIMARY KEY,\n            name TEXT NOT NULL,\n            applied_at DATETIME DEFAULT CURRENT_TIMESTAMP\n          );\n        `\n      }\n    ];\n\n    // Check if migrations table exists\n    const hasMigrationsTable = await this.db.get(`\n      SELECT name FROM sqlite_master \n      WHERE type='table' AND name='schema_migrations'\n    `);\n\n    if (!hasMigrationsTable) {\n      // Run all migrations for fresh database\n      for (const migration of migrations) {\n        await this.db.exec(migration.sql);\n        this.logger?.debug('Applied migration', { \n          version: migration.version, \n          name: migration.name \n        });\n      }\n      \n      // Record all migrations as applied\n      for (const migration of migrations) {\n        await this.db.run(\n          'INSERT OR IGNORE INTO schema_migrations (version, name) VALUES (?, ?)',\n          [migration.version, migration.name]\n        );\n      }\n    } else {\n      // Run only pending migrations\n      const appliedMigrations = await this.db.all(\n        'SELECT version FROM schema_migrations ORDER BY version'\n      );\n      \n      const appliedVersions = new Set(appliedMigrations.map(m => m.version));\n      \n      for (const migration of migrations) {\n        if (!appliedVersions.has(migration.version)) {\n          await this.db.exec(migration.sql);\n          await this.db.run(\n            'INSERT INTO schema_migrations (version, name) VALUES (?, ?)',\n            [migration.version, migration.name]\n          );\n          \n          this.logger?.info('Applied migration', { \n            version: migration.version, \n            name: migration.name \n          });\n        }\n      }\n    }\n  }\n\n  async createDeployment(deployment) {\n    this.ensureInitialized();\n    \n    const sql = `\n      INSERT INTO deployments (\n        id, repository, branch, status, type, priority, requested_by, \n        requested_at, correlation_id, trigger_type, webhook_data, \n        parameters, retry_count, max_retries, original_deployment_id\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n    `;\n    \n    const params = [\n      deployment.id,\n      deployment.repository,\n      deployment.branch || 'main',\n      deployment.status || 'queued',\n      deployment.type || 'deployment',\n      deployment.priority || 'normal',\n      deployment.requestedBy,\n      deployment.requestedAt,\n      deployment.correlationId,\n      deployment.trigger || null,\n      deployment.webhookData ? JSON.stringify(deployment.webhookData) : null,\n      deployment.parameters ? JSON.stringify(deployment.parameters) : null,\n      deployment.retryCount || 0,\n      deployment.maxRetries || 3,\n      deployment.originalDeploymentId || null\n    ];\n    \n    try {\n      await this.db.run(sql, params);\n      \n      this.logger?.debug('Deployment created in database', { \n        deploymentId: deployment.id,\n        repository: deployment.repository\n      });\n      \n      return deployment.id;\n      \n    } catch (error) {\n      this.logger?.error('Failed to create deployment', {\n        deploymentId: deployment.id,\n        error: error.message\n      });\n      throw error;\n    }\n  }\n\n  async getDeployment(deploymentId) {\n    this.ensureInitialized();\n    \n    const sql = `\n      SELECT \n        id, repository, branch, status, type, priority, requested_by,\n        requested_at, started_at, completed_at, correlation_id,\n        trigger_type, webhook_data, parameters, backup_path,\n        error_message, retry_count, max_retries, original_deployment_id,\n        rollback_id, created_at, updated_at\n      FROM deployments \n      WHERE id = ?\n    `;\n    \n    try {\n      const deployment = await this.db.get(sql, [deploymentId]);\n      \n      if (deployment) {\n        return this.deserializeDeployment(deployment);\n      }\n      \n      return null;\n      \n    } catch (error) {\n      this.logger?.error('Failed to get deployment', {\n        deploymentId,\n        error: error.message\n      });\n      throw error;\n    }\n  }\n\n  async updateDeployment(deploymentId, updates) {\n    this.ensureInitialized();\n    \n    const allowedFields = [\n      'status', 'started_at', 'completed_at', 'backup_path',\n      'error_message', 'retry_count', 'rollback_id', 'updated_at'\n    ];\n    \n    const setClause = [];\n    const params = [];\n    \n    for (const [key, value] of Object.entries(updates)) {\n      if (allowedFields.includes(key)) {\n        setClause.push(`${key} = ?`);\n        params.push(value);\n      }\n    }\n    \n    if (setClause.length === 0) {\n      throw new Error('No valid fields to update');\n    }\n    \n    // Always update the updated_at timestamp\n    if (!updates.updated_at) {\n      setClause.push('updated_at = CURRENT_TIMESTAMP');\n    }\n    \n    params.push(deploymentId);\n    \n    const sql = `UPDATE deployments SET ${setClause.join(', ')} WHERE id = ?`;\n    \n    try {\n      const result = await this.db.run(sql, params);\n      \n      if (result.changes === 0) {\n        throw new Error(`Deployment ${deploymentId} not found`);\n      }\n      \n      this.logger?.debug('Deployment updated', {\n        deploymentId,\n        updatedFields: Object.keys(updates)\n      });\n      \n      return result.changes;\n      \n    } catch (error) {\n      this.logger?.error('Failed to update deployment', {\n        deploymentId,\n        error: error.message\n      });\n      throw error;\n    }\n  }\n\n  async getRecentDeployments(limit = 10) {\n    this.ensureInitialized();\n    \n    const sql = `\n      SELECT \n        id, repository, branch, status, type, priority, requested_by,\n        requested_at, started_at, completed_at, correlation_id,\n        trigger_type, error_message, retry_count, created_at\n      FROM deployments \n      ORDER BY requested_at DESC \n      LIMIT ?\n    `;\n    \n    try {\n      const deployments = await this.db.all(sql, [limit]);\n      return deployments.map(d => this.deserializeDeployment(d));\n      \n    } catch (error) {\n      this.logger?.error('Failed to get recent deployments', {\n        error: error.message\n      });\n      throw error;\n    }\n  }\n\n  async getDeploymentHistory(options = {}) {\n    this.ensureInitialized();\n    \n    const {\n      page = 1,\n      limit = 20,\n      status = null,\n      repository = null,\n      startDate = null,\n      endDate = null\n    } = options;\n    \n    const offset = (page - 1) * limit;\n    const conditions = [];\n    const params = [];\n    \n    if (status) {\n      conditions.push('status = ?');\n      params.push(status);\n    }\n    \n    if (repository) {\n      conditions.push('repository = ?');\n      params.push(repository);\n    }\n    \n    if (startDate) {\n      conditions.push('requested_at >= ?');\n      params.push(startDate);\n    }\n    \n    if (endDate) {\n      conditions.push('requested_at <= ?');\n      params.push(endDate);\n    }\n    \n    const whereClause = conditions.length > 0 ? `WHERE ${conditions.join(' AND ')}` : '';\n    \n    // Get total count\n    const countSql = `SELECT COUNT(*) as total FROM deployments ${whereClause}`;\n    const { total } = await this.db.get(countSql, params);\n    \n    // Get page data\n    const dataSql = `\n      SELECT \n        id, repository, branch, status, type, priority, requested_by,\n        requested_at, started_at, completed_at, correlation_id,\n        trigger_type, error_message, retry_count, created_at\n      FROM deployments \n      ${whereClause}\n      ORDER BY requested_at DESC \n      LIMIT ? OFFSET ?\n    `;\n    \n    const deployments = await this.db.all(dataSql, [...params, limit, offset]);\n    \n    return {\n      deployments: deployments.map(d => this.deserializeDeployment(d)),\n      pagination: {\n        page,\n        limit,\n        total,\n        pages: Math.ceil(total / limit),\n        hasNext: page * limit < total,\n        hasPrev: page > 1\n      }\n    };\n  }\n\n  async addDeploymentLog(deploymentId, logType, message, logLevel = 'info', metadata = null) {\n    this.ensureInitialized();\n    \n    const sql = `\n      INSERT INTO deployment_logs (deployment_id, log_level, log_type, message, metadata)\n      VALUES (?, ?, ?, ?, ?)\n    `;\n    \n    const params = [\n      deploymentId,\n      logLevel,\n      logType,\n      message,\n      metadata ? JSON.stringify(metadata) : null\n    ];\n    \n    try {\n      await this.db.run(sql, params);\n      \n      this.logger?.debug('Deployment log added', {\n        deploymentId,\n        logType,\n        logLevel\n      });\n      \n    } catch (error) {\n      this.logger?.error('Failed to add deployment log', {\n        deploymentId,\n        error: error.message\n      });\n      throw error;\n    }\n  }\n\n  async getDeploymentLogs(deploymentId, limit = 100) {\n    this.ensureInitialized();\n    \n    const sql = `\n      SELECT log_level, log_type, message, timestamp, metadata\n      FROM deployment_logs \n      WHERE deployment_id = ?\n      ORDER BY timestamp DESC\n      LIMIT ?\n    `;\n    \n    try {\n      const logs = await this.db.all(sql, [deploymentId, limit]);\n      \n      return logs.map(log => ({\n        ...log,\n        metadata: log.metadata ? JSON.parse(log.metadata) : null\n      }));\n      \n    } catch (error) {\n      this.logger?.error('Failed to get deployment logs', {\n        deploymentId,\n        error: error.message\n      });\n      throw error;\n    }\n  }\n\n  async addDeploymentFile(deploymentId, fileData) {\n    this.ensureInitialized();\n    \n    const sql = `\n      INSERT INTO deployment_files (\n        deployment_id, file_path, file_operation, file_size, \n        file_hash, backup_path, status\n      ) VALUES (?, ?, ?, ?, ?, ?, ?)\n    `;\n    \n    const params = [\n      deploymentId,\n      fileData.path,\n      fileData.operation,\n      fileData.size || null,\n      fileData.hash || null,\n      fileData.backupPath || null,\n      fileData.status || 'pending'\n    ];\n    \n    try {\n      const result = await this.db.run(sql, params);\n      return result.lastID;\n      \n    } catch (error) {\n      this.logger?.error('Failed to add deployment file', {\n        deploymentId,\n        filePath: fileData.path,\n        error: error.message\n      });\n      throw error;\n    }\n  }\n\n  async updateDeploymentFile(fileId, updates) {\n    this.ensureInitialized();\n    \n    const allowedFields = ['status', 'error_message', 'processed_at'];\n    const setClause = [];\n    const params = [];\n    \n    for (const [key, value] of Object.entries(updates)) {\n      if (allowedFields.includes(key)) {\n        setClause.push(`${key} = ?`);\n        params.push(value);\n      }\n    }\n    \n    if (setClause.length === 0) {\n      throw new Error('No valid fields to update');\n    }\n    \n    params.push(fileId);\n    \n    const sql = `UPDATE deployment_files SET ${setClause.join(', ')} WHERE id = ?`;\n    \n    try {\n      const result = await this.db.run(sql, params);\n      return result.changes;\n      \n    } catch (error) {\n      this.logger?.error('Failed to update deployment file', {\n        fileId,\n        error: error.message\n      });\n      throw error;\n    }\n  }\n\n  async getDeploymentFiles(deploymentId) {\n    this.ensureInitialized();\n    \n    const sql = `\n      SELECT id, file_path, file_operation, file_size, file_hash,\n             backup_path, status, error_message, processed_at, created_at\n      FROM deployment_files \n      WHERE deployment_id = ?\n      ORDER BY created_at ASC\n    `;\n    \n    try {\n      return await this.db.all(sql, [deploymentId]);\n      \n    } catch (error) {\n      this.logger?.error('Failed to get deployment files', {\n        deploymentId,\n        error: error.message\n      });\n      throw error;\n    }\n  }\n\n  async recordMetric(deploymentId, metricName, metricValue, metricUnit = null, metadata = null) {\n    this.ensureInitialized();\n    \n    const sql = `\n      INSERT INTO deployment_metrics (deployment_id, metric_name, metric_value, metric_unit, metadata)\n      VALUES (?, ?, ?, ?, ?)\n    `;\n    \n    const params = [\n      deploymentId,\n      metricName,\n      metricValue,\n      metricUnit,\n      metadata ? JSON.stringify(metadata) : null\n    ];\n    \n    try {\n      await this.db.run(sql, params);\n      \n    } catch (error) {\n      this.logger?.error('Failed to record metric', {\n        deploymentId,\n        metricName,\n        error: error.message\n      });\n      throw error;\n    }\n  }\n\n  async getDeploymentMetrics(deploymentId) {\n    this.ensureInitialized();\n    \n    const sql = `\n      SELECT metric_name, metric_value, metric_unit, timestamp, metadata\n      FROM deployment_metrics \n      WHERE deployment_id = ?\n      ORDER BY timestamp ASC\n    `;\n    \n    try {\n      const metrics = await this.db.all(sql, [deploymentId]);\n      \n      return metrics.map(metric => ({\n        ...metric,\n        metadata: metric.metadata ? JSON.parse(metric.metadata) : null\n      }));\n      \n    } catch (error) {\n      this.logger?.error('Failed to get deployment metrics', {\n        deploymentId,\n        error: error.message\n      });\n      throw error;\n    }\n  }\n\n  async getDeploymentStats(timeRange = '24h') {\n    this.ensureInitialized();\n    \n    const timeRanges = {\n      '1h': 'datetime(\"now\", \"-1 hour\")',\n      '24h': 'datetime(\"now\", \"-1 day\")',\n      '7d': 'datetime(\"now\", \"-7 days\")',\n      '30d': 'datetime(\"now\", \"-30 days\")'\n    };\n    \n    const since = timeRanges[timeRange] || timeRanges['24h'];\n    \n    const sql = `\n      SELECT \n        status,\n        COUNT(*) as count,\n        AVG(\n          CASE \n            WHEN started_at IS NOT NULL AND completed_at IS NOT NULL \n            THEN (julianday(completed_at) - julianday(started_at)) * 24 * 60 * 60\n            ELSE NULL \n          END\n        ) as avg_duration_seconds\n      FROM deployments \n      WHERE requested_at >= ${since}\n      GROUP BY status\n    `;\n    \n    try {\n      const stats = await this.db.all(sql);\n      \n      const totalSql = `\n        SELECT COUNT(*) as total_deployments\n        FROM deployments \n        WHERE requested_at >= ${since}\n      `;\n      \n      const { total_deployments } = await this.db.get(totalSql);\n      \n      return {\n        timeRange,\n        totalDeployments: total_deployments,\n        byStatus: stats.reduce((acc, stat) => {\n          acc[stat.status] = {\n            count: stat.count,\n            avgDurationSeconds: stat.avg_duration_seconds\n          };\n          return acc;\n        }, {})\n      };\n      \n    } catch (error) {\n      this.logger?.error('Failed to get deployment stats', {\n        timeRange,\n        error: error.message\n      });\n      throw error;\n    }\n  }\n\n  async cleanup(olderThanDays = 30) {\n    this.ensureInitialized();\n    \n    try {\n      const cutoffDate = new Date();\n      cutoffDate.setDate(cutoffDate.getDate() - olderThanDays);\n      \n      // Delete old logs first (foreign key constraint)\n      const logsResult = await this.db.run(`\n        DELETE FROM deployment_logs \n        WHERE deployment_id IN (\n          SELECT id FROM deployments \n          WHERE completed_at < ? \n          AND status IN ('completed', 'failed', 'rolled-back')\n        )\n      `, [cutoffDate.toISOString()]);\n      \n      // Delete old metrics\n      const metricsResult = await this.db.run(`\n        DELETE FROM deployment_metrics \n        WHERE deployment_id IN (\n          SELECT id FROM deployments \n          WHERE completed_at < ? \n          AND status IN ('completed', 'failed', 'rolled-back')\n        )\n      `, [cutoffDate.toISOString()]);\n      \n      // Delete old files\n      const filesResult = await this.db.run(`\n        DELETE FROM deployment_files \n        WHERE deployment_id IN (\n          SELECT id FROM deployments \n          WHERE completed_at < ? \n          AND status IN ('completed', 'failed', 'rolled-back')\n        )\n      `, [cutoffDate.toISOString()]);\n      \n      // Delete old deployments\n      const deploymentsResult = await this.db.run(`\n        DELETE FROM deployments \n        WHERE completed_at < ? \n        AND status IN ('completed', 'failed', 'rolled-back')\n      `, [cutoffDate.toISOString()]);\n      \n      this.logger?.info('Database cleanup completed', {\n        olderThanDays,\n        deletedLogs: logsResult.changes,\n        deletedMetrics: metricsResult.changes,\n        deletedFiles: filesResult.changes,\n        deletedDeployments: deploymentsResult.changes\n      });\n      \n      return {\n        deletedLogs: logsResult.changes,\n        deletedMetrics: metricsResult.changes,\n        deletedFiles: filesResult.changes,\n        deletedDeployments: deploymentsResult.changes\n      };\n      \n    } catch (error) {\n      this.logger?.error('Database cleanup failed', {\n        error: error.message\n      });\n      throw error;\n    }\n  }\n\n  async checkHealth() {\n    try {\n      if (!this.db) {\n        return { status: 'unhealthy', error: 'Database not initialized' };\n      }\n      \n      // Test database connection\n      await this.db.get('SELECT 1');\n      \n      // Get basic stats\n      const stats = await this.db.get(`\n        SELECT \n          (SELECT COUNT(*) FROM deployments) as total_deployments,\n          (SELECT COUNT(*) FROM deployments WHERE status = 'queued') as queued,\n          (SELECT COUNT(*) FROM deployments WHERE status = 'in-progress') as in_progress\n      `);\n      \n      return {\n        status: 'healthy',\n        stats,\n        path: this.config.path\n      };\n      \n    } catch (error) {\n      return {\n        status: 'unhealthy',\n        error: error.message\n      };\n    }\n  }\n\n  deserializeDeployment(deployment) {\n    return {\n      ...deployment,\n      webhookData: deployment.webhook_data ? JSON.parse(deployment.webhook_data) : null,\n      parameters: deployment.parameters ? JSON.parse(deployment.parameters) : null,\n      requestedBy: deployment.requested_by,\n      requestedAt: deployment.requested_at,\n      startedAt: deployment.started_at,\n      completedAt: deployment.completed_at,\n      correlationId: deployment.correlation_id,\n      triggerType: deployment.trigger_type,\n      backupPath: deployment.backup_path,\n      errorMessage: deployment.error_message,\n      retryCount: deployment.retry_count,\n      maxRetries: deployment.max_retries,\n      originalDeploymentId: deployment.original_deployment_id,\n      rollbackId: deployment.rollback_id,\n      createdAt: deployment.created_at,\n      updatedAt: deployment.updated_at\n    };\n  }\n\n  ensureInitialized() {\n    if (!this.isInitialized || !this.db) {\n      throw new Error('Database not initialized. Call initialize() first.');\n    }\n  }\n\n  async close() {\n    if (this.db) {\n      await this.db.close();\n      this.db = null;\n      this.isInitialized = false;\n      \n      this.logger?.info('Database connection closed');\n    }\n  }\n}\n\nmodule.exports = DeploymentRepository;"],"mappings":"AAAA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAS,CAAC,CAACC,OAAO,CAAC,CAAC;AAC5C,MAAM;EAAEC;AAAK,CAAC,GAAGF,OAAO,CAAC,QAAQ,CAAC;AAClC,MAAMG,IAAI,GAAGH,OAAO,CAAC,MAAM,CAAC;AAC5B,MAAMI,EAAE,GAAGJ,OAAO,CAAC,IAAI,CAAC,CAACK,QAAQ;AAEjC,MAAMC,oBAAoB,CAAC;EACzBC,WAAWA,CAACC,OAAO,GAAG,CAAC,CAAC,EAAE;IACxB,IAAI,CAACC,MAAM,GAAGD,OAAO,CAACE,QAAQ,IAAI;MAChCC,IAAI,EAAE,QAAQ;MACdR,IAAI,EAAEA,IAAI,CAACS,IAAI,CAACC,SAAS,EAAE,8BAA8B;IAC3D,CAAC;IAED,IAAI,CAACC,EAAE,GAAG,IAAI;IACd,IAAI,CAACC,MAAM,GAAGP,OAAO,CAACO,MAAM;IAC5B,IAAI,CAACC,aAAa,GAAG,KAAK;EAC5B;EAEA,MAAMC,UAAUA,CAAA,EAAG;IACjB,IAAI;MACF;MACA,MAAMC,KAAK,GAAGf,IAAI,CAACgB,OAAO,CAAC,IAAI,CAACV,MAAM,CAACN,IAAI,CAAC;MAC5C,MAAMC,EAAE,CAACgB,KAAK,CAACF,KAAK,EAAE;QAAEG,SAAS,EAAE;MAAK,CAAC,CAAC;;MAE1C;MACA,IAAI,CAACP,EAAE,GAAG,MAAMZ,IAAI,CAAC;QACnBoB,QAAQ,EAAE,IAAI,CAACb,MAAM,CAACN,IAAI;QAC1BoB,MAAM,EAAExB,OAAO,CAACyB;MAClB,CAAC,CAAC;;MAEF;MACA,MAAM,IAAI,CAACV,EAAE,CAACW,IAAI,CAAC,0BAA0B,CAAC;;MAE9C;MACA,MAAM,IAAI,CAACC,aAAa,CAAC,CAAC;MAE1B,IAAI,CAACV,aAAa,GAAG,IAAI;MACzB,IAAI,CAACD,MAAM,EAAEY,IAAI,CAAC,mCAAmC,EAAE;QACrDxB,IAAI,EAAE,IAAI,CAACM,MAAM,CAACN,IAAI;QACtBQ,IAAI,EAAE,IAAI,CAACF,MAAM,CAACE;MACpB,CAAC,CAAC;MAEF,OAAO,IAAI;IAEb,CAAC,CAAC,OAAOiB,KAAK,EAAE;MACd,IAAI,CAACb,MAAM,EAAEa,KAAK,CAAC,+BAA+B,EAAE;QAClDA,KAAK,EAAEA,KAAK,CAACC,OAAO;QACpB1B,IAAI,EAAE,IAAI,CAACM,MAAM,CAACN;MACpB,CAAC,CAAC;MACF,MAAMyB,KAAK;IACb;EACF;EAEA,MAAMF,aAAaA,CAAA,EAAG;IACpB,MAAMI,UAAU,GAAG,CACjB;MACEC,OAAO,EAAE,CAAC;MACVC,IAAI,EAAE,gBAAgB;MACtBC,GAAG,EAAE;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACM,CAAC,EACD;MACEF,OAAO,EAAE,CAAC;MACVC,IAAI,EAAE,iBAAiB;MACvBC,GAAG,EAAE;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACM,CAAC,EACD;MACEF,OAAO,EAAE,CAAC;MACVC,IAAI,EAAE,oBAAoB;MAC1BC,GAAG,EAAE;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACM,CAAC,EACD;MACEF,OAAO,EAAE,CAAC;MACVC,IAAI,EAAE,kBAAkB;MACxBC,GAAG,EAAE;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACM,CAAC,EACD;MACEF,OAAO,EAAE,CAAC;MACVC,IAAI,EAAE,mBAAmB;MACzBC,GAAG,EAAE;AACb;AACA;AACA;AACA;AACA;AACA;IACM,CAAC,CACF;;IAED;IACA,MAAMC,kBAAkB,GAAG,MAAM,IAAI,CAACpB,EAAE,CAACqB,GAAG,CAAC;AACjD;AACA;AACA,KAAK,CAAC;IAEF,IAAI,CAACD,kBAAkB,EAAE;MACvB;MACA,KAAK,MAAME,SAAS,IAAIN,UAAU,EAAE;QAClC,MAAM,IAA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","ignoreList":[]}